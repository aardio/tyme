import time.tyme.data;

namespace time.tyme;

var YinYang = {
    YIN = 0;
    YANG = 1;
}

var Side = {
    IN = 0;
    OUT = 1;
}

var Gender =  {
    WOMAN = 0;
    MAN = 1;
}

var FestivalType = {
    DAY = 0;
    TERM = 1;
    EVE = 2;
}

var HideHeavenStemType = {
    RESIDUAL = 0;
    MIDDLE = 1;
    MAIN = 2;
}

// 抽象基类
class AbstractCulture {

    getName = function(){
        error("abstract method",2);
    }

    toString = function(){
        return this.getName();
    }

    equals = function(o){
        return o && tostring(o) === tostring(this);
    }

    @_meta;
}

var AbstractCulture = AbstractCulture;
namespace AbstractCulture {
    _meta = {
        _tostring = lambda () owner.toString();
    }

    indexOf = function(index, size){
        var i = index % size;
        if(i < 0){
            i += size;
        }
        return i;
    }

    numeric = function(n, name){
        var d = tonumber(n);
        if(d===null){
            error("illegal " ++ name ++ ": " ++ tostring(n),2);
        }
        return d;
    }
}

class AbstractTyme {
    ctor(){
        this = AbstractCulture();
    }

    next = function(n){
        error("abstract method",2);
    }
}

namespace AbstractTyme {
    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var AbstractTyme = AbstractTyme;

class AbstractCultureDay {
    ctor(culture, dayIndex){
        this = AbstractCulture();
        this.culture = culture;
        this.dayIndex = dayIndex;
    }

    getDayIndex = function(){
        return this.dayIndex;
    }

    getCulture = function(){
        return this.culture;
    }

    getName = function(){
        return this.culture.getName();
    }

    toString = function(){
        return tostring(this.culture) ++ "第" ++ tostring(this.getDayIndex() + 1) ++ "天";
    }
}

namespace AbstractCultureDay {
    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var AbstractCultureDay = AbstractCultureDay;

class LoopTyme {
    ctor(names, indexOrName){
        this = AbstractTyme();
        this.names = names;

        this.indexOfBy = function(indexOrName){
            if(type(indexOrName) == "number"){
                return indexOf(indexOrName, #this.names);
            }
            else {
                for(i=1;#owner.names){
                    if(owner.names[i] === indexOrName){
                        return i - 1;
                    }
                }
                error("illegal name " ++ indexOrName,2);
            }
        }
        this.index = this.indexOfBy(indexOrName);
    } 

    getName = function(){
        return this.names[this.index + 1];
    }

    getIndex = function(){
        return this.index;
    }

    getSize = function(){
        return #this.names;
    }

    nextIndex = function(n){
        return owner.indexOfBy(owner.index + n);
    }

    stepsTo = function(targetIndex){
        return owner.indexOfBy(targetIndex - owner.index);
    }
}

namespace LoopTyme {
    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}
var LoopTyme = LoopTyme;

// SolarTerm 类
class SolarTerm {
    ctor(year, indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
        var y = self.numeric(year, 'lunar year');
        if(type(indexOrName) == "number"){
            var size = #self.NAMES;
            y = ..math.modf((y * size + indexOrName) / size);
        }
        var jd = ..math.floor((y - 2000) * 365.2422 + 180);
        var w = ..math.floor((jd - 355 + 183) / 365.2422) * 365.2422 + 355;
        if(ShouXingUtil.calcQi(w) > jd){
            w -= 365.2422;
        }
        this.year = y;
        this.cursoryJulianDay = ShouXingUtil.calcQi(w + 15.2184 * this.index);
    }

    next = function(n){
        var size = owner.getSize();
        var i = owner.index + n;
        return self.fromIndex(..math.modf((owner.year * size + i) / size), owner.indexOfBy(i));
    }

    isJie = function(){
        return owner.index % 2 === 1;
    }

    isQi = function(){
        return owner.index % 2 === 0;
    }

    getJulianDay = function(){
        return JulianDay.fromJulianDay(ShouXingUtil.qiAccurate2(owner.cursoryJulianDay) + JulianDay.J2000);
    }

    getSolarDay = function(){
        return JulianDay.fromJulianDay(owner.cursoryJulianDay + JulianDay.J2000).getSolarDay();
    }

    getYear = function(){
        return owner.year;
    }

    getCursoryJulianDay = function(){
        return owner.cursoryJulianDay;
    }
}

var SolarTerm = SolarTerm;

namespace SolarTerm {
    NAMES = [
        '冬至', '小寒', '大寒', '立春', '雨水', '惊蛰', 
        '春分', '清明', '谷雨', '立夏', '小满', '芒种', 
        '夏至', '小暑', '大暑', '立秋', '处暑', '白露', 
        '秋分', '寒露', '霜降', '立冬', '小雪', '大雪'
    ];

    fromIndex = function(year, index){
        return SolarTerm(year, index);
    }

    fromName = function(year, name){
        return SolarTerm(year, name);
    }

    indexOf = LoopTyme.indexOf;
    indexOfBy = LoopTyme.indexOfBy;
    numeric = LoopTyme.numeric;
}


// SolarTermDay 类
class SolarTermDay {
    ctor(solarTerm, dayIndex){
        this = AbstractCultureDay(solarTerm, dayIndex);
    }

    getSolarTerm = function(){
        return owner.culture;
    }
}

namespace SolarTermDay {
    indexOf = AbstractCultureDay.indexOf;
    numeric = AbstractCultureDay.numeric;
}
var SolarTermDay = SolarTermDay;

// SolarYear 类
class SolarYear {
    ctor(year){
        this = AbstractTyme();
        var y = self.numeric(year, 'solar year');
        if(y < 1 || y > 9999){
            error("illegal solar year: " ++ tostring(year), 2);
        }
        this.year = y;
    }

    getYear = function(){
        return owner.year;
    }

    getDayCount = function(){
        if(1582 === owner.year){
            return 355;
        }
        return owner.isLeap() ? 366 : 365;
    }

    isLeap = function(){
        if(owner.year < 1600){
            return owner.year % 4 === 0;
        }
        return (owner.year % 4 === 0 && owner.year % 100 !== 0) || (owner.year % 400 === 0);
    }

    getName = function(){
        return tostring(owner.year) ++ "年";
    }

    next = function(n){
        return self.fromYear(owner.year + n);
    }

    getMonths = function(){
        var l = {};
        for(i=1; 12){
            ..table.push(l, SolarMonth.fromYm(owner.year, i));
        }
        return l;
    }

    getSeasons = function(){
        var l = {};
        for(i=0; 3){
            ..table.push(l, SolarSeason.fromIndex(owner.year, i));
        }
        return l;
    }

    getHalfYears = function(){
        var l = {};
        for(i=0; 1){
            ..table.push(l, SolarHalfYear.fromIndex(owner.year, i));
        }
        return l;
    }

    getRabByungYear = function(){
        return RabByungYear.fromYear(owner.year);
    }
}

var SolarYear = SolarYear;
namespace SolarYear {
    fromYear = function(year){
        return SolarYear(year);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

// SolarHalfYear 类
class SolarHalfYear {
    ctor(year, index){
        this = AbstractTyme();
        var i = self.numeric(index, 'solar half year index');
        if(i < 0 || i > 1){
            error("illegal solar half year index: " ++ tostring(index), 2);
        }
        this.year = SolarYear.fromYear(year);
        this.index = i;
    }

    getSolarYear = function(){
        return owner.year;
    }

    getYear = function(){
        return owner.year.getYear();
    }

    getIndex = function(){
        return owner.index;
    }

    getName = function(){
        return self.NAMES[owner.index + 1];
    }

    toString = function(){
        return tostring(owner.year) ++ owner.getName();
    }

    next = function(n){
        var i = owner.index + n;
        return self.fromIndex(..math.modf((owner.getYear() * 2 + i) / 2), owner.indexOf(i, 2));
    }

    getMonths = function(){
        var l = {};
        var y = owner.year.getYear();
        for(i=1; 6){
            ..table.push(l, SolarMonth.fromYm(y, owner.index * 6 + i));
        }
        return l;
    }

    getSeasons = function(){
        var l = {};
        var y = owner.year.getYear();
        for(i=0; 1){
            ..table.push(l, SolarSeason.fromIndex(y, owner.index * 2 + i));
        }
        return l;
    }
}

var SolarHalfYear = SolarHalfYear;
namespace SolarHalfYear {
    NAMES = ['上半年', '下半年'];

    fromIndex = function(year, index){
        return SolarHalfYear(year, index);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}


// SolarSeason 类
class SolarSeason {
    ctor(year, index){
        this = AbstractTyme();
        var i = self.numeric(index, 'solar season index');
        if(i < 0 || i > 3){
            error("illegal solar season index: " ++ tostring(index), 2);
        }
        this.year = SolarYear.fromYear(year);
        this.index = i;
    }

    getSolarYear = function(){
        return owner.year;
    }

    getYear = function(){
        return owner.year.getYear();
    }

    getIndex = function(){
        return owner.index;
    }

    getName = function(){
        return self.NAMES[owner.index + 1];
    }

    toString = function(){
        return tostring(owner.year) ++ owner.getName();
    }

    next = function(n){
        var i = owner.index + n;
        return self.fromIndex(..math.modf((owner.getYear() * 4 + i) / 4), owner.indexOf(i, 4));
    }

    getMonths = function(){
        var l = {};
        var y = owner.year.getYear();
        for(i=1; 3){
            ..table.push(l, SolarMonth.fromYm(y, owner.index * 3 + i));
        }
        return l;
    }
}

namespace SolarSeason {
    NAMES = ['一季度', '二季度', '三季度', '四季度'];

    fromIndex = function(year, index){
        return SolarSeason(year, index);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}
var SolarSeason = SolarSeason;

/*****intellisense(time.tyme)
SolarTerm = 节气
SolarTerm.fromIndex(.(year,index) = 根据年份和索引创建节气对象\n参数 @year 为年份\n参数 @index 为节气索引(0-23)
SolarTerm.fromName(.(year,name) = 根据年份和名称创建节气对象\n参数 @year 为年份\n参数 @name 为节气名称
SolarTermDay = 节气日
SolarYear = 公历年
SolarYear.fromYear(.(year) = 根据年份创建公历年对象\n参数 @year 为年份(1-9999)
SolarHalfYear = 公历半年
SolarHalfYear.fromIndex(.(year,index) = 根据年份和索引创建公历半年对象\n参数 @year 为年份\n参数 @index 为半年索引(0-1)
SolarSeason = 公历季度
SolarSeason.fromIndex(.(year,index) = 根据年份和索引创建公历季度对象\n参数 @year 为年份\n参数 @index 为季度索引(0-3)
end intellisense*****/

// SolarMonth 类
class SolarMonth {
    ctor(year, month){
        this = AbstractTyme();
        var m = self.numeric(month, 'solar month');
        if(m < 1 || m > 12){
            error("illegal solar month: " ++ tostring(month), 2);
        }
        this.year = SolarYear.fromYear(year);
        this.month = m;
    }

    getSolarYear = function(){
        return owner.year;
    }

    getYear = function(){
        return owner.year.getYear();
    }

    getMonth = function(){
        return owner.month;
    }

    getDayCount = function(){
        if(1582 === owner.getYear() && 10 === owner.month){
            return 21;
        }
        var d = self.DAYS[owner.getIndexInYear() + 1];
        if(2 === owner.month && owner.year.isLeap()){
            d++;
        }
        return d;
    }

    getIndexInYear = function(){
        return owner.month - 1;
    }

    getSeason = function(){
        return SolarSeason.fromIndex(owner.getYear(), ..math.modf(owner.getIndexInYear() / 3));
    }

    getWeekCount = function(start){
        return ..math.ceil((owner.indexOf(SolarDay.fromYmd(owner.getYear(), owner.month, 1).getWeek().getIndex() - start, 7) + owner.getDayCount()) / 7);
    }

    getName = function(){
        return self.NAMES[owner.getIndexInYear() + 1];
    }

    toString = function(){
        return tostring(owner.year) ++ owner.getName();
    }

    next = function(n){
        var i = owner.month - 1 + n;
        return self.fromYm(..math.modf((owner.getYear() * 12 + i) / 12), owner.indexOf(i, 12) + 1);
    }

    getWeeks = function(start){
        var l = {};
        var y = owner.getYear();
        for(i=0; owner.getWeekCount(start) - 1){
            ..table.push(l, SolarWeek.fromYm(y, owner.month, i, start));
        }
        return l;
    }

    getDays = function(){
        var l = {};
        var y = owner.getYear();
        for(i=1; owner.getDayCount()){
            ..table.push(l, SolarDay.fromYmd(y, owner.month, i));
        }
        return l;
    }
}

var SolarMonth = SolarMonth;
namespace SolarMonth {
    NAMES = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
    DAYS = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

    fromYm = function(year, month){
        return SolarMonth(year, month);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

// SolarWeek 类
class SolarWeek {
    ctor(year, month, index, start){
        this = AbstractTyme();
        var i = self.numeric(index, 'solar week index');
        if(i < 0 || i > 5){
            error("illegal solar week index: " ++ tostring(index), 2);
        }
        var t = Week.fromIndex(start);
        var m = SolarMonth.fromYm(year, month);
        if(i >= m.getWeekCount(t.getIndex())){
            error("illegal solar week index: " ++ tostring(index) ++ " in month: " ++ tostring(m), 2);
        }
        this.month = m;
        this.index = i;
        this.start = t;
    }

    getSolarMonth = function(){
        return owner.month;
    }

    getYear = function(){
        return owner.month.getYear();
    }

    getMonth = function(){
        return owner.month.getMonth();
    }

    getIndex = function(){
        return owner.index;
    }

    getIndexInYear = function(){
        var i = 0;
        var firstDay = owner.getFirstDay();
        var w = self.fromYm(owner.getYear(), 1, 0, owner.start.getIndex());
        while(!w.getFirstDay().equals(firstDay)){
            w = w.next(1);
            i++;
        }
        return i;
    }

    getStart = function(){
        return owner.start;
    }

    getName = function(){
        return self.NAMES[owner.index + 1];
    }

    toString = function(){
        return tostring(owner.month) ++ owner.getName();
    }

    next = function(n){
        var startIndex = owner.start.getIndex();
        var d = owner.index;
        var m = owner.month;
        if(n > 0){
            d += n;
            var weekCount = m.getWeekCount(startIndex);
            while(d >= weekCount){
                d -= weekCount;
                m = m.next(1);
                if(!SolarDay.fromYmd(m.getYear(), m.getMonth(), 1).getWeek().equals(owner.start)){
                    d += 1;
                }
                weekCount = m.getWeekCount(startIndex);
            }
        }
        elseif(n < 0){
            d += n;
            while(d < 0){
                if(!SolarDay.fromYmd(m.getYear(), m.getMonth(), 1).getWeek().equals(owner.start)){
                    d -= 1;
                }
                m = m.next(-1);
                d += m.getWeekCount(startIndex);
            }
        }
        return self.fromYm(m.getYear(), m.getMonth(), d, startIndex);
    }

    getFirstDay = function(){
        var firstDay = SolarDay.fromYmd(owner.getYear(), owner.getMonth(), 1);
        return firstDay.next(owner.index * 7 - owner.indexOf(firstDay.getWeek().getIndex() - owner.start.getIndex(), 7));
    }

    getDays = function(){
        var l = {};
        var d = owner.getFirstDay();
        ..table.push(l, d);
        for(i=1; 6){
            ..table.push(l, d.next(i));
        }
        return l;
    }

    equals = function(o){
        return o && o.getFirstDay().equals(owner.getFirstDay());
    }
}

var SolarWeek = SolarWeek;
namespace SolarWeek {
    NAMES = ['第一周', '第二周', '第三周', '第四周', '第五周', '第六周'];

    fromYm = function(year, month, index, start){
        return SolarWeek(year, month, index, start);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

// SolarDay 类
class SolarDay {
    ctor(year, month, day){
        if(year === null ) year = ..time();

        if( ..time.istime(year) ){
            var tm = year;
            year = tm.year
            month = tm.month
            day = tm.day
        }

        this = AbstractTyme();
        var d = self.numeric(day, 'solar day');
        if(d < 1){
            error("illegal solar day: " ++ tostring(year) ++ "-" ++ tostring(month) ++ "-" ++ tostring(day), 2);
        }
        var m = SolarMonth.fromYm(year, month);
        if(1582 === m.getYear() && 10 === m.getMonth()){
            if((d > 4 && d < 15) || d > 31){
                error("illegal solar day: " ++ tostring(year) ++ "-" ++ tostring(month) ++ "-" ++ tostring(day), 2);
            }
        }
        elseif(d > m.getDayCount()){
            error("illegal solar day: " ++ tostring(year) ++ "-" ++ tostring(month) ++ "-" ++ tostring(day), 2);
        }
        this.month = m;
        this.day = d;
    }

    getSolarMonth = function(){
        return owner.month;
    }

    getYear = function(){
        return owner.month.getYear();
    }

    getMonth = function(){
        return owner.month.getMonth();
    }

    getDay = function(){
        return owner.day;
    }

    getWeek = function(){
        return owner.getJulianDay().getWeek();
    }

    getConstellation = function(){
        var y = owner.getMonth() * 100 + owner.day;
        return Constellation.fromIndex(y > 1221 || y < 120 ? 9 : y < 219 ? 10 : y < 321 ? 11 : y < 420 ? 0 : y < 521 ? 1 : y < 622 ? 2 : y < 723 ? 3 : y < 823 ? 4 : y < 923 ? 5 : y < 1024 ? 6 : y < 1123 ? 7 : 8);
    }

    getName = function(){
        return self.NAMES[owner.day];
    }

    toString = function(){
        return tostring(owner.month) ++ owner.getName();
    }

    next = function(n){
        return owner.getJulianDay().next(n).getSolarDay();
    }

    isBefore = function(target){
        var aYear = owner.getYear();
        var bYear = target.getYear();
        if(aYear !== bYear){
            return aYear < bYear;
        }
        var aMonth = owner.getMonth();
        var bMonth = target.getMonth();
        return aMonth !== bMonth ? aMonth < bMonth : owner.day < target.getDay();
    }

    isAfter = function(target){
        var aYear = owner.getYear();
        var bYear = target.getYear();
        if(aYear !== bYear){
            return aYear > bYear;
        }
        var aMonth = owner.getMonth();
        var bMonth = target.getMonth();
        return aMonth !== bMonth ? aMonth > bMonth : owner.day > target.getDay();
    }

    getTerm = function(){
        return owner.getTermDay().getSolarTerm();
    }

    getTermDay = function(){
        var y = owner.getYear();
        var i = owner.getMonth() * 2;
        if(i == 24){
            y += 1;
            i = 0;
        }
        var term = SolarTerm.fromIndex(y, i);
        var day = term.getSolarDay();
        while(owner.isBefore(day)){
            term = term.next(-1);
            day = term.getSolarDay();
        }
        return SolarTermDay(term, owner.subtract(day));
    }

    getSolarWeek = function(start){
        var y = owner.getYear();
        var m = owner.getMonth();
        return SolarWeek.fromYm(y, m, ..math.ceil((owner.day + self.fromYmd(y, m, 1).getWeek().next(-start).getIndex()) / 7.0) - 1, start);
    }

    getPhenologyDay = function(){
        var d = owner.getTermDay();
        var dayIndex = d.getDayIndex();
        var index = ..math.modf(dayIndex / 5);
        if(index > 2){
            index = 2;
        }
        var term = d.getSolarTerm();
        return PhenologyDay(Phenology.fromIndex(term.getYear(), term.getIndex() * 3 + index), dayIndex - index * 5);
    }

    getPhenology = function(){
        return owner.getPhenologyDay().getPhenology();
    }

    getDogDay = function(){
        var xiaZhi = SolarTerm.fromIndex(owner.getYear(), 12);
        var start = xiaZhi.getSolarDay();
        start = start.next(start.getLunarDay().getSixtyCycle().getHeavenStem().stepsTo(6) + 20);
        var days = owner.subtract(start);
        if(days < 0){
            return null;
        }
        if(days < 10){
            return DogDay(Dog.fromIndex(0), days);
        }
        start = start.next(10);
        days = owner.subtract(start);
        if(days < 10){
            return DogDay(Dog.fromIndex(1), days);
        }
        start = start.next(10);
        days = owner.subtract(start);
        if(xiaZhi.next(3).getSolarDay().isAfter(start)){
            if(days < 10){
                return DogDay(Dog.fromIndex(1), days + 10);
            }
            start = start.next(10);
            days = owner.subtract(start);
        }
        if(days < 10){
            return DogDay(Dog.fromIndex(2), days);
        }
        return null;
    }

    getPlumRainDay = function(){
        var grainInEar = SolarTerm.fromIndex(owner.getYear(), 11);
        var start = grainInEar.getSolarDay();
        start = start.next(start.getLunarDay().getSixtyCycle().getHeavenStem().stepsTo(2));

        var $end = grainInEar.next(2).getSolarDay();
        $end = $end.next($end.getLunarDay().getSixtyCycle().getEarthBranch().stepsTo(7));

        if(owner.isBefore(start) || owner.isAfter($end)){
            return null;
        }
        return owner.equals($end) ? PlumRainDay(PlumRain.fromIndex(1), 0) : PlumRainDay(PlumRain.fromIndex(0), owner.subtract(start));
    }

    getHideHeavenStemDay = function(){
        var dayCounts = [3,5,7,9,10,30];
        var term = owner.getTerm();
        if(term.isQi()){
            term = term.next(-1);
        }
        var dayIndex = owner.subtract(term.getSolarDay());
        var startIndex = (term.getIndex() - 1) * 3;
        var data = ..string.slice('93705542220504xx1513904541632524533533105544806564xx7573304542018584xx95', startIndex + 1, startIndex + 6);
        var days = 0;
        var heavenStemIndex = 0;
        var typeIndex = 0;
        while(typeIndex < 3){
            var i = typeIndex * 2;
            var d = ..string.slice(data, i + 1, i + 1);
            var count = 0;
            if(d != 'x'){
                heavenStemIndex = tonumber(d);
                count = dayCounts[tonumber(..string.slice(data, i + 2, i + 2)) + 1];
                days += count;
            }
            if(dayIndex <= days){
                dayIndex -= days - count;
                break;
            }
            typeIndex++;
        }
        var typ;
        if(typeIndex == 0){
            typ = HideHeavenStemType.RESIDUAL;
        }
        elseif(typeIndex == 1){
            typ = HideHeavenStemType.MIDDLE;
        }
        else {
            typ = HideHeavenStemType.MAIN;
        }
        return HideHeavenStemDay(HideHeavenStem(heavenStemIndex, typ), dayIndex);
    }

    getNineDay = function(){
        var year = owner.getYear();
        var start = SolarTerm.fromIndex(year + 1, 0).getSolarDay();
        if(owner.isBefore(start)){
            start = SolarTerm.fromIndex(year, 0).getSolarDay();
        }
        var $end = start.next(81);
        if(owner.isBefore(start) || !owner.isBefore($end)){
            return null;
        }
        var days = owner.subtract(start);
        return NineDay(Nine.fromIndex(..math.modf(days / 9)), days % 9);
    }

    getIndexInYear = function(){
        return owner.subtract(self.fromYmd(owner.getYear(), 1, 1));
    }

    subtract = function(target){
        return ..math.modf(owner.getJulianDay().subtract(target.getJulianDay()));
    }

    getJulianDay = function(){
        return JulianDay.fromYmdHms(owner.getYear(), owner.getMonth(), owner.day, 0, 0, 0);
    }

    getLunarDay = function(){
        var m = LunarMonth.fromYm(owner.getYear(), owner.getMonth());
        var days = owner.subtract(m.getFirstJulianDay().getSolarDay());
        while(days < 0){
            m = m.next(-1);
            days += m.getDayCount();
        }
        return LunarDay.fromYmd(m.getYear(), m.getMonthWithLeap(), days + 1);
    }

    getRabByungDay = function(){
        return RabByungDay.fromSolarDay(owner);
    }

    getSixtyCycleDay = function(){
        return SixtyCycleDay.fromSolarDay(owner);
    }

    getLegalHoliday = function(){
        return LegalHoliday.fromYmd(owner.getYear(), owner.getMonth(), owner.day);
    }

    getFestival = function(){
        return SolarFestival.fromYmd(owner.getYear(), owner.getMonth(), owner.day);
    }

    getPhaseDay = function(){
        var month = owner.getLunarDay().getLunarMonth().next(1);
        var p = Phase.fromIndex(month.getYear(), month.getMonthWithLeap(), 0);
        var d = p.getSolarDay();
        while(d.isAfter(owner)){
            p = p.next(-1);
            d = p.getSolarDay();
        }
        return PhaseDay(p, owner.subtract(d));
    }

    getPhase = function(){
        return owner.getPhaseDay().getPhase();
    }
}

var SolarDay = SolarDay;
namespace SolarDay {
    NAMES = [
        '1日', '2日', '3日', '4日', '5日', '6日', '7日', '8日', '9日', '10日',
        '11日', '12日', '13日', '14日', '15日', '16日', '17日', '18日', '19日', '20日',
        '21日', '22日', '23日', '24日', '25日', '26日', '27日', '28日', '29日', '30日', '31日'
    ];

    fromYmd = function(year, month, day){
        return SolarDay(year, month, day);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}


// SolarTime 类
class SolarTime {
    ctor(year, month, day, hour, minute, second){
        this = AbstractTyme();
        var h = self.numeric(hour, 'hour');
        if(h < 0 || h > 23){
            error("illegal hour: " ++ tostring(hour), 2);
        }
        var m = self.numeric(minute, 'minute');
        if(m < 0 || m > 59){
            error("illegal minute: " ++ tostring(minute), 2);
        }
        var s = self.numeric(second, 'second');
        if(s < 0 || s > 59){
            error("illegal second: " ++ tostring(second), 2);
        }
        this.day = SolarDay.fromYmd(year, month, day);
        this.hour = h;
        this.minute = m;
        this.second = s;
    }

    getSolarDay = function(){
        return owner.day;
    }

    getYear = function(){
        return owner.day.getYear();
    }

    getMonth = function(){
        return owner.day.getMonth();
    }

    getDay = function(){
        return owner.day.getDay();
    }

    getHour = function(){
        return owner.hour;
    }

    getMinute = function(){
        return owner.minute;
    }

    getSecond = function(){
        return owner.second;
    }

    getName = function(){
        var h = (owner.hour < 10 ? '0' : '') ++ tostring(owner.hour);
        var m = (owner.minute < 10 ? '0' : '') ++ tostring(owner.minute);
        var s = (owner.second < 10 ? '0' : '') ++ tostring(owner.second);
        return h ++ ":" ++ m ++ ":" ++ s;
    }

    toString = function(){
        return tostring(owner.day) ++ " " ++ owner.getName();
    }

    next = function(n){
        if(n == 0){
            return self.fromYmdHms(owner.getYear(), owner.getMonth(), owner.getDay(), owner.hour, owner.minute, owner.second);
        }
        var ts = owner.second + n;
        var tm = owner.minute + ..math.modf(ts / 60);
        ts %= 60;
        if(ts < 0){
            ts += 60;
            tm -= 1;
        }
        var th = owner.hour + ..math.modf(tm / 60);
        tm %= 60;
        if(tm < 0){
            tm += 60;
            th -= 1;
        }
        var td = ..math.modf(th / 24);
        th %= 24;
        if(th < 0){
            th += 24;
            td -= 1;
        }

        var d = owner.day.next(td);
        return self.fromYmdHms(d.getYear(), d.getMonth(), d.getDay(), th, tm, ts);
    }

    isBefore = function(target){
        if(!owner.day.equals(target.getSolarDay())){
            return owner.day.isBefore(target.getSolarDay());
        }
        if(owner.hour !== target.getHour()){
            return owner.hour < target.getHour();
        }
        return owner.minute !== target.getMinute() ? owner.minute < target.getMinute() : owner.second < target.getSecond();
    }

    isAfter = function(target){
        if(!owner.day.equals(target.getSolarDay())){
            return owner.day.isAfter(target.getSolarDay());
        }
        if(owner.hour !== target.getHour()){
            return owner.hour > target.getHour();
        }
        return owner.minute !== target.getMinute() ? owner.minute > target.getMinute() : owner.second > target.getSecond();
    }

    getTerm = function(){
        var term = owner.getSolarDay().getTerm();
        if(owner.isBefore(term.getJulianDay().getSolarTime())){
            term = term.next(-1);
        }
        return term;
    }

    getPhenology = function(){
        var p = owner.getSolarDay().getPhenology();
        if(owner.isBefore(p.getJulianDay().getSolarTime())){
            p = p.next(-1);
        }
        return p;
    }

    getJulianDay = function(){
        return JulianDay.fromYmdHms(owner.day.getYear(), owner.day.getMonth(), owner.day.getDay(), owner.hour, owner.minute, owner.second);
    }

    subtract = function(target){
        var days = owner.day.subtract(target.getSolarDay());
        var cs = owner.hour * 3600 + owner.minute * 60 + owner.second;
        var ts = target.getHour() * 3600 + target.getMinute() * 60 + target.getSecond();
        var seconds = cs - ts;
        if(seconds < 0){
            seconds += 86400;
            days--;
        }
        seconds += days * 86400;
        return seconds;
    }

    getLunarHour = function(){
        var d = owner.day.getLunarDay();
        return LunarHour.fromYmdHms(d.getYear(), d.getMonth(), d.getDay(), owner.hour, owner.minute, owner.second);
    }

    getSixtyCycleHour = function(){
        return SixtyCycleHour.fromSolarTime(owner);
    }

    getPhase = function(){
        var month = owner.getLunarHour().getLunarDay().getLunarMonth().next(1);
        var p = Phase.fromIndex(month.getYear(), month.getMonthWithLeap(), 0);
        while(p.getSolarTime().isAfter(owner)){
            p = p.next(-1);
        }
        return p;
    }
}

var SolarTime = SolarTime;
namespace SolarTime {
    fromYmdHms = function(year, month, day, hour, minute, second){
        return SolarTime(year, month, day, hour, minute, second);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}


/*****intellisense(time.tyme)
SolarMonth = 公历月
SolarMonth.fromYm(.(year,month) = 根据年月创建公历月对象\n参数 @year 为年份\n参数 @month 为月份(1-12)
SolarWeek = 公历周
SolarWeek.fromYm(.(year,month,index,start) = 根据年月周索引创建公历周对象\n参数 @year 为年份\n参数 @month 为月份\n参数 @index 为周索引(0-5)\n参数 @start 为起始星期
SolarDay = 公历日
SolarDay.fromYmd(.(year,month,day) = 根据年月日创建公历日对象\n参数 @year 为年份\n参数 @month 为月份(1-12)\n参数 @day 为日期(1-31)
SolarTime = 公历时间
SolarTime.fromYmdHms(.(year,month,day,hour,minute,second) = 根据年月日时分秒创建公历时间对象\n参数 @year 为年份\n参数 @month 为月份\n参数 @day 为日期\n参数 @hour 为小时(0-23)\n参数 @minute 为分钟(0-59)\n参数 @second 为秒(0-59)
end intellisense*****/

// Animal 类
class Animal {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getTwentyEightStar = function(){
        return TwentyEightStar.fromIndex(owner.index);
    }
}

namespace Animal {
    NAMES = [
        '蛟', '龙', '貉', '兔', '狐', '虎', '豹', '獬', 
        '牛', '蝠', '鼠', '燕', '猪', '獝', '狼', '狗', 
        '彘', '鸡', '乌', '猴', '猿', '犴', '羊', '獐', 
        '马', '鹿', '蛇', '蚓'
    ];

    fromIndex = function(index){
        return Animal(self.numeric(index, 'animal index'));
    }

    fromName = function(name){
        return Animal(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Animal = Animal;

// TwentyEightStar 类
class TwentyEightStar {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getSevenStar = function(){
        return SevenStar.fromIndex(owner.index % 7 + 4);
    }

    getLand = function(){
        var lands = [4,4,4,2,2,2,7,7,7,0,0,0,0,5,5,5,6,6,6,1,1,1,8,8,8,3,3,3];
        return Land.fromIndex(lands[owner.index + 1]);
    }

    getZone = function(){
        return Zone.fromIndex(..math.modf(owner.index / 7));
    }

    getAnimal = function(){
        return Animal.fromIndex(owner.index);
    }

    getLuck = function(){
        var lucks = [0,1,1,0,1,0,0,0,1,1,1,1,0,0,1,0,0,1,0,1,0,0,1,1,1,0,1,0];
        return Luck.fromIndex(lucks[owner.index + 1]);
    }
}

namespace TwentyEightStar {
    NAMES = [
        '角', '亢', '氐', '房', '心', '尾', '箕', 
        '斗', '牛', '女', '虚', '危', '室', '壁', 
        '奎', '娄', '胃', '昴', '毕', '觜', '参', 
        '井', '鬼', '柳', '星', '张', '翼', '轸'
    ];

    fromIndex = function(index){
        return TwentyEightStar(self.numeric(index, 'twenty eight star index'));
    }

    fromName = function(name){
        return TwentyEightStar(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var TwentyEightStar = TwentyEightStar;

// SevenStar 类
class SevenStar {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getWeek = function(){
        return Week.fromIndex(owner.index);
    }
}

namespace SevenStar {
    NAMES = ['日', '月', '火', '水', '木', '金', '土'];

    fromIndex = function(index){
        return SevenStar(self.numeric(index, 'seven star index'));
    }

    fromName = function(name){
        return SevenStar(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var SevenStar = SevenStar;

// Week 类
class Week {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getSevenStar = function(){
        return SevenStar.fromIndex(owner.index);
    }
}

namespace Week {
    NAMES = ['日', '一', '二', '三', '四', '五', '六'];

    fromIndex = function(index){
        return Week(self.numeric(index, 'week index'));
    }

    fromName = function(name){
        return Week(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Week = Week;

// Land 类
class Land {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getDirection = function(){
        return Direction.fromIndex(owner.index);
    }
}

namespace Land {
    NAMES = ['玄天', '朱天', '苍天', '阳天', '钧天', '幽天', '颢天', '变天', '炎天'];

    fromIndex = function(index){
        return Land(self.numeric(index, 'land index'));
    }

    fromName = function(name){
        return Land(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Land = Land;

// Direction 类
class Direction {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getLand = function(){
        return Land.fromIndex(owner.index);
    }

    getElement = function(){
        var elements = [4,2,0,0,2,3,3,2,1];
        return Element.fromIndex(elements[owner.index + 1]);
    }
}

namespace Direction {
    NAMES = ['北', '西南', '东', '东南', '中', '西北', '西', '东北', '南'];

    fromIndex = function(index){
        return Direction(self.numeric(index, 'direction index'));
    }

    fromName = function(name){
        return Direction(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Direction = Direction;

// Zone 类
class Zone {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getDirection = function(){
        return Direction.fromName(owner.getName());
    }

    getBeast = function(){
        return Beast.fromIndex(owner.getIndex());
    }
}

namespace Zone {
    NAMES = ['东', '北', '西', '南'];

    fromIndex = function(index){
        return Zone(self.numeric(index, 'zone index'));
    }

    fromName = function(name){
        return Zone(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Zone = Zone;

// Beast 类
class Beast {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getZone = function(){
        return Zone.fromIndex(owner.index);
    }
}

namespace Beast {
    NAMES = ['青龙', '玄武', '白虎', '朱雀'];

    fromIndex = function(index){
        return Beast(self.numeric(index, 'beast index'));
    }

    fromName = function(name){
        return Beast(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Beast = Beast;

// Luck 类
class Luck {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Luck {
    NAMES = ['吉', '凶'];

    fromIndex = function(index){
        return Luck(self.numeric(index, 'luck index'));
    }

    fromName = function(name){
        return Luck(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Luck = Luck;

// Constellation 类
class Constellation {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Constellation {
    NAMES = [
        '白羊', '金牛', '双子', '巨蟹', '狮子', '处女', 
        '天秤', '天蝎', '射手', '摩羯', '水瓶', '双鱼'
    ];

    fromIndex = function(index){
        return Constellation(self.numeric(index, 'constellation index'));
    }

    fromName = function(name){
        return Constellation(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Constellation = Constellation;

// Duty 类
class Duty {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Duty {
    NAMES = ['建', '除', '满', '平', '定', '执', '破', '危', '成', '收', '开', '闭'];

    fromIndex = function(index){
        return Duty(self.numeric(index, 'duty index'));
    }

    fromName = function(name){
        return Duty(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Duty = Duty;

// Element 类
class Element {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getReinforce = function(){
        return owner.next(1);
    }

    getRestrain = function(){
        return owner.next(2);
    }

    getReinforced = function(){
        return owner.next(-1);
    }

    getRestrained = function(){
        return owner.next(-2);
    }

    getDirection = function(){
        var directions = [2,8,4,6,0];
        return Direction.fromIndex(directions[owner.index + 1]);
    }
}

var Element = Element;
namespace Element {
    NAMES = ['木', '火', '土', '金', '水'];

    fromIndex = function(index){
        return Element(self.numeric(index, 'element index'));
    }

    fromName = function(name){
        return Element(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}

/*****intellisense()
time.tyme = 万年历与农历支持库
end intellisense*****/

/*****intellisense(time.tyme)
YinYang = 阴阳枚举\n@.YIN 阴\n@.YANG 阳
Side = 方位枚举\n@.IN 内\n@.OUT 外
Gender = 性别枚举\n@.WOMAN 女\n@.MAN 男
FestivalType = 节日类型枚举\n@.DAY 日\n@.TERM 节气\n@.EVE 除夕
HideHeavenStemType = 藏干类型枚举\n@.RESIDUAL 余气\n@.MIDDLE 中气\n@.MAIN 本气
Animal = 二十八宿动物
Animal.fromIndex(.(index) = 根据索引创建二十八宿动物对象\n参数 @index 为索引值(0-27)
Animal.fromName(.(name) = 根据名称创建二十八宿动物对象\n参数 @name 为动物名称
TwentyEightStar = 二十八宿
TwentyEightStar.fromIndex(.(index) = 根据索引创建二十八宿对象\n参数 @index 为索引值(0-27)
TwentyEightStar.fromName(.(name) = 根据名称创建二十八宿对象\n参数 @name 为宿名
SevenStar = 七曜
SevenStar.fromIndex(.(index) = 根据索引创建七曜对象\n参数 @index 为索引值(0-6)
SevenStar.fromName(.(name) = 根据名称创建七曜对象\n参数 @name 为七曜名称
Week = 星期
Week.fromIndex(.(index) = 根据索引创建星期对象\n参数 @index 为索引值(0-6)
Week.fromName(.(name) = 根据名称创建星期对象\n参数 @name 为星期名称
Land = 九天
Land.fromIndex(.(index) = 根据索引创建九天对象\n参数 @index 为索引值(0-8)
Land.fromName(.(name) = 根据名称创建九天对象\n参数 @name 为九天名称
Direction = 方位
Direction.fromIndex(.(index) = 根据索引创建方位对象\n参数 @index 为索引值(0-8)
Direction.fromName(.(name) = 根据名称创建方位对象\n参数 @name 为方位名称
Zone = 四方
Zone.fromIndex(.(index) = 根据索引创建四方对象\n参数 @index 为索引值(0-3)
Zone.fromName(.(name) = 根据名称创建四方对象\n参数 @name 为四方名称
Beast = 四象
Beast.fromIndex(.(index) = 根据索引创建四象对象\n参数 @index 为索引值(0-3)
Beast.fromName(.(name) = 根据名称创建四象对象\n参数 @name 为四象名称
Luck = 吉凶
Luck.fromIndex(.(index) = 根据索引创建吉凶对象\n参数 @index 为索引值(0-1)
Luck.fromName(.(name) = 根据名称创建吉凶对象\n参数 @name 为吉凶名称
Constellation = 星座
Constellation.fromIndex(.(index) = 根据索引创建星座对象\n参数 @index 为索引值(0-11)
Constellation.fromName(.(name) = 根据名称创建星座对象\n参数 @name 为星座名称
Duty = 建除十二值
Duty.fromIndex(.(index) = 根据索引创建建除值对象\n参数 @index 为索引值(0-11)
Duty.fromName(.(name) = 根据名称创建建除值对象\n参数 @name 为建除值名称
Element = 五行
Element.fromIndex(.(index) = 根据索引创建五行对象\n参数 @index 为索引值(0-4)
Element.fromName(.(name) = 根据名称创建五行对象\n参数 @name 为五行名称
end intellisense*****/

// God 类
class God {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getLuck = function(){
        return Luck.fromIndex(owner.index < 60 ? 0 : 1);
    }
}

namespace God {
    NAMES = [
        '天恩', '鸣吠', '母仓', '不将', '四相', '鸣吠对', '五合', '三合', '除神', '月德', 
        '月空', '月德合', '月恩', '时阴', '五富', '生气', '金匮', '相日', '阴德', '六合', 
        '益后', '青龙', '续世', '明堂', '王日', '要安', '官日', '吉期', '福德', '六仪', 
        '金堂', '宝光', '民日', '临日', '天马', '敬安', '普护', '驿马', '天后', '阳德', 
        '天喜', '天医', '司命', '圣心', '玉宇', '守日', '时德', '解神', '时阳', '天仓', 
        '天巫', '玉堂', '福生', '天德', '天德合', '天愿', '天赦', '天符', '阴神', '解除', 
        '五虚', '五离', '重日', '复日', '血支', '天贼', '土符', '游祸', '白虎', '小耗', 
        '致死', '河魁', '劫煞', '月煞', '月建', '往亡', '大时', '大败', '咸池', '厌对', 
        '招摇', '九坎', '九焦', '天罡', '死神', '月害', '死气', '月破', '大耗', '天牢', 
        '元武', '月厌', '月虚', '归忌', '小时', '天刑', '朱雀', '九空', '天吏', '地火', 
        '四击', '大煞', '勾陈', '八专', '灾煞', '天火', '血忌', '土府', '月刑', '触水龙', 
        '地囊', '八风', '四废', '四忌', '四穷', '五墓', '阴错', '四耗', '阳错', '孤辰', 
        '小会', '大会', '八龙', '七鸟', '九虎', '六蛇', '天狗', '行狠', '了戾', '岁薄', 
        '逐阵', '三丧', '三阴', '阴道冲阳', '阴位', '阴阳交破', '阴阳俱错', '阴阳击冲', 
        '鬼哭', '单阴', '绝阴', '纯阳', '阳错阴冲', '七符', '成日', '孤阳', '绝阳', '纯阴', 
        '大退', '四离', '阳破阴冲'
    ];

    dayGods = ..time.tyme.data.dayGods;

    fromIndex = function(index){
        return God(self.numeric(index, 'god index'));
    }

    fromName = function(name){
        return God(name);
    }

    getDayGods = function(month, day){
        var l = {};
        var index = ..string.format("%02X", day.getIndex());
        var pattern = ";" ++ index ++ "(.[\^;]*)";
        var matcher = ..string.match(self.dayGods[month.getEarthBranch().next(-2).getIndex() + 1], pattern);
        if(matcher){
            var data = matcher;
            for(i=1; #data; 2){
                var godIndex = tonumber(..string.slice(data, i, i + 1), 16);
                ..table.push(l, self.fromIndex(godIndex));
            }
        }
        return l;
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var God = God;

// Phase 类
class Phase {
    ctor(lunarYear, lunarMonth, indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
        if(type(indexOrName) == "number"){
            var m = LunarMonth.fromYm(lunarYear, lunarMonth).next(..math.modf(indexOrName / this.getSize()));
            this.lunarYear = m.getYear();
            this.lunarMonth = m.getMonthWithLeap();
        }
        else {
            this.lunarYear = self.numeric(lunarYear, 'lunar year');
            this.lunarMonth = self.numeric(lunarMonth, 'lunar month');
        }
    }

    next = function(n){
        var size = owner.getSize();
        var i = owner.getIndex() + n;
        if(i < 0){
            i -= size;
        }
        i = ..math.modf(i / size);
        var m = LunarMonth.fromYm(owner.lunarYear, owner.lunarMonth);
        if(i != 0){
            m = m.next(i);
        }
        return self.fromIndex(m.getYear(), m.getMonthWithLeap(), owner.nextIndex(n));
    }

    getStartSolarTime = function(){
        var n = ..math.floor((owner.lunarYear - 2000) * 365.2422 / 29.53058886);
       var i = 0;
        var jd = JulianDay.J2000 + ShouXingUtil.ONE_THIRD;
        var d = LunarDay.fromYmd(owner.lunarYear, owner.lunarMonth, 1).getSolarDay();
        while(true){
            var t = ShouXingUtil.msaLonT((n + i) * ShouXingUtil.PI_2) * 36525;
            if(!JulianDay.fromJulianDay(jd + t - ShouXingUtil.dtT(t)).getSolarDay().isBefore(d)){
                break;
            }
            i++;
        }
        var r = [0, 90, 180, 270];
        t = ShouXingUtil.msaLonT((n + i + r[..math.modf(owner.getIndex() / 2) + 1] / 360.0) * ShouXingUtil.PI_2) * 36525;
        return JulianDay.fromJulianDay(jd + t - ShouXingUtil.dtT(t)).getSolarTime();
    }

    getSolarTime = function(){
        var t = owner.getStartSolarTime();
        return owner.getIndex() % 2 == 1 ? t.next(1) : t;
    }

    getSolarDay = function(){
        var d = owner.getStartSolarTime().getSolarDay();
        return owner.getIndex() % 2 == 1 ? d.next(1) : d;
    }
}

namespace Phase {
    NAMES = ['新月', '蛾眉月', '上弦月', '盈凸月', '满月', '亏凸月', '下弦月', '残月'];

    fromIndex = function(lunarYear, lunarMonth, index){
        return Phase(lunarYear, lunarMonth, self.numeric(index, 'phase index'));
    }
 
    fromName = function(lunarYear, lunarMonth, name){
        return Phase(lunarYear, lunarMonth, name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Phase = Phase;

// PhaseDay 类
class PhaseDay {
    ctor(phase, dayIndex){
        this = AbstractCultureDay(phase, dayIndex);
    }

    getPhase = function(){
        return owner.culture;
    }
}

namespace PhaseDay {
    indexOf = AbstractCultureDay.indexOf;
    numeric = AbstractCultureDay.numeric;
}
var PhaseDay = PhaseDay;

// Sixty 类
class Sixty {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Sixty {
    NAMES = ['上元', '中元', '下元'];

    fromIndex = function(index){
        return Sixty(self.numeric(index, 'sixty index'));
    }

    fromName = function(name){
        return Sixty(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Sixty = Sixty;

// Sound 类
class Sound {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Sound {
    NAMES = [
        '海中金', '炉中火', '大林木', '路旁土', '剑锋金', '山头火', 
        '涧下水', '城头土', '白蜡金', '杨柳木', '泉中水', '屋上土', 
        '霹雳火', '松柏木', '长流水', '沙中金', '山下火', '平地木', 
        '壁上土', '金箔金', '覆灯火', '天河水', '大驿土', '钗钏金', 
        '桑柘木', '大溪水', '沙中土', '天上火', '石榴木', '大海水'
    ];

    fromIndex = function(index){
        return Sound(self.numeric(index, 'sound index'));
    }

    fromName = function(name){
        return Sound(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Sound = Sound;

// Taboo 类
class Taboo {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Taboo {
    NAMES = [
        '祭祀', '祈福', '求嗣', '开光', '塑绘', '齐醮', '斋醮', '沐浴', '酬神', '造庙', 
        '祀灶', '焚香', '谢土', '出火', '雕刻', '嫁娶', '订婚', '纳采', '问名', '纳婿', 
        '归宁', '安床', '合帐', '冠笄', '订盟', '进人口', '裁衣', '挽面', '开容', '修坟', 
        '启钻', '破土', '安葬', '立碑', '成服', '除服', '开生坟', '合寿木', '入殓', '移柩', 
        '普渡', '入宅', '安香', '安门', '修造', '起基', '动土', '上梁', '竖柱', '开井开池', 
        '作陂放水', '拆卸', '破屋', '坏垣', '补垣', '伐木做梁', '作灶', '解除', '开柱眼', 
        '穿屏扇架', '盖屋合脊', '开厕', '造仓', '塞穴', '平治道涂', '造桥', '作厕', '筑堤', 
        '开池', '伐木', '开渠', '掘井', '扫舍', '放水', '造屋', '合脊', '造畜稠', '修门', 
        '定磉', '作梁', '修饰垣墙', '架马', '开市', '挂匾', '纳财', '求财', '开仓', '买车', 
        '置产', '雇佣', '出货财', '安机械', '造车器', '经络', '酝酿', '作染', '鼓铸', '造船', 
        '割蜜', '栽种', '取渔', '结网', '牧养', '安碓磑', '习艺', '入学', '理发', '探病', 
        '见贵', '乘船', '渡水', '针灸', '出行', '移徙', '分居', '剃头', '整手足甲', '纳畜', 
        '捕捉', '畋猎', '教牛马', '会亲友', '赴任', '求医', '治病', '词讼', '起基动土', 
        '破屋坏垣', '盖屋', '造仓库', '交易', '立券', '安机', '会友', '求医疗病', '诸事不宜', 
        '馀事勿取', '行丧', '断蚁', '归岫'
    ];

    dayTaboo =  ..time.tyme.data.dayTaboo;
    hourTaboo = ..time.tyme.data.hourTaboo;

    fromIndex = function(index){
        return Taboo(self.numeric(index, 'taboo index'));
    }

    fromName = function(name){
        return Taboo(name);
    }

    _getTaboos = function(data, supIndex, subIndex, index){
        var l = {};
        var d = ..string.split(data[supIndex + 1], ";")[subIndex + 1];
        d = ..string.split(d, ",")[index + 1];
        for(i=1; #d; 2){
            var tabooIndex = tonumber(..string.slice(d, i, i + 1), 16);
            ..table.push(l, self.fromIndex(tabooIndex));
        }
        return l;
    }

    getDayRecommends = function(month, day){
        return self._getTaboos(self.dayTaboo, month.getEarthBranch().getIndex(), day.getIndex(), 0);
    }

    getDayAvoids = function(month, day){
        return self._getTaboos(self.dayTaboo, month.getEarthBranch().getIndex(), day.getIndex(), 1);
    }

    getHourRecommends = function(day, hour){
        return self._getTaboos(self.hourTaboo, hour.getEarthBranch().getIndex(), day.getIndex(), 0);
    }

    getHourAvoids = function(day, hour){
        return self._getTaboos(self.hourTaboo, hour.getEarthBranch().getIndex(), day.getIndex(), 1);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Taboo = Taboo;

// Ten 类
class Ten {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Ten {
    NAMES = ['甲子', '甲戌', '甲申', '甲午', '甲辰', '甲寅'];

    fromIndex = function(index){
        return Ten(self.numeric(index, 'ten index'));
    }

    fromName = function(name){
        return Ten(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Ten = Ten;

// Terrain 类
class Terrain {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Terrain {
    NAMES = ['长生', '沐浴', '冠带', '临官', '帝旺', '衰', '病', '死', '墓', '绝', '胎', '养'];

    fromIndex = function(index){
        return Terrain(self.numeric(index, 'terrain index'));
    }

    fromName = function(name){
        return Terrain(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Terrain = Terrain;

// Twenty 类
class Twenty {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getSixty = function(){
        return Sixty.fromIndex(..math.modf(owner.index / 3));
    }
}

namespace Twenty {
    NAMES = ['一运', '二运', '三运', '四运', '五运', '六运', '七运', '八运', '九运'];

    fromIndex = function(index){
        return Twenty(self.numeric(index, 'twenty index'));
    }

    fromName = function(name){
        return Twenty(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Twenty = Twenty;

// Zodiac 类
class Zodiac {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getEarthBranch = function(){
        return EarthBranch.fromIndex(owner.index);
    }
}

var Zodiac = Zodiac;
namespace Zodiac {
    NAMES = ['鼠', '牛', '虎', '兔', '龙', '蛇', '马', '羊', '猴', '鸡', '狗', '猪'];

    fromIndex = function(index){
        return Zodiac(self.numeric(index, 'zodiac index'));
    }

    fromName = function(name){
        return Zodiac(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}

/*****intellisense(time.tyme)
God = 神煞
God.fromIndex(.(index) = 根据索引创建神煞对象\n参数 @index 为索引值
God.fromName(.(name) = 根据名称创建神煞对象\n参数 @name 为神煞名称
God.getDayGods(.(month,day) = 获取日神煞列表\n参数 @month 为月干支\n参数 @day 为日干支
Phase = 月相
Phase.fromIndex(.(lunarYear,lunarMonth,index) = 根据索引创建月相对象\n参数 @lunarYear 为农历年\n参数 @lunarMonth 为农历月\n参数 @index 为索引值(0-7)
Phase.fromName(.(lunarYear,lunarMonth,name) = 根据名称创建月相对象\n参数 @lunarYear 为农历年\n参数 @lunarMonth 为农历月\n参数 @name 为月相名称
PhaseDay = 月相日
Sixty = 六十甲子元
Sixty.fromIndex(.(index) = 根据索引创建元对象\n参数 @index 为索引值(0-2)
Sixty.fromName(.(name) = 根据名称创建元对象\n参数 @name 为元名称
Sound = 纳音
Sound.fromIndex(.(index) = 根据索引创建纳音对象\n参数 @index 为索引值(0-29)
Sound.fromName(.(name) = 根据名称创建纳音对象\n参数 @name 为纳音名称
Taboo = 宜忌
Taboo.fromIndex(.(index) = 根据索引创建宜忌对象\n参数 @index 为索引值
Taboo.fromName(.(name) = 根据名称创建宜忌对象\n参数 @name 为宜忌名称
Taboo.getDayRecommends(.(month,day) = 获取日宜列表\n参数 @month 为月干支\n参数 @day 为日干支
Taboo.getDayAvoids(.(month,day) = 获取日忌列表\n参数 @month 为月干支\n参数 @day 为日干支
Taboo.getHourRecommends(.(day,hour) = 获取时宜列表\n参数 @day 为日干支\n参数 @hour 为时干支
Taboo.getHourAvoids(.(day,hour) = 获取时忌列表\n参数 @day 为日干支\n参数 @hour 为时干支
Ten = 旬
Ten.fromIndex(.(index) = 根据索引创建旬对象\n参数 @index 为索引值(0-5)
Ten.fromName(.(name) = 根据名称创建旬对象\n参数 @name 为旬名称
Terrain = 十二长生
Terrain.fromIndex(.(index) = 根据索引创建长生对象\n参数 @index 为索引值(0-11)
Terrain.fromName(.(name) = 根据名称创建长生对象\n参数 @name 为长生名称
Twenty = 二十运
Twenty.fromIndex(.(index) = 根据索引创建运对象\n参数 @index 为索引值(0-8)
Twenty.fromName(.(name) = 根据名称创建运对象\n参数 @name 为运名称
Zodiac = 生肖
Zodiac.fromIndex(.(index) = 根据索引创建生肖对象\n参数 @index 为索引值(0-11)
Zodiac.fromName(.(name) = 根据名称创建生肖对象\n参数 @name 为生肖名称
end intellisense*****/

// EarthBranch 类
class EarthBranch {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getElement = function(){
        var elements = [4,2,0,0,2,1,1,2,3,3,2,4];
        return Element.fromIndex(elements[owner.index + 1]);
    }

    getYinYang = function(){
        return owner.index % 2 === 0 ? YinYang.YANG : YinYang.YIN;
    }

    getHideHeavenStemMain = function(){
        var mains = [9,5,0,1,4,2,3,5,6,7,4,8];
        return HeavenStem.fromIndex(mains[owner.index + 1]);
    }

    getHideHeavenStemMiddle = function(){
        var middles = [-1,9,2,-1,1,6,5,3,8,-1,7,0];
        var n = middles[owner.index + 1];
        return n === -1 ? null : HeavenStem.fromIndex(n);
    }

    getHideHeavenStemResidual = function(){
        var residuals = [-1,7,4,-1,9,4,-1,1,4,-1,3,-1];
        var n = residuals[owner.index + 1];
        return n === -1 ? null : HeavenStem.fromIndex(n);
    }

    getHideHeavenStems = function(){
        var l = {};
        ..table.push(l, HideHeavenStem(owner.getHideHeavenStemMain(), HideHeavenStemType.MAIN));
        var o = owner.getHideHeavenStemMiddle();
        if(o){
            ..table.push(l, HideHeavenStem(o, HideHeavenStemType.MIDDLE));
        }
        o = owner.getHideHeavenStemResidual();
        if(o){
            ..table.push(l, HideHeavenStem(o, HideHeavenStemType.RESIDUAL));
        }
        return l;
    }

    getZodiac = function(){
        return Zodiac.fromIndex(owner.index);
    }

    getDirection = function(){
        var directions = [0,4,2,2,4,8,8,4,6,6,4,0];
        return Direction.fromIndex(directions[owner.index + 1]);
    }

    getOpposite = function(){
        return owner.next(6);
    }

    getOminous = function(){
        var ominous = [8,2,0,6];
        return Direction.fromIndex(ominous[owner.index % 4 + 1]);
    }

    getPengZuEarthBranch = function(){
        return PengZuEarthBranch.fromIndex(owner.index);
    }

    getCombine = function(){
        return self.fromIndex(1 - owner.index);
    }

    getHarm = function(){
        return self.fromIndex(19 - owner.index);
    }

    combine = function(target){
        if(!owner.getCombine().equals(target)){
            return null;
        }
        var elements = [2,2,0,1,3,4,2,2,4,3,1,0];
        return Element.fromIndex(elements[owner.index + 1]);
    }
}

var EarthBranch = EarthBranch;
namespace EarthBranch {
    NAMES = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];

    fromIndex = function(index){
        return EarthBranch(self.numeric(index, 'earth branch index'));
    }

    fromName = function(name){
        return EarthBranch(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}

// HeavenStem 类
class HeavenStem {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getElement = function(){
        return Element.fromIndex(..math.modf(owner.index / 2));
    }

    getYinYang = function(){
        return owner.index % 2 === 0 ? YinYang.YANG : YinYang.YIN;
    }

    getTenStar = function(target){
        var targetIndex = target.getIndex();
        var offset = targetIndex - owner.index;
        if(owner.index % 2 !== 0 && targetIndex % 2 === 0){
            offset += 2;
        }
        return TenStar.fromIndex(offset);
    }

    getDirection = function(){
        return owner.getElement().getDirection();
    }

    getJoyDirection = function(){
        var joys = [7,5,1,8,3];
        return Direction.fromIndex(joys[owner.index % 5 + 1]);
    }

    getYangDirection = function(){
        var yangs = [1,1,6,5,7,0,8,7,2,3];
        return Direction.fromIndex(yangs[owner.index + 1]);
    }

    getYinDirection = function(){
        var yins = [7,0,5,6,1,1,7,8,3,2];
        return Direction.fromIndex(yins[owner.index + 1]);
    }

    getWealthDirection = function(){
        var wealths = [7,1,0,2,8];
        return Direction.fromIndex(wealths[..math.modf(owner.index / 2) + 1]);
    }

    getMascotDirection = function(){
        var mascots = [3,3,2,2,0,8,1,1,5,6];
        return Direction.fromIndex(mascots[owner.index + 1]);
    }

    getPengZuHeavenStem = function(){
        return PengZuHeavenStem.fromIndex(owner.index);
    }

    getTerrain = function(earthBranch){
        var earthBranchIndex = earthBranch.getIndex();
        var terrains = [1,6,10,9,10,9,7,0,4,3];
        return Terrain.fromIndex(terrains[owner.index + 1] + (YinYang.YANG == owner.getYinYang() ? earthBranchIndex : -earthBranchIndex));
    }

    getCombine = function(){
        return owner.next(5);
    }

    combine = function(target){
        if(!owner.getCombine().equals(target)){
            return null;
        }
        return Element.fromIndex(owner.index + 2);
    }
}

var HeavenStem = HeavenStem;
namespace HeavenStem {
    NAMES = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];

    fromIndex = function(index){
        return HeavenStem(self.numeric(index, 'heaven stem index'));
    }

    fromName = function(name){
        return HeavenStem(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}

// HideHeavenStem 类
class HideHeavenStem {
    ctor(heavenStem, typ){
        this = AbstractCulture();
        if(type(heavenStem) == "number"){
            this.heavenStem = HeavenStem.fromIndex(heavenStem);
        }
        else if(type(heavenStem) == "string"){
            this.heavenStem = HeavenStem.fromName(heavenStem);
        }
        else {
            this.heavenStem = heavenStem;
        }
        this.type = typ;
    }

    getName = function(){
        return owner.heavenStem.getName();
    }

    getHeavenStem = function(){
        return owner.heavenStem;
    }

    getType = function(){
        return owner.type;
    }
}

namespace HideHeavenStem {
    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var HideHeavenStem = HideHeavenStem;

// HideHeavenStemDay 类
class HideHeavenStemDay {
    ctor(hideHeavenStem, dayIndex){
        this = AbstractCultureDay(hideHeavenStem, dayIndex);
    }

    getHideHeavenStem = function(){
        return owner.culture;
    }

    getName = function(){
        var heavenStem = owner.getHideHeavenStem().getHeavenStem();
        return heavenStem.getName() ++ heavenStem.getElement().getName();
    }

    toString = function(){
        return owner.getName() ++ "第" ++ tostring(owner.getDayIndex() + 1) ++ "天";
    }
}

namespace HideHeavenStemDay {
    indexOf = AbstractCultureDay.indexOf;
    numeric = AbstractCultureDay.numeric;
}
var HideHeavenStemDay = HideHeavenStemDay;

// PengZuHeavenStem 类
class PengZuHeavenStem {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace PengZuHeavenStem {
    NAMES = [
        '甲不开仓财物耗散', '乙不栽植千株不长', '丙不修灶必见灾殃', '丁不剃头头必生疮', 
        '戊不受田田主不祥', '己不破券二比并亡', '庚不经络织机虚张', '辛不合酱主人不尝', 
        '壬不泱水更难提防', '癸不词讼理弱敌强'
    ];

    fromIndex = function(index){
        return PengZuHeavenStem(self.numeric(index, 'peng zu heaven stem index'));
    }

    fromName = function(name){
        return PengZuHeavenStem(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var PengZuHeavenStem = PengZuHeavenStem;

// PengZuEarthBranch 类
class PengZuEarthBranch {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace PengZuEarthBranch {
    NAMES = [
        '子不问卜自惹祸殃', '丑不冠带主不还乡', '寅不祭祀神鬼不尝', '卯不穿井水泉不香', 
        '辰不哭泣必主重丧', '巳不远行财物伏藏', '午不苫盖屋主更张', '未不服药毒气入肠', 
        '申不安床鬼祟入房', '酉不会客醉坐颠狂', '戌不吃犬作怪上床', '亥不嫁娶不利新郎'
    ];

    fromIndex = function(index){
        return PengZuEarthBranch(self.numeric(index, 'peng zu earth branch index'));
    }

    fromName = function(name){
        return PengZuEarthBranch(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var PengZuEarthBranch = PengZuEarthBranch;

// PengZu 类
class PengZu {
    ctor(sixtyCycle){
        this = AbstractCulture();
        this.pengZuHeavenStem = PengZuHeavenStem.fromIndex(sixtyCycle.getHeavenStem().getIndex());
        this.pengZuEarthBranch = PengZuEarthBranch.fromIndex(sixtyCycle.getEarthBranch().getIndex());
    }

    getName = function(){
        return owner.pengZuHeavenStem.getName() ++ " " ++ owner.pengZuEarthBranch.getName();
    }

    getPengZuHeavenStem = function(){
        return owner.pengZuHeavenStem;
    }

    getPengZuEarthBranch = function(){
        return owner.pengZuEarthBranch;
    }
}

namespace PengZu {
    fromSixtyCycle = function(sixtyCycle){
        return PengZu(sixtyCycle);
    }

    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var PengZu = PengZu;

// TenStar 类
class TenStar {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace TenStar {
    NAMES = ['比肩', '劫财', '食神', '伤官', '偏财', '正财', '七杀', '正官', '偏印', '正印'];

    fromIndex = function(index){
        return TenStar(self.numeric(index, 'ten star index'));
    }

    fromName = function(name){
        return TenStar(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var TenStar = TenStar;

// SixStar 类
class SixStar {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace SixStar {
    NAMES = ['先胜', '友引', '先负', '佛灭', '大安', '赤口'];

    fromIndex = function(index){
        return SixStar(self.numeric(index, 'six star index'));
    }

    fromName = function(name){
        return SixStar(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var SixStar = SixStar;

// MinorRen 类
class MinorRen {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getLuck = function(){
        return Luck.fromIndex(owner.index % 2);
    }

    getElement = function(){
        var elements = [0,4,1,3,0,2];
        return Element.fromIndex(elements[owner.index + 1]);
    }
}

namespace MinorRen {
    NAMES = ['大安', '留连', '速喜', '赤口', '小吉', '空亡'];

    fromIndex = function(index){
        return MinorRen(self.numeric(index, 'minor ren index'));
    }

    fromName = function(name){
        return MinorRen(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var MinorRen = MinorRen;

/*****intellisense(time.tyme)
EarthBranch = 地支
EarthBranch.fromIndex(.(index) = 根据索引创建地支对象\n参数 @index 为索引值(0-11)
EarthBranch.fromName(.(name) = 根据名称创建地支对象\n参数 @name 为地支名称
HeavenStem = 天干
HeavenStem.fromIndex(.(index) = 根据索引创建天干对象\n参数 @index 为索引值(0-9)
HeavenStem.fromName(.(name) = 根据名称创建天干对象\n参数 @name 为天干名称
HideHeavenStem = 藏干
HideHeavenStemDay = 藏干日
PengZuHeavenStem = 彭祖百忌天干
PengZuHeavenStem.fromIndex(.(index) = 根据索引创建彭祖天干对象\n参数 @index 为索引值(0-9)
PengZuHeavenStem.fromName(.(name) = 根据名称创建彭祖天干对象\n参数 @name 为天干名称
PengZuEarthBranch = 彭祖百忌地支
PengZuEarthBranch.fromIndex(.(index) = 根据索引创建彭祖地支对象\n参数 @index 为索引值(0-11)
PengZuEarthBranch.fromName(.(name) = 根据名称创建彭祖地支对象\n参数 @name 为地支名称
PengZu = 彭祖百忌
PengZu.fromSixtyCycle(.(sixtyCycle) = 根据六十甲子创建彭祖百忌对象\n参数 @sixtyCycle 为六十甲子对象
TenStar = 十神
TenStar.fromIndex(.(index) = 根据索引创建十神对象\n参数 @index 为索引值(0-9)
TenStar.fromName(.(name) = 根据名称创建十神对象\n参数 @name 为十神名称
SixStar = 六曜
SixStar.fromIndex(.(index) = 根据索引创建六曜对象\n参数 @index 为索引值(0-5)
SixStar.fromName(.(name) = 根据名称创建六曜对象\n参数 @name 为六曜名称
MinorRen = 小六壬
MinorRen.fromIndex(.(index) = 根据索引创建小六壬对象\n参数 @index 为索引值(0-5)
MinorRen.fromName(.(name) = 根据名称创建小六壬对象\n参数 @name 为小六壬名称
end intellisense*****/

// SixtyCycle 类
class SixtyCycle {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getHeavenStem = function(){
        return HeavenStem.fromIndex(owner.index % #HeavenStem.NAMES);
    }

    getEarthBranch = function(){
        return EarthBranch.fromIndex(owner.index % #EarthBranch.NAMES);
    }

    getSound = function(){
        return Sound.fromIndex(..math.modf(owner.index / 2));
    }

    getPengZu = function(){
        return PengZu.fromSixtyCycle(owner);
    }

    getTen = function(){
        return Ten.fromIndex(..math.modf((owner.getHeavenStem().getIndex() - owner.getEarthBranch().getIndex()) / 2));
    }

    getExtraEarthBranches = function(){
        var l = {};
        l[1] = EarthBranch.fromIndex(10 + owner.getEarthBranch().getIndex() - owner.getHeavenStem().getIndex());
        l[2] = l[1].next(1);
        return l;
    }
}

namespace SixtyCycle {
    NAMES = [
        '甲子', '乙丑', '丙寅', '丁卯', '戊辰', '己巳', '庚午', '辛未', '壬申', '癸酉',
        '甲戌', '乙亥', '丙子', '丁丑', '戊寅', '己卯', '庚辰', '辛巳', '壬午', '癸未',
        '甲申', '乙酉', '丙戌', '丁亥', '戊子', '己丑', '庚寅', '辛卯', '壬辰', '癸巳',
        '甲午', '乙未', '丙申', '丁酉', '戊戌', '己亥', '庚子', '辛丑', '壬寅', '癸卯',
        '甲辰', '乙巳', '丙午', '丁未', '戊申', '己酉', '庚戌', '辛亥', '壬子', '癸丑',
        '甲寅', '乙卯', '丙辰', '丁巳', '戊午', '己未', '庚申', '辛酉', '壬戌', '癸亥'
    ];

    fromIndex = function(index){
        return SixtyCycle(self.numeric(index, 'sixty cycle index'));
    }

    fromName = function(name){
        return SixtyCycle(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var SixtyCycle = SixtyCycle;
SixtyCycle.SixtyCycle = SixtyCycle;

// Dog 类
class Dog {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Dog {
    NAMES = ['初伏', '中伏', '末伏'];

    fromIndex = function(index){
        return Dog(self.numeric(index, 'dog index'));
    }

    fromName = function(name){
        return Dog(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Dog = Dog;

// DogDay 类
class DogDay {
    ctor(dog, dayIndex){
        this = AbstractCultureDay(dog, dayIndex);
    }

    getDog = function(){
        return owner.culture;
    }
}

namespace DogDay {
    indexOf = AbstractCultureDay.indexOf;
    numeric = AbstractCultureDay.numeric;
}
var DogDay = DogDay;

// PlumRain 类
class PlumRain {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace PlumRain {
    NAMES = ['入梅', '出梅'];

    fromIndex = function(index){
        return PlumRain(self.numeric(index, 'plum rain index'));
    }

    fromName = function(name){
        return PlumRain(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var PlumRain = PlumRain;

// PlumRainDay 类
class PlumRainDay {
    ctor(plumRain, dayIndex){
        this = AbstractCultureDay(plumRain, dayIndex);
    }

    getPlumRain = function(){
        return owner.culture;
    }

    toString = function(){
        return owner.getPlumRain().getIndex() == 0 ? AbstractCultureDay.toString.call(owner) : owner.culture.getName();
    }
}

namespace PlumRainDay {
    indexOf = AbstractCultureDay.indexOf;
    numeric = AbstractCultureDay.numeric;
}
var PlumRainDay = PlumRainDay;

// FetusHeavenStem 类
class FetusHeavenStem {
    ctor(index){
        this = LoopTyme(self.NAMES, index);
    }

    next = function(n){
        return FetusHeavenStem(owner.nextIndex(n));
    }
}

namespace FetusHeavenStem {
    NAMES = ['门', '碓磨', '厨灶', '仓库', '房床'];

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var FetusHeavenStem = FetusHeavenStem;

// FetusEarthBranch 类
class FetusEarthBranch {
    ctor(index){
        this = LoopTyme(self.NAMES, index);
    }

    next = function(n){
        return FetusEarthBranch(owner.nextIndex(n));
    }
}

namespace FetusEarthBranch {
    NAMES = ['碓', '厕', '炉', '门', '栖', '床'];

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var FetusEarthBranch = FetusEarthBranch;

// FetusDay 类
class FetusDay {
    ctor(sixtyCycle){
        this = AbstractCulture();
        this.fetusHeavenStem = FetusHeavenStem(sixtyCycle.getHeavenStem().getIndex() % 5);
        this.fetusEarthBranch = FetusEarthBranch(sixtyCycle.getEarthBranch().getIndex() % 6);
        var indices = [
            3,3,8,8,8,8,8,1,1,1,1,1,1,6,6,6,6,6,5,5,5,5,5,5,0,0,0,0,0,-9,-9,-9,-9,-9,
            -5,-5,-1,-1,-1,-3,-7,-7,-7,-7,-5,7,7,7,7,7,7,2,2,2,2,2,3,3,3,3
        ];
        var index = indices[sixtyCycle.getIndex() + 1];
        this.side = index < 0 ? Side.IN : Side.OUT;
        this.direction = Direction.fromIndex(index);
    }

    getName = function(){
        var s = owner.fetusHeavenStem.getName() ++ owner.fetusEarthBranch.getName();
        if(s === '门门'){
            s = '占大门';
        }
        elseif(s === '碓磨碓'){
            s = '占碓磨';
        }
        elseif(s === '房床床'){
            s = '占房床';
        }
        elseif(..string.find(s, '门') == 1){
            s = '占' ++ s;
        }

        s ++= ' ';

        if(Side.IN == owner.side){
            s ++= '房内';
        }
        else {
            s ++= '外';
        }

        var directionName = owner.direction.getName();
        if(Side.OUT == owner.side && ..string.find('北南西东', directionName)){
            s ++= '正';
        }
        s ++= directionName;
        return s;
    }

    getSide = function(){
        return owner.side;
    }

    getDirection = function(){
        return owner.direction;
    }

    getFetusHeavenStem = function(){
        return owner.fetusHeavenStem;
    }

    getFetusEarthBranch = function(){
        return owner.fetusEarthBranch;
    }
}

namespace FetusDay {
    fromLunarDay = function(lunarDay){
        return FetusDay(lunarDay.getSixtyCycle());
    }

    fromSixtyCycleDay = function(sixtyCycleDay){
        return FetusDay(sixtyCycleDay.getSixtyCycle());
    }

    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var FetusDay = FetusDay;

// Nine 类
class Nine {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Nine {
    NAMES = ['一九', '二九', '三九', '四九', '五九', '六九', '七九', '八九', '九九'];

    fromIndex = function(index){
        return Nine(self.numeric(index, 'nine index'));
    }

    fromName = function(name){
        return Nine(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Nine = Nine;

// NineDay 类
class NineDay {
    ctor(nine, dayIndex){
        this = AbstractCultureDay(nine, dayIndex);
    }

    getNine = function(){
        return owner.culture;
    }
}

namespace NineDay {
    indexOf = AbstractCultureDay.indexOf;
    numeric = AbstractCultureDay.numeric;
}
var NineDay = NineDay;

// Phenology 类
class Phenology {
    ctor(year, indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
        if(type(indexOrName) == "number"){
            var size = this.getSize();
            this.year = ..math.modf((year * size + indexOrName) / size);
        }
        else {
            this.year = year;
        }
    }

    next = function(n){
        var size = owner.getSize();
        var i = owner.getIndex() + n;
        return self.fromIndex(..math.modf((owner.year * size + i) / size), owner.indexOf(i, size));
    }

    getYear = function(){
        return owner.year;
    }

    getThreePhenology = function(){
        return ThreePhenology.fromIndex(owner.index % 3);
    }

    getJulianDay = function(){
        var t = ShouXingUtil.saLonT((owner.year - 2000 + (owner.getIndex() - 18) * 5.0 / 360 + 1) * 2 * ..math.pi);
        return JulianDay.fromJulianDay(t * 36525 + JulianDay.J2000 + 8.0 / 24 - ShouXingUtil.dtT(t * 36525));
    }
}

namespace Phenology {
    NAMES = [
        '蚯蚓结', '麋角解', '水泉动', '雁北乡', '鹊始巢', '雉始雊', '鸡始乳', '征鸟厉疾', 
        '水泽腹坚', '东风解冻', '蛰虫始振', '鱼陟负冰', '獭祭鱼', '候雁北', '草木萌动', 
        '桃始华', '仓庚鸣', '鹰化为鸠', '玄鸟至', '雷乃发声', '始电', '桐始华', '田鼠化为鴽', 
        '虹始见', '萍始生', '鸣鸠拂其羽', '戴胜降于桑', '蝼蝈鸣', '蚯蚓出', '王瓜生', 
        '苦菜秀', '靡草死', '麦秋至', '螳螂生', '鵙始鸣', '反舌无声', '鹿角解', '蜩始鸣', 
        '半夏生', '温风至', '蟋蟀居壁', '鹰始挚', '腐草为萤', '土润溽暑', '大雨行时', 
        '凉风至', '白露降', '寒蝉鸣', '鹰乃祭鸟', '天地始肃', '禾乃登', '鸿雁来', '玄鸟归', 
        '群鸟养羞', '雷始收声', '蛰虫坯户', '水始涸', '鸿雁来宾', '雀入大水为蛤', '菊有黄花', 
        '豺乃祭兽', '草木黄落', '蛰虫咸俯', '水始冰', '地始冻', '雉入大水为蜃', '虹藏不见', 
        '天气上升地气下降', '闭塞而成冬', '鹖鴠不鸣', '虎始交', '荔挺出'
    ];

    fromIndex = function(year, index){
        return Phenology(year, self.numeric(index, 'phenology index'));
    }

    fromName = function(year, name){
        return Phenology(year, name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Phenology = Phenology;

// ThreePhenology 类
class ThreePhenology {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getThreePhenology = function(){
        return self.fromIndex(owner.index % 3);
    }
}

namespace ThreePhenology {
    NAMES = ['初候', '二候', '三候'];

    fromIndex = function(index){
        return ThreePhenology(self.numeric(index, 'three phenology index'));
    }

    fromName = function(name){
        return ThreePhenology(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var ThreePhenology = ThreePhenology;

// Dipper 类
class Dipper {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

namespace Dipper {
    NAMES = ['天枢', '天璇', '天玑', '天权', '玉衡', '开阳', '摇光', '洞明', '隐元'];

    fromIndex = function(index){
        return Dipper(self.numeric(index, 'dipper index'));
    }

    fromName = function(name){
        return Dipper(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Dipper = Dipper;

// PhenologyDay 类
class PhenologyDay {
    ctor(phenology, dayIndex){
        this = AbstractCultureDay(phenology, dayIndex);
    }

    getPhenology = function(){
        return owner.culture;
    }
}

namespace PhenologyDay {
    indexOf = AbstractCultureDay.indexOf;
    numeric = AbstractCultureDay.numeric;
}
var PhenologyDay = PhenologyDay;

/*****intellisense(time.tyme)
SixtyCycle = 六十甲子
SixtyCycle.fromIndex(.(index) = 根据索引创建六十甲子对象\n参数 @index 为索引值(0-59)
SixtyCycle.fromName(.(name) = 根据名称创建六十甲子对象\n参数 @name 为干支名称
Dog = 三伏
Dog.fromIndex(.(index) = 根据索引创建三伏对象\n参数 @index 为索引值(0-2)
Dog.fromName(.(name) = 根据名称创建三伏对象\n参数 @name 为三伏名称
DogDay = 三伏日
PlumRain = 梅雨
PlumRain.fromIndex(.(index) = 根据索引创建梅雨对象\n参数 @index 为索引值(0-1)
PlumRain.fromName(.(name) = 根据名称创建梅雨对象\n参数 @name 为梅雨名称
PlumRainDay = 梅雨日
FetusHeavenStem = 胎神天干
FetusEarthBranch = 胎神地支
FetusDay = 胎神日
FetusDay.fromLunarDay(.(lunarDay) = 根据农历日创建胎神日对象\n参数 @lunarDay 为农历日对象
FetusDay.fromSixtyCycleDay(.(sixtyCycleDay) = 根据干支日创建胎神日对象\n参数 @sixtyCycleDay 为干支日对象
Nine = 数九
Nine.fromIndex(.(index) = 根据索引创建数九对象\n参数 @index 为索引值(0-8)
Nine.fromName(.(name) = 根据名称创建数九对象\n参数 @name 为数九名称
NineDay = 数九日
Phenology = 物候
Phenology.fromIndex(.(year,index) = 根据索引创建物候对象\n参数 @year 为年份\n参数 @index 为索引值(0-71)
Phenology.fromName(.(year,name) = 根据名称创建物候对象\n参数 @year 为年份\n参数 @name 为物候名称
ThreePhenology = 三候
ThreePhenology.fromIndex(.(index) = 根据索引创建三候对象\n参数 @index 为索引值(0-2)
ThreePhenology.fromName(.(name) = 根据名称创建三候对象\n参数 @name 为三候名称
Dipper = 北斗九星
Dipper.fromIndex(.(index) = 根据索引创建北斗九星对象\n参数 @index 为索引值(0-8)
Dipper.fromName(.(name) = 根据名称创建北斗九星对象\n参数 @name 为北斗九星名称
PhenologyDay = 物候日
end intellisense*****/

// NineStar 类
class NineStar {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getColor = function(){
        var colors = ['白', '黑', '碧', '绿', '黄', '白', '赤', '白', '紫'];
        return colors[owner.index + 1];
    }

    getElement = function(){
        var elements = [4,2,0,0,2,3,3,2,1];
        return Element.fromIndex(elements[owner.index + 1]);
    }

    getDipper = function(){
        return Dipper.fromIndex(owner.index);
    }

    getDirection = function(){
        return Direction.fromIndex(owner.index);
    }

    toString = function(){
        return owner.getName() ++ owner.getColor() ++ owner.getElement();
    }
}

namespace NineStar {
    NAMES = ['一', '二', '三', '四', '五', '六', '七', '八', '九'];

    fromIndex = function(index){
        return NineStar(self.numeric(index, 'nine star index'));
    }

    fromName = function(name){
        return NineStar(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var NineStar = NineStar;

// TwelveStar 类
class TwelveStar {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getEcliptic = function(){
        var ecliptics = [0,0,1,1,0,0,1,0,1,1,0,1];
        return Ecliptic.fromIndex(ecliptics[owner.index + 1]);
    }
}

namespace TwelveStar {
    NAMES = ['青龙', '明堂', '天刑', '朱雀', '金匮', '天德', '白虎', '玉堂', '天牢', '玄武', '司命', '勾陈'];

    fromIndex = function(index){
        return TwelveStar(self.numeric(index, 'twelve star index'));
    }

    fromName = function(name){
        return TwelveStar(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var TwelveStar = TwelveStar;

// Ecliptic 类
class Ecliptic {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getLuck = function(){
        return Luck.fromIndex(owner.index);
    }
}

namespace Ecliptic {
    NAMES = ['黄道', '黑道'];

    fromIndex = function(index){
        return Ecliptic(self.numeric(index, 'ecliptic index'));
    }

    fromName = function(name){
        return Ecliptic(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}
var Ecliptic = Ecliptic;

// LunarYear 类
class LunarYear {
    ctor(year){
        this = AbstractTyme();
        var y = self.numeric(year, 'lunar year');
        if(y < -1 || y > 9999){
            error("illegal lunar year: " ++ tostring(year), 2);
        }
        this.year = y;
    }

    getYear = function(){
        return owner.year;
    }

    getDayCount = function(){
        var n = 0;
        var months = owner.getMonths();
        for(i=1; #months){
            n += months[i].getDayCount();
        }
        return n;
    }

    getMonthCount = function(){
        return owner.getLeapMonth() < 1 ? 12 : 13;
    }

    getName = function(){
        return "农历" ++ owner.getSixtyCycle().getName() ++ "年";
    }

    next = function(n){
        return self.fromYear(owner.year + n);
    }

    getLeapMonth = function(){
        if(owner.year === -1){
            return 11;
        }
        for(i=1; #self.LEAP){
            if(..table.find(self.LEAP[i], owner.year)){
                return i;
            }
        }
        return 0;
    }

    getSixtyCycle = function(){
        return SixtyCycle.fromIndex(owner.year - 4);
    }

    getTwenty = function(){
        return Twenty.fromIndex(..math.floor((owner.year - 1864) / 20));
    }

    getNineStar = function(){
        return NineStar.fromIndex(63 + owner.getTwenty().getSixty().getIndex() * 3 - owner.getSixtyCycle().getIndex());
    }

    getJupiterDirection = function(){
        var directions = [0,7,7,2,3,3,8,1,1,6,0,0];
        return Direction.fromIndex(directions[owner.getSixtyCycle().getEarthBranch().getIndex() + 1]);
    }

    getFirstMonth = function(){
        return LunarMonth.fromYm(owner.year, 1);
    }

    getMonths = function(){
        var l = {};
        var m = owner.getFirstMonth();
        while(m.getYear() === owner.year){
            ..table.push(l, m);
            m = m.next(1);
        }
        return l;
    }

    getKitchenGodSteed = function(){
        return KitchenGodSteed.fromLunarYear(owner.year);
    }
}

var LunarYear = LunarYear;
namespace LunarYear {
    isInit = false;
    LEAP = {};

    init = function(){
        if(self.isInit){
            return;
        }
        var chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_@';
        var months = ..time.tyme.data.LunarYear_months;
        
        for(i=1; 12){
            var n = 0;
            var m = months[i];
            var size = ..math.modf(#m / 2);
            var l = {};
            for(y=0; size - 1){
                var z = y * 2;
                var t = 0;
                var c = 1;
                for(x=1; 0; -1){
                    t += c * (..string.find(chars, ..string.slice(m, z + x + 1, z + x + 1)) - 1);
                    c *= 64;
                }
                n += t;
                ..table.push(l, n);
            }
            self.LEAP[i] = l;
        }
        self.isInit = true;
    }

    fromYear = function(year){
        self.init();
        return LunarYear(year);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}


// LunarSeason 类
class LunarSeason {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }
}

var LunarSeason = LunarSeason;
namespace LunarSeason {
    NAMES = ['孟春', '仲春', '季春', '孟夏', '仲夏', '季夏', '孟秋', '仲秋', '季秋', '孟冬', '仲冬', '季冬'];

    fromIndex = function(index){
        return LunarSeason(self.numeric(index, 'lunar season index'));
    }

    fromName = function(name){
        return LunarSeason(name);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}

// FetusMonth 类
class FetusMonth {
    ctor(indexOrName){
        this = LoopTyme(self.NAMES, indexOrName);
    }

    next = function(n){
        return FetusMonth(owner.nextIndex(n));
    }
}

var FetusMonth = FetusMonth;
namespace FetusMonth {
    NAMES = ['占房床', '占户窗', '占门堂', '占厨灶', '占房床', '占床仓', '占碓磨', '占厕户', '占门房', '占房床', '占灶炉', '占房床'];

    fromLunarMonth = function(lunarMonth){
        return lunarMonth.isLeap() ? null : FetusMonth(lunarMonth.getMonth() - 1);
    }

    indexOf = LoopTyme.indexOf;
    numeric = LoopTyme.numeric;
}

// LunarMonth 类
class LunarMonth {
    ctor(year, month, cache){
        this = AbstractTyme();
        if(cache){
            var m = cache[2];
            this.year = LunarYear.fromYear(cache[1]);
            this.month = ..math.abs(m);
            this.leap = m < 0;
            this.dayCount = cache[3];
            this.indexInYear = cache[4];
            this.firstJulianDay = JulianDay.fromJulianDay(cache[5]);
        }
        else {
            var t = self.numeric(month, 'lunar month');
            if(t === 0 || t > 12 || t < -12){
                error("illegal lunar month: " ++ tostring(month), 2);
            }
            var currentYear = LunarYear.fromYear(year);
            var y = currentYear.getYear();
            var currentLeapMonth = currentYear.getLeapMonth();
            var leap = t < 0;
            var m = ..math.abs(t);
            if(leap && m != currentLeapMonth){
                error("illegal leap month " ++ tostring(m) ++ " in lunar year " ++ tostring(year), 2);
            }

            var dongZhiJd = SolarTerm.fromIndex(y, 0).getCursoryJulianDay();
            var w = ShouXingUtil.calcShuo(dongZhiJd);
            if(w > dongZhiJd){
                w -= 29.53;
            }

            var offset = 2;
            if(y > 8 && y < 24){
                offset = 1;
            }
            elseif(LunarYear.fromYear(y - 1).getLeapMonth() > 10 && y != 239 && y != 240){
                offset = 3;
            }

            var index = m - 1;
            if(leap || (currentLeapMonth > 0 && m > currentLeapMonth)){
                index += 1;
            }
            this.indexInYear = index;

            w += 29.5306 * (offset + index);
            var firstDay = ShouXingUtil.calcShuo(w);
            this.firstJulianDay = JulianDay.fromJulianDay(JulianDay.J2000 + firstDay);
            this.dayCount = ..math.modf(ShouXingUtil.calcShuo(w + 29.5306) - firstDay);
            this.year = currentYear;
            this.month = m;
            this.leap = leap;
        }
    }

    getLunarYear = function(){
        return owner.year;
    }

    getYear = function(){
        return owner.year.getYear();
    }

    getMonth = function(){
        return owner.month;
    }

    getMonthWithLeap = function(){
        return owner.leap ? -owner.month : owner.month;
    }

    getDayCount = function(){
        return owner.dayCount;
    }

    getIndexInYear = function(){
        return owner.indexInYear;
    }

    getSeason = function(){
        return LunarSeason.fromIndex(owner.month - 1);
    }

    getFirstJulianDay = function(){
        return owner.firstJulianDay;
    }

    isLeap = function(){
        return owner.leap;
    }

    getWeekCount = function(start){
        return ..math.ceil((owner.indexOf(owner.firstJulianDay.getWeek().getIndex() - start, 7) + owner.getDayCount()) / 7);
    }

    getName = function(){
        return (owner.leap ? '闰' : '') ++ self.NAMES[owner.month];
    }

    toString = function(){
        return tostring(owner.year) ++ owner.getName();
    }

    next = function(n){
        if(n === 0){
            return self.fromYm(owner.getYear(), owner.getMonthWithLeap());
        }
        var m = owner.indexInYear + 1 + n;
        var y = owner.year;
        if(n > 0){
            var monthCount = y.getMonthCount();
            while(m > monthCount){
                m -= monthCount;
                y = y.next(1);
                monthCount = y.getMonthCount();
            }
        }
        else {
            while(m <= 0){
                y = y.next(-1);
                m += y.getMonthCount();
            }
        }
        var leap = false;
        var leapMonth = y.getLeapMonth();
        if(leapMonth > 0){
            if(m === leapMonth + 1){
                leap = true;
            }
            if(m > leapMonth){
                m--;
            }
        }
        return self.fromYm(y.getYear(), leap ? -m : m);
    }

    getDays = function(){
        var y = owner.getYear();
        var m = owner.getMonthWithLeap();
        var l = {};
        for(i=1; owner.getDayCount()){
            ..table.push(l, LunarDay.fromYmd(y, m, i));
        }
        return l;
    }

    getWeeks = function(start){
        var y = owner.getYear();
        var m = owner.getMonthWithLeap();
        var l = {};
        for(i=0; owner.getWeekCount(start) - 1){
            ..table.push(l, LunarWeek.fromYm(y, m, i, start));
        }
        return l;
    }

    getSixtyCycle = function(){
        return SixtyCycle.fromName(HeavenStem.fromIndex(owner.year.getSixtyCycle().getHeavenStem().getIndex() * 2 + owner.month + 1).getName() ++ EarthBranch.fromIndex(owner.month + 1).getName());
    }

    getNineStar = function(){
        var index = owner.getSixtyCycle().getEarthBranch().getIndex();
        if(index < 2){
            index += 3;
        }
        return NineStar.fromIndex(27 - owner.year.getSixtyCycle().getEarthBranch().getIndex() % 3 * 3 - index);
    }

    getJupiterDirection = function(){
        var sixtyCycle = owner.getSixtyCycle();
        var n = ([7,-1,1,3])[sixtyCycle.getEarthBranch().next(-2).getIndex() % 4 + 1];
        return n !== -1 ? Direction.fromIndex(n) : sixtyCycle.getHeavenStem().getDirection();
    }

    getFetus = function(){
        return FetusMonth.fromLunarMonth(owner);
    }

    getMinorRen = function(){
        return MinorRen.fromIndex((owner.month - 1) % 6);
    }
}

var LunarMonth = LunarMonth;
SolarDay.LunarMonth = LunarMonth;

namespace LunarMonth {
    cache = {};
    NAMES = ['正月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];

    fromYm = function(year, month){
        var m;
        var key = tostring(year) ++ tostring(month);
        var cache = self.cache[key];
        if(cache){
            m = LunarMonth(0, 0, cache);
        }
        else {
            m = LunarMonth(year, month);
            self.cache[key] = [m.getYear(), m.getMonthWithLeap(), m.getDayCount(), m.getIndexInYear(), m.getFirstJulianDay().getDay()];
        }
        return m;
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}


/*****intellisense(time.tyme)
NineStar = 九星
NineStar.fromIndex(.(index) = 根据索引创建九星对象\n参数 @index 为索引值(0-8)
NineStar.fromName(.(name) = 根据名称创建九星对象\n参数 @name 为九星名称
TwelveStar = 黄道黑道十二神
TwelveStar.fromIndex(.(index) = 根据索引创建十二神对象\n参数 @index 为索引值(0-11)
TwelveStar.fromName(.(name) = 根据名称创建十二神对象\n参数 @name 为十二神名称
Ecliptic = 黄道黑道
Ecliptic.fromIndex(.(index) = 根据索引创建黄道黑道对象\n参数 @index 为索引值(0-1)
Ecliptic.fromName(.(name) = 根据名称创建黄道黑道对象\n参数 @name 为黄道黑道名称
LunarYear = 农历年
LunarYear.fromYear(.(year) = 根据年份创建农历年对象\n参数 @year 为年份(-1至9999)
LunarSeason = 农历季节
LunarSeason.fromIndex(.(index) = 根据索引创建农历季节对象\n参数 @index 为索引值(0-11)
LunarSeason.fromName(.(name) = 根据名称创建农历季节对象\n参数 @name 为季节名称
FetusMonth = 胎神月
FetusMonth.fromLunarMonth(.(lunarMonth) = 根据农历月创建胎神月对象\n参数 @lunarMonth 为农历月对象
LunarMonth = 农历月
LunarMonth.fromYm(.(year,month) = 根据年月创建农历月对象\n参数 @year 为年份\n参数 @month 为月份(负数表示闰月)
end intellisense*****/

// LunarWeek 类
class LunarWeek {
    ctor(year, month, index, start){
        this = AbstractTyme();
        var i = self.numeric(index, 'lunar week index');
        if(i < 0 || i > 5){
            error("illegal lunar week index: " ++ tostring(index), 2);
        }
        var t = Week.fromIndex(start);
        var m = LunarMonth.fromYm(year, month);
        if(i >= m.getWeekCount(t.getIndex())){
            error("illegal lunar week index: " ++ tostring(index) ++ " in month: " ++ tostring(m), 2);
        }
        this.month = m;
        this.index = i;
        this.start = t;
    }

    getLunarMonth = function(){
        return owner.month;
    }

    getYear = function(){
        return owner.month.getYear();
    }

    getMonth = function(){
        return owner.month.getMonthWithLeap();
    }

    getIndex = function(){
        return owner.index;
    }

    getStart = function(){
        return owner.start;
    }

    getName = function(){
        return self.NAMES[owner.index + 1];
    }

    toString = function(){
        return tostring(owner.month) ++ owner.getName();
    }

    next = function(n){
        var startIndex = owner.start.getIndex();
        if(n === 0){
            return self.fromYm(owner.getYear(), owner.getMonth(), owner.index, startIndex);
        }
        var d = owner.index + n;
        var m = owner.month;
        if(n > 0){
            var weekCount = m.getWeekCount(startIndex);
            while(d >= weekCount){
                d -= weekCount;
                m = m.next(1);
                if(!LunarDay.fromYmd(m.getYear(), m.getMonthWithLeap(), 1).getWeek().equals(owner.start)){
                    d += 1;
                }
                weekCount = m.getWeekCount(startIndex);
            }
        }
        else {
            while(d < 0){
                if(!LunarDay.fromYmd(m.getYear(), m.getMonthWithLeap(), 1).getWeek().equals(owner.start)){
                    d -= 1;
                }
                m = m.next(-1);
                d += m.getWeekCount(startIndex);
            }
        }
        return self.fromYm(m.getYear(), m.getMonthWithLeap(), d, startIndex);
    }

    getFirstDay = function(){
        var firstDay = LunarDay.fromYmd(owner.getYear(), owner.getMonth(), 1);
        return firstDay.next(owner.index * 7 - owner.indexOf(firstDay.getWeek().getIndex() - owner.start.getIndex(), 7));
    }

    getDays = function(){
        var l = {};
        var d = owner.getFirstDay();
        ..table.push(l, d);
        for(i=1; 6){
            ..table.push(l, d.next(i));
        }
        return l;
    }

    equals = function(o){
        return o && o.getFirstDay().equals(owner.getFirstDay());
    }
}

var LunarWeek = LunarWeek;
namespace LunarWeek {
    NAMES = ['第一周', '第二周', '第三周', '第四周', '第五周', '第六周'];

    fromYm = function(year, month, index, start){
        return LunarWeek(year, month, index, start);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

// LunarDay 类
class LunarDay {
    ctor(year, month, day){
        this = AbstractTyme();
        var m = LunarMonth.fromYm(year, month);
        var d = self.numeric(day, 'lunar day');
        if(d < 1 || d > m.getDayCount()){
            error("illegal day " ++ tostring(day) ++ " in " ++ tostring(m), 2);
        }
        this.month = m;
        this.day = d;
    }

    getLunarMonth = function(){
        return owner.month;
    }

    getYear = function(){
        return owner.month.getYear();
    }

    getMonth = function(){
        return owner.month.getMonthWithLeap();
    }

    getDay = function(){
        return owner.day;
    }

    getName = function(){
        return self.NAMES[owner.day];
    }

    toString = function(){
        return tostring(owner.month) ++ owner.getName();
    }

    next = function(n){
        return owner.getSolarDay().next(n).getLunarDay();
    }

    isBefore = function(target){
        var aYear = owner.getYear();
        var bYear = target.getYear();
        if(aYear !== bYear){
            return aYear < bYear;
        }
        var aMonth = owner.getMonth();
        var bMonth = target.getMonth();
        if(aMonth !== bMonth){
            return ..math.abs(aMonth) < ..math.abs(bMonth);
        }
        return owner.day < target.getDay();
    }

    isAfter = function(target){
        var aYear = owner.getYear();
        var bYear = target.getYear();
        if(aYear !== bYear){
            return aYear > bYear;
        }
        var aMonth = owner.getMonth();
        var bMonth = target.getMonth();
        if(aMonth != bMonth){
            return ..math.abs(aMonth) >= ..math.abs(bMonth);
        }
        return owner.day > target.getDay();
    }

    getWeek = function(){
        return owner.getSolarDay().getWeek();
    }

    getYearSixtyCycle = function(){
        return owner.getSixtyCycleDay().getYear();
    }

    getMonthSixtyCycle = function(){
        return owner.getSixtyCycleDay().getMonth();
    }

    getSixtyCycle = function(){
        var offset = ..math.modf(owner.month.getFirstJulianDay().next(owner.day - 12).getDay());
        return SixtyCycle.fromName(HeavenStem.fromIndex(offset).getName() ++ EarthBranch.fromIndex(offset).getName());
    }

    getDuty = function(){
        return owner.getSixtyCycleDay().getDuty();
    }

    getTwelveStar = function(){
        return owner.getSixtyCycleDay().getTwelveStar();
    }

    getNineStar = function(){
        var d = owner.getSolarDay();
        var dongZhi = SolarTerm.fromIndex(d.getYear(), 0);
        var dongZhiSolar = dongZhi.getSolarDay();
        var xiaZhiSolar = dongZhi.next(12).getSolarDay();
        var dongZhiSolar2 = dongZhi.next(24).getSolarDay();
        var dongZhiIndex = dongZhiSolar.getLunarDay().getSixtyCycle().getIndex();
        var xiaZhiIndex = xiaZhiSolar.getLunarDay().getSixtyCycle().getIndex();
        var dongZhiIndex2 = dongZhiSolar2.getLunarDay().getSixtyCycle().getIndex();
        var solarShunBai = dongZhiSolar.next(dongZhiIndex > 29 ? 60 - dongZhiIndex : -dongZhiIndex);
        var solarShunBai2 = dongZhiSolar2.next(dongZhiIndex2 > 29 ? 60 - dongZhiIndex2 : -dongZhiIndex2);
        var solarNiZi = xiaZhiSolar.next(xiaZhiIndex > 29 ? 60 - xiaZhiIndex : -xiaZhiIndex);
        var offset = 0;
        if(!d.isBefore(solarShunBai) && d.isBefore(solarNiZi)){
            offset = d.subtract(solarShunBai);
        }
        elseif(!d.isBefore(solarNiZi) && d.isBefore(solarShunBai2)){
            offset = 8 - d.subtract(solarNiZi);
        }
        elseif(!d.isBefore(solarShunBai2)){
            offset = d.subtract(solarShunBai2);
        }
        elseif(d.isBefore(solarShunBai)){
            offset = 8 + solarShunBai.subtract(d);
        }
        return NineStar.fromIndex(offset);
    }

    getJupiterDirection = function(){
        var index = owner.getSixtyCycle().getIndex();
        return index % 12 < 6 ? Element.fromIndex(..math.modf(index / 12)).getDirection() : owner.month.getLunarYear().getJupiterDirection();
    }

    getFetusDay = function(){
        return FetusDay.fromLunarDay(owner);
    }

    getPhaseDay = function(){
        var today = owner.getSolarDay();
        var m = owner.month.next(1);
        var p = Phase.fromIndex(m.getYear(), m.getMonthWithLeap(), 0);
        var d = p.getSolarDay();
        while(d.isAfter(today)){
            p = p.next(-1);
            d = p.getSolarDay();
        }
        return PhaseDay(p, today.subtract(d));
    }

    getPhase = function(){
        return owner.getPhaseDay().getPhase();
    }

    getSolarDay = function(){
        if(!owner.solarDay){
            owner.solarDay = owner.month.getFirstJulianDay().next(owner.day - 1).getSolarDay();
        }
        return owner.solarDay;
    }

    getSixtyCycleDay = function(){
        if(!owner.sixtyCycleDay){
            owner.sixtyCycleDay = owner.getSolarDay().getSixtyCycleDay();
        }
        return owner.sixtyCycleDay;
    }

    getTwentyEightStar = function(){
        return TwentyEightStar.fromIndex(([10,18,26,6,14,22,2])[owner.getSolarDay().getWeek().getIndex() + 1]).next(-7 * owner.getSixtyCycle().getEarthBranch().getIndex());
    }

    getFestival = function(){
        return LunarFestival.fromYmd(owner.getYear(), owner.getMonth(), owner.day);
    }

    getSixStar = function(){
        return SixStar.fromIndex((owner.month.getMonth() + owner.day - 2) % 6);
    }

    getGods = function(){
        return owner.getSixtyCycleDay().getGods();
    }

    getRecommends = function(){
        return owner.getSixtyCycleDay().getRecommends();
    }

    getAvoids = function(){
        return owner.getSixtyCycleDay().getAvoids();
    }

    getHours = function(){
        var l = {};
        var y = owner.getYear();
        var m = owner.getMonth();
        ..table.push(l, LunarHour.fromYmdHms(y, m, owner.day, 0, 0, 0));
        for(i=0; 24; 2){
            ..table.push(l, LunarHour.fromYmdHms(y, m, owner.day, i + 1, 0, 0));
        }
        return l;
    }

    getMinorRen = function(){
        return owner.getLunarMonth().getMinorRen().next(owner.day - 1);
    }

    getThreePillars = function(){
        return owner.getSixtyCycleDay().getThreePillars();
    }
}

var LunarDay = LunarDay;
SolarDay.LunarDay = LunarDay;

namespace LunarDay {
    NAMES = [
        '初一', '初二', '初三', '初四', '初五', '初六', '初七', '初八', '初九', '初十',
        '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十',
        '廿一', '廿二', '廿三', '廿四', '廿五', '廿六', '廿七', '廿八', '廿九', '三十'
    ];

    fromYmd = function(year, month, day){
        return LunarDay(year, month, day);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

// SixtyCycleYear 类
class SixtyCycleYear {
    ctor(year){
        this = AbstractTyme();
        var y = self.numeric(year, 'sixty cycle year');
        if(y < -1 || y > 9999){
            error("illegal sixty cycle year: " ++ tostring(year), 2);
        }
        this.year = y;
    }

    getYear = function(){
        return owner.year;
    }

    getName = function(){
        return owner.getSixtyCycle().getName() ++ "年";
    }

    next = function(n){
        return self.fromYear(owner.year + n);
    }

    getSixtyCycle = function(){
        return SixtyCycle.fromIndex(owner.year - 4);
    }

    getTwenty = function(){
        return Twenty.fromIndex(..math.floor((owner.year - 1864) / 20));
    }

    getNineStar = function(){
        return NineStar.fromIndex(63 + owner.getTwenty().getSixty().getIndex() * 3 - owner.getSixtyCycle().getIndex());
    }

    getJupiterDirection = function(){
        var directions = [0,7,7,2,3,3,8,1,1,6,0,0];
        return Direction.fromIndex(directions[owner.getSixtyCycle().getEarthBranch().getIndex() + 1]);
    }

    getFirstMonth = function(){
        var h = HeavenStem.fromIndex((owner.getSixtyCycle().getHeavenStem().getIndex() + 1) * 2);
        return SixtyCycleMonth(owner, SixtyCycle.fromName(h.getName() ++ '寅'));
    }

    getMonths = function(){
        var l = {};
        var m = owner.getFirstMonth();
        ..table.push(l, m);
        for(i=1; 11){
            ..table.push(l, m.next(i));
        }
        return l;
    }
}

var SixtyCycleYear = SixtyCycleYear;
namespace SixtyCycleYear {
    fromYear = function(year){
        return SixtyCycleYear(year);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

// SixtyCycleMonth 类
class SixtyCycleMonth {
    ctor(year, month){
        this = AbstractTyme();
        this.year = year;
        this.month = month;
    }

    getSixtyCycleYear = function(){
        return owner.year;
    }

    getYear = function(){
        return owner.year.getSixtyCycle();
    }

    getIndexInYear = function(){
        return owner.month.getEarthBranch().next(-2).getIndex();
    }

    getName = function(){
        return owner.month.getName() ++ "月";
    }

    toString = function(){
        return tostring(owner.year) ++ owner.getName();
    }

    next = function(n){
        return SixtyCycleMonth(SixtyCycleYear.fromYear(..math.floor((owner.year.getYear() * 12 + owner.getIndexInYear() + n) / 12)), owner.month.next(n));
    }

    getFirstDay = function(){
        return SixtyCycleDay.fromSolarDay(SolarTerm.fromIndex(owner.year.getYear(), 3 + owner.getIndexInYear() * 2).getSolarDay());
    }

    getDays = function(){
        var l = {};
        var d = owner.getFirstDay();
        while(d.getSixtyCycleMonth().equals(owner)){
            ..table.push(l, d);
            d = d.next(1);
        }
        return l;
    }

    getSixtyCycle = function(){
        return owner.month;
    }

    getNineStar = function(){
        var index = owner.getSixtyCycle().getEarthBranch().getIndex();
        if(index < 2){
            index += 3;
        }
        return NineStar.fromIndex(27 - owner.year.getSixtyCycle().getEarthBranch().getIndex() % 3 * 3 - index);
    }

    getJupiterDirection = function(){
        var sixtyCycle = owner.getSixtyCycle();
        var n = ([7,-1,1,3])[sixtyCycle.getEarthBranch().next(-2).getIndex() % 4 + 1];
        return n === -1 ? sixtyCycle.getHeavenStem().getDirection() : Direction.fromIndex(n);
    }
}

var SixtyCycleMonth = SixtyCycleMonth;
namespace SixtyCycleMonth {
    fromIndex = function(year, index){
        return SixtyCycleYear.fromYear(year).getFirstMonth().next(self.numeric(index, 'index'));
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

/*****intellisense(time.tyme)
LunarWeek = 农历周
LunarWeek.fromYm(.(year,month,index,start) = 根据年月周索引创建农历周对象\n参数 @year 为年份\n参数 @month 为月份\n参数 @index 为周索引(0-5)\n参数 @start 为起始星期
LunarDay = 农历日
LunarDay.fromYmd(.(year,month,day) = 根据年月日创建农历日对象\n参数 @year 为年份\n参数 @month 为月份(负数表示闰月)\n参数 @day 为日期(1-30)
SixtyCycleYear = 干支年
SixtyCycleYear.fromYear(.(year) = 根据年份创建干支年对象\n参数 @year 为年份(-1至9999)
SixtyCycleMonth = 干支月
SixtyCycleMonth.fromIndex(.(year,index) = 根据年份和索引创建干支月对象\n参数 @year 为年份\n参数 @index 为月索引(0-11)
end intellisense*****/

// SixtyCycleDay 类
class SixtyCycleDay {
    ctor(solarDay, month, day){
        this = AbstractTyme();
        this.solarDay = solarDay;
        this.month = month;
        this.day = day;
    }

    getSolarDay = function(){
        return owner.solarDay;
    }

    getSixtyCycleMonth = function(){
        return owner.month;
    }

    getYear = function(){
        return owner.month.getYear();
    }

    getMonth = function(){
        return owner.month.getSixtyCycle();
    }

    getSixtyCycle = function(){
        return owner.day;
    }

    getName = function(){
        return owner.day.getName() ++ "日";
    }

    toString = function(){
        return tostring(owner.month) ++ owner.getName();
    }

    next = function(n){
        return self.fromSolarDay(owner.solarDay.next(n));
    }

    getDuty = function(){
        return Duty.fromIndex(owner.getSixtyCycle().getEarthBranch().getIndex() - owner.getMonth().getEarthBranch().getIndex());
    }

    getTwelveStar = function(){
        return TwelveStar.fromIndex(owner.getSixtyCycle().getEarthBranch().getIndex() + (8 - owner.getMonth().getEarthBranch().getIndex() % 6) * 2);
    }

    getNineStar = function(){
        var solar = owner.getSolarDay();
        var dongZhi = SolarTerm.fromIndex(solar.getYear(), 0);
        var dongZhiSolar = dongZhi.getSolarDay();
        var xiaZhiSolar = dongZhi.next(12).getSolarDay();
        var dongZhiSolar2 = dongZhi.next(24).getSolarDay();
        var dongZhiIndex = dongZhiSolar.getLunarDay().getSixtyCycle().getIndex();
        var xiaZhiIndex = xiaZhiSolar.getLunarDay().getSixtyCycle().getIndex();
        var dongZhiIndex2 = dongZhiSolar2.getLunarDay().getSixtyCycle().getIndex();
        var solarShunBai = dongZhiSolar.next(dongZhiIndex > 29 ? 60 - dongZhiIndex : -dongZhiIndex);
        var solarShunBai2 = dongZhiSolar2.next(dongZhiIndex2 > 29 ? 60 - dongZhiIndex2 : -dongZhiIndex2);
        var solarNiZi = xiaZhiSolar.next(xiaZhiIndex > 29 ? 60 - xiaZhiIndex : -xiaZhiIndex);
        var offset = 0;
        if(!solar.isBefore(solarShunBai) && solar.isBefore(solarNiZi)){
            offset = solar.subtract(solarShunBai);
        }
        elseif(!solar.isBefore(solarNiZi) && solar.isBefore(solarShunBai2)){
            offset = 8 - solar.subtract(solarNiZi);
        }
        elseif(!solar.isBefore(solarShunBai2)){
            offset = solar.subtract(solarShunBai2);
        }
        elseif(solar.isBefore(solarShunBai)){
            offset = 8 + solarShunBai.subtract(solar);
        }
        return NineStar.fromIndex(offset);
    }

    getJupiterDirection = function(){
        var index = owner.getSixtyCycle().getIndex();
        return index % 12 < 6 ? Element.fromIndex(..math.modf(index / 12)).getDirection() : owner.month.getSixtyCycleYear().getJupiterDirection();
    }

    getFetusDay = function(){
        return FetusDay.fromSixtyCycleDay(owner);
    }

    getTwentyEightStar = function(){
        return TwentyEightStar.fromIndex(([10,18,26,6,14,22,2])[owner.solarDay.getWeek().getIndex() + 1]).next(-7 * owner.day.getEarthBranch().getIndex());
    }

    getGods = function(){
        return God.getDayGods(owner.getMonth(), owner.day);
    }

    getRecommends = function(){
        return Taboo.getDayRecommends(owner.getMonth(), owner.day);
    }

    getAvoids = function(){
        return Taboo.getDayAvoids(owner.getMonth(), owner.day);
    }

    getHours = function(){
        var l = {};
        var d = owner.solarDay.next(-1);
        var h = SixtyCycleHour.fromSolarTime(SolarTime.fromYmdHms(d.getYear(), d.getMonth(), d.getDay(), 23, 0, 0));
        ..table.push(l, h);
        for(i=1; 11){
            h = h.next(7200);
            ..table.push(l, h);
        }
        return l;
    }

    getThreePillars = function(){
        return ThreePillars(owner.getYear(), owner.getMonth(), owner.getSixtyCycle());
    }
}

var SixtyCycleDay = SixtyCycleDay;
namespace SixtyCycleDay {
    fromSolarDay = function(solarDay){
        var solarYear = solarDay.getYear();
        var springSolarDay = SolarTerm.fromIndex(solarYear, 3).getSolarDay();
        var lunarDay = solarDay.getLunarDay();
        var lunarYear = lunarDay.getLunarMonth().getLunarYear();
        if(lunarYear.getYear() == solarYear){
            if(solarDay.isBefore(springSolarDay)){
                lunarYear = lunarYear.next(-1);
            }
        }
        elseif(lunarYear.getYear() < solarYear){
            if(!solarDay.isBefore(springSolarDay)){
                lunarYear = lunarYear.next(1);
            }
        }
        var term = solarDay.getTerm();
        var index = term.getIndex() - 3;
        if(index < 0 && term.getSolarDay().isAfter(springSolarDay)){
            index += 24;
        }
        return SixtyCycleDay(solarDay, SixtyCycleMonth(SixtyCycleYear.fromYear(lunarYear.getYear()), LunarMonth.fromYm(solarYear, 1).getSixtyCycle().next(..math.floor(index * 0.5))), lunarDay.getSixtyCycle());
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

// SixtyCycleHour 类
class SixtyCycleHour {
    ctor(solarTime){
        this = AbstractTyme();
        var solarYear = solarTime.getYear();
        var springSolarTime = SolarTerm.fromIndex(solarYear, 3).getJulianDay().getSolarTime();
        var lunarHour = solarTime.getLunarHour();
        var lunarDay = lunarHour.getLunarDay();
        var lunarYear = lunarDay.getLunarMonth().getLunarYear();
        if(lunarYear.getYear() == solarYear){
            if(solarTime.isBefore(springSolarTime)){
                lunarYear = lunarYear.next(-1);
            }
        }
        elseif(lunarYear.getYear() < solarYear){
            if(!solarTime.isBefore(springSolarTime)){
                lunarYear = lunarYear.next(1);
            }
        }

        var term = solarTime.getTerm();
        var index = term.getIndex() - 3;
        if(index < 0 && term.getJulianDay().getSolarTime().isAfter(SolarTerm.fromIndex(solarYear, 3).getJulianDay().getSolarTime())){
            index += 24;
        }
        var d = lunarDay.getSixtyCycle();
        this.solarTime = solarTime;
        this.day = SixtyCycleDay(solarTime.getSolarDay(), SixtyCycleMonth(SixtyCycleYear.fromYear(lunarYear.getYear()), LunarMonth.fromYm(solarYear, 1).getSixtyCycle().next(..math.floor(index * 0.5))), solarTime.getHour() < 23 ? d : d.next(1));
        this.hour = lunarHour.getSixtyCycle();
    }

    getYear = function(){
        return owner.day.getYear();
    }

    getMonth = function(){
        return owner.day.getMonth();
    }

    getDay = function(){
        return owner.day.getSixtyCycle();
    }

    getSixtyCycle = function(){
        return owner.hour;
    }

    getSixtyCycleDay = function(){
        return owner.day;
    }

    getSolarTime = function(){
        return owner.solarTime;
    }

    getName = function(){
        return owner.hour.getName() ++ "时";
    }

    toString = function(){
        return tostring(owner.day) ++ owner.getName();
    }

    getIndexInDay = function(){
        var h = owner.solarTime.getHour();
        return h === 23 ? 0 : ..math.modf((h + 1) / 2);
    }

    next = function(n){
        return self.fromSolarTime(owner.solarTime.next(n));
    }

    getTwelveStar = function(){
        return TwelveStar.fromIndex(owner.hour.getEarthBranch().getIndex() + (8 - owner.getDay().getEarthBranch().getIndex() % 6) * 2);
    }

    getNineStar = function(){
        var solar = owner.solarTime.getSolarDay();
        var dongZhi = SolarTerm.fromIndex(solar.getYear(), 0);
        var earthBranchIndex = owner.getIndexInDay() % 12;
        var index = ([8,5,2])[owner.getDay().getEarthBranch().getIndex() % 3 + 1];
        if(!solar.isBefore(dongZhi.getJulianDay().getSolarDay()) && solar.isBefore(dongZhi.next(12).getJulianDay().getSolarDay())){
            index = 8 + earthBranchIndex - index;
        }
        else {
            index -= earthBranchIndex;
        }
        return NineStar.fromIndex(index);
    }

    getEightChar = function(){
        return EightChar(owner.getYear(), owner.getMonth(), owner.getDay(), owner.hour);
    }

    getRecommends = function(){
        return Taboo.getHourRecommends(owner.getDay(), owner.hour);
    }

    getAvoids = function(){
        return Taboo.getHourAvoids(owner.getDay(), owner.hour);
    }
}

var SixtyCycleHour = SixtyCycleHour;
namespace SixtyCycleHour {
    fromSolarTime = function(solarTime){
        return SixtyCycleHour(solarTime);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

// ThreePillars 类
class ThreePillars {
    ctor(year, month, day){
        this = AbstractCulture();
        this.year = type(year) == "table" ? year : SixtyCycle.fromName(year);
        this.month = type(month) == "table" ? month : SixtyCycle.fromName(month);
        this.day = type(day) == "table" ? day : SixtyCycle.fromName(day);
    }

    getYear = function(){
        return owner.year;
    }

    getMonth = function(){
        return owner.month;
    }

    getDay = function(){
        return owner.day;
    }

    getName = function(){
        return tostring(owner.year) ++ " " ++ tostring(owner.month) ++ " " ++ tostring(owner.day);
    }

    getSolarDays = function(startYear, endYear){
        var l = {};
        var m = owner.month.getEarthBranch().next(-2).getIndex();
        if(!HeavenStem.fromIndex((owner.year.getHeavenStem().getIndex() + 1) * 2 + m).equals(owner.month.getHeavenStem())){
            return l;
        }
        var y = owner.year.next(-57).getIndex() + 1;
        m *= 2;
        var baseYear = startYear - 1;
        if(baseYear > y){
            y += 60 * ..math.modf(..math.ceil((baseYear - y) / 60.0));
        }
        while(y <= endYear){
            var term = SolarTerm.fromIndex(y, 3);
            if(m > 0){
                term = term.next(m);
            }
            var solarDay = term.getSolarDay();
            if(solarDay.getYear() >= startYear){
                var d = owner.day.next(-solarDay.getLunarDay().getSixtyCycle().getIndex()).getIndex();
                if(d > 0){
                    solarDay = solarDay.next(d);
                }
                if(solarDay.getSixtyCycleDay().getThreePillars().equals(owner)){
                    ..table.push(l, solarDay);
                }
            }
            y += 60;
        }
        return l;
    }
}

var ThreePillars = ThreePillars;
namespace ThreePillars {
    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}

// LunarHour 类
class LunarHour {
    ctor(year, month, day, hour, minute, second){
        this = AbstractTyme();
        var h = self.numeric(hour, 'hour');
        if(h < 0 || h > 23){
            error("illegal hour: " ++ tostring(hour), 2);
        }
        var m = self.numeric(minute, 'minute');
        if(m < 0 || m > 59){
            error("illegal minute: " ++ tostring(minute), 2);
        }
        var s = self.numeric(second, 'second');
        if(s < 0 || s > 59){
            error("illegal second: " ++ tostring(second), 2);
        }
        this.day = LunarDay.fromYmd(year, month, day);
        this.hour = h;
        this.minute = m;
        this.second = s;
    }

    getLunarDay = function(){
        return owner.day;
    }

    getYear = function(){
        return owner.day.getYear();
    }

    getMonth = function(){
        return owner.day.getMonth();
    }

    getDay = function(){
        return owner.day.getDay();
    }

    getHour = function(){
        return owner.hour;
    }

    getMinute = function(){
        return owner.minute;
    }

    getSecond = function(){
        return owner.second;
    }

    getName = function(){
        return EarthBranch.fromIndex(owner.getIndexInDay()).getName() ++ "时";
    }

    toString = function(){
        return tostring(owner.day) ++ owner.getSixtyCycle().getName() ++ "时";
    }

    getIndexInDay = function(){
        return ..math.modf((owner.hour + 1) / 2);
    }

    next = function(n){
        if(n == 0){
            return self.fromYmdHms(owner.getYear(), owner.getMonth(), owner.getDay(), owner.hour, owner.minute, owner.second);
        }
        var h = owner.hour + n * 2;
        var diff = h < 0 ? -1 : 1;
        var hour = ..math.abs(h);
        var days = ..math.modf(hour / 24) * diff;
        hour = (hour % 24) * diff;
        if(hour < 0){
            hour += 24;
            days--;
        }
        var d = owner.day.next(days);
        return self.fromYmdHms(d.getYear(), d.getMonth(), d.getDay(), hour, owner.minute, owner.second);
    }

    isBefore = function(target){
        if(!owner.day.equals(target.getLunarDay())){
            return owner.day.isBefore(target.getLunarDay());
        }
        if(owner.hour !== target.getHour()){
            return owner.hour < target.getHour();
        }
        return owner.minute !== target.getMinute() ? owner.minute < target.getMinute() : owner.second < target.getSecond();
    }

    isAfter = function(target){
        if(!owner.day.equals(target.getLunarDay())){
            return owner.day.isAfter(target.getLunarDay());
        }
        if(owner.hour !== target.getHour()){
            return owner.hour > target.getHour();
        }
        return owner.minute !== target.getMinute() ? owner.minute > target.getMinute() : owner.second > target.getSecond();
    }

    getYearSixtyCycle = function(){
        return owner.getSixtyCycleHour().getYear();
    }

    getMonthSixtyCycle = function(){
        return owner.getSixtyCycleHour().getMonth();
    }

    getDaySixtyCycle = function(){
        return owner.getSixtyCycleHour().getDay();
    }

    getSixtyCycle = function(){
        var earthBranchIndex = owner.getIndexInDay() % 12;
        var d = owner.day.getSixtyCycle();
        if(owner.hour >= 23){
            d = d.next(1);
        }
        return SixtyCycle.fromName(HeavenStem.fromIndex(d.getHeavenStem().getIndex() % 5 * 2 + earthBranchIndex).getName() ++ EarthBranch.fromIndex(earthBranchIndex).getName());
    }

    getTwelveStar = function(){
        return TwelveStar.fromIndex(owner.getSixtyCycle().getEarthBranch().getIndex() + (8 - owner.getSixtyCycleHour().getDay().getEarthBranch().getIndex() % 6) * 2);
    }

    getNineStar = function(){
        var solar = owner.day.getSolarDay();
        var dongZhi = SolarTerm.fromIndex(solar.getYear(), 0);
        var earthBranchIndex = owner.getIndexInDay() % 12;
        var index = ([8,5,2])[owner.day.getSixtyCycle().getEarthBranch().getIndex() % 3 + 1];
        if(!solar.isBefore(dongZhi.getJulianDay().getSolarDay()) && solar.isBefore(dongZhi.next(12).getJulianDay().getSolarDay())){
            index = 8 + earthBranchIndex - index;
        }
        else {
            index -= earthBranchIndex;
        }
        return NineStar.fromIndex(index);
    }

    getSolarTime = function(){
        if(!owner.solarTime){
            var d = owner.day.getSolarDay();
            owner.solarTime = SolarTime.fromYmdHms(d.getYear(), d.getMonth(), d.getDay(), owner.hour, owner.minute, owner.second);
        }
        return owner.solarTime;
    }

    getSixtyCycleHour = function(){
        if(!owner.sixtyCycleHour){
            owner.sixtyCycleHour = owner.getSolarTime().getSixtyCycleHour();
        }
        return owner.sixtyCycleHour;
    }

    getEightChar = function(){
        return self.provider.getEightChar(owner);
    }

    getRecommends = function(){
        return Taboo.getHourRecommends(owner.getSixtyCycleHour().getDay(), owner.getSixtyCycle());
    }

    getAvoids = function(){
        return Taboo.getHourAvoids(owner.getSixtyCycleHour().getDay(), owner.getSixtyCycle());
    }

    getMinorRen = function(){
        return owner.getLunarDay().getMinorRen().next(owner.getIndexInDay());
    }
}

var LunarHour = LunarHour;
namespace LunarHour {
    provider = null;

    fromYmdHms = function(year, month, day, hour, minute, second){
        return LunarHour(year, month, day, hour, minute, second);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

/*****intellisense(time.tyme)
SixtyCycleDay = 干支日
SixtyCycleDay.fromSolarDay(.(solarDay) = 根据公历日创建干支日对象\n参数 @solarDay 为公历日对象
SixtyCycleHour = 干支时
SixtyCycleHour.fromSolarTime(.(solarTime) = 根据公历时间创建干支时对象\n参数 @solarTime 为公历时间对象
ThreePillars = 三柱
LunarHour = 农历时
LunarHour.fromYmdHms(.(year,month,day,hour,minute,second) = 根据年月日时分秒创建农历时对象\n参数 @year 为年份\n参数 @month 为月份(负数表示闰月)\n参数 @day 为日期\n参数 @hour 为小时(0-23)\n参数 @minute 为分钟(0-59)\n参数 @second 为秒(0-59)
end intellisense*****/

// JulianDay 类
class JulianDay {
    ctor(day){
        this = AbstractTyme();
        this.day = self.numeric(day, 'julian day');
    }

    getDay = function(){
        return owner.day;
    }

    getName = function(){
        return tostring(owner.day);
    }

    next = function(n){
        return self.fromJulianDay(owner.day + n);
    }

    getSolarDay = function(){
        return owner.getSolarTime().getSolarDay();
    }

    getSolarTime = function(){
        var d = ..math.modf(owner.day + 0.5);
        var f = owner.day + 0.5 - d;

        if(d >= 2299161){
            var c = ..math.modf((d - 1867216.25) / 36524.25);
            d += 1 + c - ..math.modf(c * 0.25);
        }
        d += 1524;
        var y = ..math.modf((d - 122.1) / 365.25);
        d -= ..math.modf(365.25 * y);
        var m = ..math.modf(d / 30.601);
        d -= ..math.modf(30.601 * m);
        if(m > 13){
            m -= 12;
        }
        else {
            y -= 1;
        }
        m -= 1;
        y -= 4715;
        f *= 24;
        var hour = ..math.modf(f);

        f -= hour;
        f *= 60;
        var minute = ..math.modf(f);

        f -= minute;
        f *= 60;
        var second = ..math.modf(f + 0.5);
        return second < 60 ? SolarTime.fromYmdHms(y, m, d, hour, minute, second) : SolarTime.fromYmdHms(y, m, d, hour, minute, second - 60).next(60);
    }

    getWeek = function(){
        return Week.fromIndex(..math.modf(owner.day + 0.5) + 7000001);
    }

    subtract = function(target){
        return owner.day - target.getDay();
    }
}

var JulianDay = JulianDay;
Phase.JulianDay = JulianDay;
LunarMonth.JulianDay = JulianDay;
SolarDay.JulianDay = JulianDay;
Phenology.JulianDay = JulianDay;
SolarTerm.JulianDay = JulianDay;

namespace JulianDay {
    J2000 = 2451545;

    fromJulianDay = function(day){
        return JulianDay(day);
    }

    fromYmdHms = function(year, month, day, hour, minute, second){
        var y = self.numeric(year, 'year');
        var m = self.numeric(month, 'month');
        var h = self.numeric(hour, 'hour');
        var i = self.numeric(minute, 'minute');
        var s = self.numeric(second, 'second');
        var d = self.numeric(day, 'day') + ((s / 60 + i) / 60 + h) / 24;
        var n = 0;
        var g = y * 372 + m * 31 + ..math.modf(d) >= 588829;
        if(m <= 2){
            m += 12;
            y--;
        }
        if(g){
            n = ..math.modf(y * 0.01);
            n = 2 - n + ..math.modf(n * 0.25);
        }
        return self.fromJulianDay(..math.modf(365.25 * (y + 4716)) + ..math.modf(30.6001 * (m + 1)) + d + n - 1524.5);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}

// ShouXingUtil 工具类
namespace ShouXingUtil {
    PI_2 = 2 * ..math.pi;
    ONE_THIRD = 1.0 / 3;
    SECOND_PER_DAY = 86400;
    SECOND_PER_RAD = 648000 / ..math.pi;

    DT_AT = ..time.tyme.data.DT_AT; 
    XL0 = ..time.tyme.data.XL0; 
    XL1 = ..time.tyme.data.XL1
    QI_KB = ..time.tyme.data.QI_KB;
    QB = ..time.tyme.data.QB;
    SB = ..time.tyme.data.SB;

    NUT_B = [
        2.1824, -33.75705, 36e-6, -1720, 920,
        3.5069, 1256.66393, 11e-6, -132, 57,
        1.3375, 16799.4182, -51e-6, -23, 10,
        4.3649, -67.5141, 72e-6, 21, -9,
        0.04, -628.302, 0, -14, 0,
        2.36, 8328.691, 0, 7, 0,
        3.46, 1884.966, 0, -5, 2,
        5.44, 16833.175, 0, -4, 2,
        3.69, 25128.110, 0, -3, 0,
        3.55, 628.362, 0, 2, 0
    ];

    SHUO_KB = [
        1457698.231017, 29.53067166, 
        1546082.512234, 29.53085106, 
        1640640.735300, 29.53060000, 
        1642472.151543, 29.53085439, 
        1683430.509300, 29.53086148, 
        1752148.041079, 29.53085097, 
        1807665.420323, 29.53059851, 
        1883618.114100, 29.53060000, 
        1907360.704700, 29.53060000, 
        1936596.224900, 29.53060000, 
        1939135.675300, 29.53060000, 
        1947168.00
    ];

    nutationLon2 = function(t){
        var a = -1.742 * t;
        var t2 = t * t;
        var dl = 0;
        for(i=1; #self.NUT_B; 5){
            dl += (self.NUT_B[i + 3] + a) * ..math.sin(self.NUT_B[i] + self.NUT_B[i + 1] * t + self.NUT_B[i + 2] * t2);
            a = 0;
        }
        return dl / 100 / self.SECOND_PER_RAD;
    }

    eLon = function(t, n){
        t /= 10;
        var v = 0;
        var tn = 1;
        var n1, n2;
        var c;
        var n0;
        var m0 = self.XL0[3] - self.XL0[2];
        for(i=1; 6){
            n1 = ..math.modf(self.XL0[1 + i]);
            n2 = ..math.modf(self.XL0[2 + i]);
            n0 = n2 - n1;
            if(n0 === 0){
                tn *= t;
                continue;
            }
            var m;
            if(n < 0){
                m = n2;
            }
            else {
                m = ..math.modf((3 * n * n0 / m0 + 0.5) + n1);
                if(i != 1){
                    m += 3;
                }
                if(m > n2){
                    m = n2;
                }
            }
            c = 0;
            for(j=n1; m - 1; 3){
                c += self.XL0[j + 1] * ..math.cos(self.XL0[j + 2] + t * self.XL0[j + 3]);
            }
            v += c * tn;
            tn *= t;
        }
        v /= self.XL0[1];
        var t2 = t * t;
        return v + (-0.0728 - 2.7702 * t - 1.1019 * t2 - 0.0996 * t2 * t) / self.SECOND_PER_RAD;
    }

    mLon = function(t, n){
        var obl = #self.XL1[1];
        var tn = 1;
        var v = 0;
        var j;
        var c;
        var t2 = t * t;
        var t3 = t2 * t;
        var t4 = t3 * t;
        var t5 = t4 * t;
        var tx = t - 10;
        v += (3.81034409 + 8399.684730072 * t - 3.319e-05 * t2 + 3.11e-08 * t3 - 2.033e-10 * t4) * self.SECOND_PER_RAD;
        v += 5028.792262 * t + 1.1124406 * t2 + 0.00007699 * t3 - 0.000023479 * t4 - 0.0000000178 * t5;
        if(tx > 0){
            v += -0.866 + 1.43 * tx + 0.054 * tx * tx;
        }
        t2 /= 1e4;
        t3 /= 1e8;
        t4 /= 1e8;

        n *= 6;
        if(n < 0){
            n = obl;
        }
        for(i=1; #self.XL1){
            var f = self.XL1[i];
            var l = #f;
            var m = ..math.modf((n * l / obl + 0.5));
            if(i > 1){
                m += 6;
            }
            if(m >= l){
                m = l;
            }
            c = 0;
            for(j=1; m; 6){
                c += f[j] * ..math.cos(f[j + 1] + t * f[j + 2] + t2 * f[j + 3] + t3 * f[j + 4] + t4 * f[j + 5]);
            }
            v += c * tn;
            tn *= t;
        }
        return v / self.SECOND_PER_RAD;
    }

    gxcSunLon = function(t){
        var t2 = t * t;
        return -20.49552 * (1 + (0.016708634 - 0.000042037 * t - 0.0000001267 * t2) * ..math.cos(-0.043126 + 628.301955 * t - 0.000002732 * t2)) / self.SECOND_PER_RAD;
    }

    ev = function(t){
        var f = 628.307585 * t;
        return 628.332 + 21 * ..math.sin(1.527 + f) + 0.44 * ..math.sin(1.48 + f * 2) + 0.129 * ..math.sin(5.82 + f) * t + 0.00055 * ..math.sin(4.21 + f) * t * t;
    }

    saLon = function(t, n){
        return self.eLon(t, n) + self.nutationLon2(t) + self.gxcSunLon(t) + ..math.pi;
    }

    dtExt = function(y, jsd){
        var dy = (y - 1820) / 100;
        return -20 + jsd * dy * dy;
    }

    dtCalc = function(y){
        var size = #self.DT_AT;
        var y0 = self.DT_AT[size - 1];
        var t0 = self.DT_AT[size];
        if(y >= y0){
            var jsd = 31;
            if(y > y0 + 100){
                return self.dtExt(y, jsd);
            }
            return self.dtExt(y, jsd) - (self.dtExt(y0, jsd) - t0) * (y0 + 100 - y) / 100;
        }
        var i;
        for(j=1; size; 5){
            i = j;
            if(y < self.DT_AT[j + 5]){
                break;
            }
        }
        var t1 = (y - self.DT_AT[i]) / (self.DT_AT[i + 5] - self.DT_AT[i]) * 10;
        var t2 = t1 * t1;
        var t3 = t2 * t1;
        return self.DT_AT[i + 1] + self.DT_AT[i + 2] * t1 + self.DT_AT[i + 3] * t2 + self.DT_AT[i + 4] * t3;
    }

    dtT = function(t){
        return self.dtCalc(t / 365.2425 + 2000) / self.SECOND_PER_DAY;
    }

    mv = function(t){
        var v = 8399.71 - 914 * ..math.sin(0.7848 + 8328.691425 * t + 0.0001523 * t * t);
        return v - (179 * ..math.sin(2.543 + 15542.7543 * t) + 160 * ..math.sin(0.1874 + 7214.0629 * t) + 62 * ..math.sin(3.14 + 16657.3828 * t) + 34 * ..math.sin(4.827 + 16866.9323 * t) + 22 * ..math.sin(4.9 + 23871.4457 * t) + 12 * ..math.sin(2.59 + 14914.4523 * t) + 7 * ..math.sin(0.23 + 6585.7609 * t) + 5 * ..math.sin(0.9 + 25195.624 * t) + 5 * ..math.sin(2.32 - 7700.3895 * t) + 5 * ..math.sin(3.88 + 8956.9934 * t) + 5 * ..math.sin(0.49 + 7771.3771 * t));
    }

    saLonT = function(w){
        var v = 628.3319653318;
        var t = (w - 1.75347 - ..math.pi) / v;
        v = self.ev(t);
        t += (w - self.saLon(t, 10)) / v;
        return t + (w - self.saLon(t, -1)) / self.ev(t);
    }

    msaLon = function(t, mn, sn){
        return self.mLon(t, mn) + (-3.4E-6) - (self.eLon(t, sn) + self.gxcSunLon(t) + ..math.pi);
    }

    msaLonT = function(w){
        var v = 7771.37714500204;
        var t = (w + 1.08472) / v;
        t += (w - self.msaLon(t, 3, 3)) / v;
        v = self.mv(t) - self.ev(t);
        t += (w - self.msaLon(t, 20, 10)) / v;
        return t + (w - self.msaLon(t, -1, 60)) / v;
    }

    saLonT2 = function(w){
        var v = 628.3319653318;
        var t = (w - 1.75347 - ..math.pi) / v;
        t -= (0.000005297 * t * t + 0.0334166 * ..math.cos(4.669257 + 628.307585 * t) + 0.0002061 * ..math.cos(2.67823 + 628.307585 * t) * t) / v;
        return t + (w - self.eLon(t, 8) - ..math.pi + (20.5 + 17.2 * ..math.sin(2.1824 - 33.75705 * t)) / self.SECOND_PER_RAD) / v;
    }

    msaLonT2 = function(w){
        var v = 7771.37714500204;
        var t = (w + 1.08472) / v;
        var t2 = t * t;
        t -= (-0.00003309 * t2 + 0.10976 * ..math.cos(0.784758 + 8328.6914246 * t + 0.000152292 * t2) + 0.02224 * ..math.cos(0.18740 + 7214.0628654 * t - 0.00021848 * t2) - 0.03342 * ..math.cos(4.669257 + 628.307585 * t)) / v;
        t2 = t * t;
        var l = self.mLon(t, 20) - (4.8950632 + 628.3319653318 * t + 0.000005297 * t2 + 0.0334166 * ..math.cos(4.669257 + 628.307585 * t) + 0.0002061 * ..math.cos(2.67823 + 628.307585 * t) * t + 0.000349 * ..math.cos(4.6261 + 1256.61517 * t) - 20.5 / self.SECOND_PER_RAD);
        v = 7771.38 - 914 * ..math.sin(0.7848 + 8328.691425 * t + 0.0001523 * t2) - 179 * ..math.sin(2.543 + 15542.7543 * t) - 160 * ..math.sin(0.1874 + 7214.0629 * t);
        return t + (w - l) / v;
    }

    qiHigh = function(w){
        var t = self.saLonT2(w) * 36525;
        t = t - self.dtT(t) + self.ONE_THIRD;
        var v = ((t + 0.5) % 1) * self.SECOND_PER_DAY;
        if(v < 1200 || v > self.SECOND_PER_DAY - 1200){
            t = self.saLonT(w) * 36525 - self.dtT(t) + self.ONE_THIRD;
        }
        return t;
    }

    shuoHigh = function(w){
        var t = self.msaLonT2(w) * 36525;
        t = t - self.dtT(t) + self.ONE_THIRD;
        var v = ((t + 0.5) % 1) * self.SECOND_PER_DAY;
        if(v < 1800 || v > self.SECOND_PER_DAY - 1800){
            t = self.msaLonT(w) * 36525 - self.dtT(t) + self.ONE_THIRD;
        }
        return t;
    }

    qiLow = function(w){
        var v = 628.3319653318;
        var t = (w - 4.895062166) / v;
        t -= (53 * t * t + 334116 * ..math.cos(4.67 + 628.307585 * t) + 2061 * ..math.cos(2.678 + 628.3076 * t) * t) / v / 10000000;
        var n = 48950621.66 + 6283319653.318 * t + 53 * t * t + 334166 * ..math.cos(4.669257 + 628.307585 * t) + 3489 * ..math.cos(4.6261 + 1256.61517 * t) + 2060.6 * ..math.cos(2.67823 + 628.307585 * t) * t - 994 - 834 * ..math.sin(2.1824 - 33.75705 * t);
        t -= (n / 10000000 - w) / 628.332 + (32 * (t + 1.8) * (t + 1.8) - 20) / self.SECOND_PER_DAY / 36525;
        return t * 36525 + self.ONE_THIRD;
    }

    shuoLow = function(w){
        var v = 7771.37714500204;
        var t = (w + 1.08472) / v;
        t -= (-0.0000331 * t * t + 0.10976 * ..math.cos(0.785 + 8328.6914 * t) + 0.02224 * ..math.cos(0.187 + 7214.0629 * t) - 0.03342 * ..math.cos(4.669 + 628.3076 * t)) / v + (32 * (t + 1.8) * (t + 1.8) - 20) / self.SECOND_PER_DAY / 36525;
        return t * 36525 + self.ONE_THIRD;
    }

    calcShuo = function(jd){
        var size = #self.SHUO_KB;
        var d = 0;
        var pc = 14;
        jd += JulianDay.J2000;
        var f1 = self.SHUO_KB[1] - pc;
        var f2 = self.SHUO_KB[size] - pc;
        var f3 = 2436935;
        if(jd < f1 || jd >= f3){
            d = ..math.floor(self.shuoHigh(..math.floor((jd + pc - 2451551) / 29.5306) * self.PI_2) + 0.5);
        }
        elseif(jd >= f1 && jd < f2){
            var index;
            for(i=1; size; 2){
                index = i;
                if(jd + pc < self.SHUO_KB[i + 2]){
                    break;
                }
            }
            d = self.SHUO_KB[index] + self.SHUO_KB[index + 1] * ..math.floor((jd + pc - self.SHUO_KB[index]) / self.SHUO_KB[index + 1]);
            d = ..math.fxloor(d + 0.5);
            if(d === 1683460){
                d++;
            }
            d -= JulianDay.J2000;
        }
        elseif(jd >= f2 && jd < f3){
            var n = ..string.charCodeAt(self.SB, ..math.floor((jd - f2) / 29.5306) + 1);
            d = ..math.floor(self.shuoLow(..math.floor((jd + pc - 2451551) / 29.5306) * self.PI_2) + 0.5);
            if(49 === n){
                d += 1;
            }
            elseif(50 === n){
                d -= 1;
            }
        }
        return d;
    }

    calcQi = function(jd){
        var size = #self.QI_KB;
        var d = 0;
        var pc = 7;
        jd += JulianDay.J2000;
        var f1 = self.QI_KB[1] - pc;
        var f2 = self.QI_KB[size] - pc;
        var f3 = 2436935;
        if(jd < f1 || jd >= f3){
            d = ..math.floor(self.qiHigh(..math.floor((jd + pc - 2451259) / 365.2422 * 24) * ..math.pi / 12) + 0.5);
        }
        elseif(jd >= f1 && jd < f2){
            var index;
            for(i=1; size; 2){
                index = i;
                if(jd + pc < self.QI_KB[i + 2]){
                    break;
                }
            }
            d = self.QI_KB[index] + self.QI_KB[index + 1] * ..math.floor((jd + pc - self.QI_KB[index]) / self.QI_KB[index + 1]);
            d = ..math.floor(d + 0.5);
            if(d === 1683460){
                d++;
            }
            d -= JulianDay.J2000;
        }
        elseif(jd >= f2 && jd < f3){
            d = ..math.floor(self.qiLow(..math.floor((jd + pc - 2451259) / 365.2422 * 24) * ..math.pi / 12) + 0.5);
            var n = ..string.charCodeAt(self.QB, ..math.floor((jd - f2) / 365.2422 * 24) + 1);
            if(49 === n){
                d += 1;
            }
            elseif(50 === n){
                d -= 1;
            }
        }
        return d;
    }

    qiAccurate = function(w){
        var t = self.saLonT(w) * 36525;
        return t - self.dtT(t) + self.ONE_THIRD;
    }

    qiAccurate2 = function(jd){
        var d = ..math.pi / 12;
        var w = ..math.floor((jd + 293) / 365.2422 * 24) * d;
        var a = self.qiAccurate(w);
        if(a - jd > 5){
            return self.qiAccurate(w - d);
        }
        return a - jd < -5 ? self.qiAccurate(w + d) : a;
    }
}
var ShouXingUtil = ShouXingUtil;
LunarMonth.ShouXingUtil = ShouXingUtil;
SolarTerm.ShouXingUtil = ShouXingUtil;

/*****intellisense(time.tyme)
JulianDay = 儒略日
JulianDay.fromJulianDay(.(day) = 根据儒略日数创建儒略日对象\n参数 @day 为儒略日数
JulianDay.fromYmdHms(.(year,month,day,hour,minute,second) = 根据年月日时分秒创建儒略日对象\n参数 @year 为年份\n参数 @month 为月份\n参数 @day 为日期\n参数 @hour 为小时\n参数 @minute 为分钟\n参数 @second 为秒
SixtyCycleDay = 干支日
SixtyCycleDay.fromSolarDay(.(solarDay) = 根据公历日创建干支日对象\n参数 @solarDay 为公历日对象
SixtyCycleHour = 干支时
SixtyCycleHour.fromSolarTime(.(solarTime) = 根据公历时间创建干支时对象\n参数 @solarTime 为公历时间对象
ThreePillars = 三柱(年月日)
ShouXingUtil = 寿星天文历算工具类
end intellisense*****/


// LegalHoliday 类
class LegalHoliday {
    ctor(year, month, day, data){
        this = AbstractTyme();
        this.day = SolarDay.fromYmd(year, month, day);
        this.work = ..string.charCodeAt(data, 9) === 48;
        this.name = self.NAMES[..string.charCodeAt(data, 10) - 48 + 1];
    }

    getName = function(){
        return owner.name;
    }

    getDay = function(){
        return owner.day;
    }

    isWork = function(){
        return owner.work;
    }

    toString = function(){
        return tostring(owner.day) ++ " " ++ owner.name ++ "(" ++ (owner.work ? "班" : "休") ++ ")";
    }

    next = function(n){
        var year = owner.day.getYear();
        var month = owner.day.getMonth();
        var day = owner.day.getDay();
        if(n === 0){
            return self.fromYmd(year, month, day);
        }
        var ys = ..string.format("%04d", year);
        var ms = (month < 10 ? '0' : '') ++ tostring(month);
        var ds = (day < 10 ? '0' : '') ++ tostring(day);

        var data = {};
        var today = ys ++ ms ++ ds;
        var pattern = ys ++ "\\d{4}[0-1][0-8][+|-]\\d{2}";
        for matcher in ..string.gmatch(self.DATA, pattern){
            ..table.push(data, matcher);
        }
        var index = -1;
        var size = #data;
        for(i=1; size){
            if(..string.find(data[i], today) === 1){
                index = i;
                break;
            }
        }
        if(index === -1){
            return null;
        }
        index += n;
        var y = year;
        if(n > 0){
            while(index > size){
                index -= size;
                y += 1;
                data = {};
                ys = ..string.format("%04d", y);
                pattern = ys ++ "\\d{4}[0-1][0-8][+|-]\\d{2}";
                for matcher in ..string.gmatch(self.DATA, pattern){
                    ..table.push(data, matcher);
                }
                size = #data;
                if(size < 1){
                    return null;
                }
            }
        }
        else {
            while(index < 1){
                y -= 1;
                data = {};
                ys = ..string.format("%04d", y);
                pattern = ys ++ "\\d{4}[0-1][0-8][+|-]\\d{2}";
                for matcher in ..string.gmatch(self.DATA, pattern){
                    ..table.push(data, matcher);
                }
                size = #data;
                if(size < 1){
                    return null;
                }
                index += size;
            }
        }
        var d = data[index];
        return LegalHoliday(tonumber(..string.slice(d, 1, 4)), tonumber(..string.slice(d, 5, 6)), tonumber(..string.slice(d, 7, 8)), d);
    }
}

var LegalHoliday = LegalHoliday;
namespace LegalHoliday {
    NAMES = ['元旦节', '春节', '清明节', '劳动节', '端午节', '中秋节', '国庆节', '国庆中秋', '抗战胜利日'];
    DATA = ..time.tyme.data.LegalHoliday_Data;
    
    fromYmd = function(year, month, day){
        var y = ..string.format("%04d", year);
        var m = (month < 10 ? '0' : '') ++ tostring(month);
        var d = (day < 10 ? '0' : '') ++ tostring(day);
        var matcher = ..string.match(self.DATA, y ++ m ++ d ++ "[0-1][0-8][+|-]\\d{2}");
        if(!matcher){
            return null;
        }
        return LegalHoliday(year, month, day, matcher);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}


// SolarFestival 类
class SolarFestival {
    ctor(typ, day, startYear, data){
        this = AbstractTyme();
        this.type = typ;
        this.day = day;
        this.startYear = startYear;
        this.index = tonumber(..string.slice(data, 2, 3));
        this.name = self.NAMES[this.index + 1];
    }

    getName = function(){
        return owner.name;
    }

    getIndex = function(){
        return owner.index;
    }

    getDay = function(){
        return owner.day;
    }

    getType = function(){
        return owner.type;
    }

    getStartYear = function(){
        return owner.startYear;
    }

    toString = function(){
        return tostring(owner.day) ++ " " ++ owner.name;
    }

    next = function(n){
        var size = #self.NAMES;
        var i = owner.index + n;
        return self.fromIndex(..math.modf((owner.day.getYear() * size + i) / size), owner.indexOf(i, size));
    }
}

var SolarFestival = SolarFestival;
namespace SolarFestival {
    NAMES = ['元旦', '三八妇女节', '植树节', '五一劳动节', '五四青年节', '六一儿童节', '建党节', '八一建军节', '教师节', '国庆节'];
    DATA = '@00001011950@01003081950@02003121979@03005011950@04005041950@05006011950@06007011941@07008011933@08009101985@09010011950';

    fromIndex = function(year, index){
        if(index < 0 || index >= #self.NAMES){
            error("illegal index: " ++ tostring(index), 2);
        }
        var is = (index < 10 ? '0' : '') ++ tostring(index);
        var matcher = ..string.match(self.DATA, "@" ++ is ++ "\\d+");
        if(matcher){
            var data = matcher;
            var typ = ..string.charCodeAt(data, 4) - 48;
            if(typ === 0){
                var startYear = tonumber(..string.slice(data, 9));
                if(year >= startYear){
                    return SolarFestival(FestivalType.DAY, SolarDay.fromYmd(year, tonumber(..string.slice(data, 5, 6)), tonumber(..string.slice(data, 7, 8))), startYear, data);
                }
            }
        }
        return null;
    }

    fromYmd = function(year, month, day){
        var m = (month < 10 ? '0' : '') ++ tostring(month);
        var d = (day < 10 ? '0' : '') ++ tostring(day);
        var matcher = ..string.match(self.DATA, "@\\d{2}0" ++ m ++ d ++ "\\d+");
        if(matcher){
            var data = matcher;
            var startYear = tonumber(..string.slice(data, 9));
            if(year >= startYear){
                return SolarFestival(FestivalType.DAY, SolarDay.fromYmd(year, month, day), startYear, data);
            }
        }
        return null;
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}


// LunarFestival 类
class LunarFestival {
    ctor(typ, day, solarTerm, data){
        this = AbstractTyme();
        this.type = typ;
        this.day = day;
        this.solarTerm = solarTerm;
        this.index = tonumber(..string.slice(data, 2, 3));
        this.name = self.NAMES[this.index + 1];
    }

    getName = function(){
        return owner.name;
    }

    getIndex = function(){
        return owner.index;
    }

    getDay = function(){
        return owner.day;
    }

    getType = function(){
        return owner.type;
    }

    getSolarTerm = function(){
        return owner.solarTerm;
    }

    toString = function(){
        return tostring(owner.day) ++ " " ++ owner.name;
    }

    next = function(n){
        var size = #self.NAMES;
        var i = owner.index + n;
        return self.fromIndex(..math.modf((owner.day.getYear() * size + i) / size), owner.indexOf(i, size));
    }
}

var LunarFestival = LunarFestival;
namespace LunarFestival {
    NAMES = ['春节', '元宵节', '龙头节', '上巳节', '清明节', '端午节', '七夕节', '中元节', '中秋节', '重阳节', '冬至节', '腊八节', '除夕'];
    DATA = '@0000101@0100115@0200202@0300303@04107@0500505@0600707@0700715@0800815@0900909@10124@1101208@122';

    fromIndex = function(year, index){
        if(index < 0 || index >= #self.NAMES){
            error("illegal index: " ++ tostring(index), 2);
        }
        var is = (index < 10 ? '0' : '') ++ tostring(index);
        var matcher = ..string.match(self.DATA, "@" ++ is ++ "\\d+");
        if(matcher){
            var data = matcher;
            var typ = ..string.charCodeAt(data, 4) - 48;
            select(typ){
                case 0 {
                    return LunarFestival(FestivalType.DAY, LunarDay.fromYmd(year, tonumber(..string.slice(data, 5, 6)), tonumber(..string.slice(data, 7))), null, data);
                }
                case 1 {
                    var solarTerm = SolarTerm.fromIndex(year, tonumber(..string.slice(data, 5)));
                    return LunarFestival(FestivalType.TERM, solarTerm.getSolarDay().getLunarDay(), solarTerm, data);
                }
                case 2 {
                    return LunarFestival(FestivalType.EVE, LunarDay.fromYmd(year + 1, 1, 1).next(-1), null, data);
                }
            }
        }
        return null;
    }

    fromYmd = function(year, month, day){
        var m = (month < 10 ? '0' : '') ++ tostring(month);
        var d = (day < 10 ? '0' : '') ++ tostring(day);
        var matcher = ..string.match(self.DATA, "@\\d{2}0" ++ m ++ d);
        if(matcher){
            return LunarFestival(FestivalType.DAY, LunarDay.fromYmd(year, month, day), null, matcher);
        }
        for matcher in ..string.gmatch(self.DATA, "@\\d{2}1\\d{2}"){
            var data = matcher;
            var solarTerm = SolarTerm.fromIndex(year, tonumber(..string.slice(data, 5)));
            var lunarDay = solarTerm.getSolarDay().getLunarDay();
            if(lunarDay.getYear() === year && lunarDay.getMonth() === month && lunarDay.getDay() === day){
                return LunarFestival(FestivalType.TERM, lunarDay, solarTerm, data);
            }
        }
        matcher = ..string.match(self.DATA, "@\\d{2}2");
        if(matcher){
            var lunarDay = LunarDay.fromYmd(year, month, day);
            var nextDay = lunarDay.next(1);
            if(nextDay.getMonth() === 1 && nextDay.getDay() === 1){
                return LunarFestival(FestivalType.EVE, lunarDay, null, matcher);
            }
        }
        return null;
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}


/*****intellisense(time.tyme)
LegalHoliday = 法定节假日
LegalHoliday.fromYmd(.(year,month,day) = 根据年月日获取法定节假日\n参数 @year 为年份\n参数 @month 为月份\n参数 @day 为日期\n返回节假日对象或null
SolarFestival = 公历节日
SolarFestival.fromIndex(.(year,index) = 根据年份和索引创建公历节日对象\n参数 @year 为年份\n参数 @index 为节日索引
SolarFestival.fromYmd(.(year,month,day) = 根据年月日获取公历节日\n参数 @year 为年份\n参数 @month 为月份\n参数 @day 为日期\n返回节日对象或null
LunarFestival = 农历节日
LunarFestival.fromIndex(.(year,index) = 根据年份和索引创建农历节日对象\n参数 @year 为年份\n参数 @index 为节日索引
LunarFestival.fromYmd(.(year,month,day) = 根据年月日获取农历节日\n参数 @year 为年份\n参数 @month 为月份\n参数 @day 为日期\n返回节日对象或null
end intellisense*****/

// EightChar 类
class EightChar {
    ctor(year, month, day, hour){
        this = AbstractCulture();
        this.threePillars = ThreePillars(year, month, day);
        this.hour = type(hour) == "table" ? hour : SixtyCycle.fromName(hour);
    }

    getYear = function(){
        return owner.threePillars.getYear();
    }

    getMonth = function(){
        return owner.threePillars.getMonth();
    }

    getDay = function(){
        return owner.threePillars.getDay();
    }

    getHour = function(){
        return owner.hour;
    }

    getFetalOrigin = function(){
        var m = owner.getMonth();
        return SixtyCycle.fromName(m.getHeavenStem().next(1).getName() ++ m.getEarthBranch().next(3).getName());
    }

    getFetalBreath = function(){
        var d = owner.getDay();
        return SixtyCycle.fromName(d.getHeavenStem().next(5).getName() ++ EarthBranch.fromIndex(13 - d.getEarthBranch().getIndex()).getName());
    }

    getOwnSign = function(){
        var m = owner.getMonth().getEarthBranch().getIndex() - 1;
        if(m < 1){
            m += 12;
        }
        var h = owner.hour.getEarthBranch().getIndex() - 1;
        if(h < 1){
            h += 12;
        }
        var offset = m + h;
        offset = (offset >= 14 ? 26 : 14) - offset;
        return SixtyCycle.fromName(HeavenStem.fromIndex((owner.getYear().getHeavenStem().getIndex() + 1) * 2 + offset - 1).getName() ++ EarthBranch.fromIndex(offset + 1).getName());
    }

    getBodySign = function(){
        var offset = owner.getMonth().getEarthBranch().getIndex() - 1;
        if(offset < 1){
            offset += 12;
        }
        offset += owner.hour.getEarthBranch().getIndex() + 1;
        if(offset > 12){
            offset -= 12;
        }
        return SixtyCycle.fromName(HeavenStem.fromIndex((owner.getYear().getHeavenStem().getIndex() + 1) * 2 + offset - 1).getName() ++ EarthBranch.fromIndex(offset + 1).getName());
    }

    getDuty = function(){
        return Duty.fromIndex(owner.getDay().getEarthBranch().getIndex() - owner.getMonth().getEarthBranch().getIndex());
    }

    getName = function(){
        return tostring(owner.threePillars) ++ " " ++ tostring(owner.hour);
    }

    getSolarTimes = function(startYear, endYear){
        var l = {};
        var year = owner.getYear();
        var month = owner.getMonth();
        var day = owner.getDay();
        var m = month.getEarthBranch().next(-2).getIndex();
        if(!HeavenStem.fromIndex((year.getHeavenStem().getIndex() + 1) * 2 + m).equals(month.getHeavenStem())){
            return l;
        }
        var y = year.next(-57).getIndex() + 1;
        m *= 2;
        var h = owner.hour.getEarthBranch().getIndex() * 2;
        var hours = h == 0 ? [0,23] : [h];
        var baseYear = startYear - 1;
        if(baseYear > y){
            y += 60 * ..math.modf(..math.ceil((baseYear - y) / 60.0));
        }
        while(y <= endYear){
            var term = SolarTerm.fromIndex(y, 3);
            if(m > 0){
                term = term.next(m);
            }
            var solarTime = term.getJulianDay().getSolarTime();
            if(solarTime.getYear() >= startYear){
                var solarDay = solarTime.getSolarDay();
                var d = day.next(-solarDay.getLunarDay().getSixtyCycle().getIndex()).getIndex();
                if(d > 0){
                    solarDay = solarDay.next(d);
                }
                for(i=1; #hours){
                    var mi = 0;
                    var s = 0;
                    var hour = hours[i];
                    if(d == 0 && hour == solarTime.getHour()){
                        mi = solarTime.getMinute();
                        s = solarTime.getSecond();
                    }
                    var time = SolarTime.fromYmdHms(solarDay.getYear(), solarDay.getMonth(), solarDay.getDay(), hour, mi, s);
                    if(d == 30){
                        time = ..time.next(-3600);
                    }
                    if(..time.getLunarHour().getEightChar().equals(owner)){
                        ..table.push(l, time);
                    }
                }
            }
            y += 60;
        }
        return l;
    }
}

namespace EightChar {
    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var EightChar = EightChar;

// ChildLimitInfo 类
class ChildLimitInfo {
    ctor(startTime, endTime, yearCount, monthCount, dayCount, hourCount, minuteCount){
        this = AbstractCulture();
        this.startTime = startTime;
        this.endTime = endTime;
        this.yearCount = yearCount;
        this.monthCount = monthCount;
        this.dayCount = dayCount;
        this.hourCount = hourCount;
        this.minuteCount = minuteCount;
    }

    getStartTime = function(){
        return owner.startTime;
    }

    getEndTime = function(){
        return owner.endTime;
    }

    getYearCount = function(){
        return owner.yearCount;
    }

    getMonthCount = function(){
        return owner.monthCount;
    }

    getDayCount = function(){
        return owner.dayCount;
    }

    getHourCount = function(){
        return owner.hourCount;
    }

    getMinuteCount = function(){
        return owner.minuteCount;
    }

    getName = function(){
        return tostring(owner.yearCount) ++ "年" ++ tostring(owner.monthCount) ++ "月" ++ tostring(owner.dayCount) ++ "日" ++ tostring(owner.hourCount) ++ "时" ++ tostring(owner.minuteCount) ++ "分";
    }
}

namespace ChildLimitInfo {
    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var ChildLimitInfo = ChildLimitInfo;

// AbstractChildLimitProvider 类
class AbstractChildLimitProvider {
    ctor(){
        this = AbstractCulture();
    }

    next = function(birthTime, addYear, addMonth, addDay, addHour, addMinute, addSecond){
        var d = birthTime.getDay() + addDay;
        var h = birthTime.getHour() + addHour;
        var mi = birthTime.getMinute() + addMinute;
        var s = birthTime.getSecond() + addSecond;
        mi += ..math.modf(s / 60);
        s %= 60;
        h += ..math.modf(mi / 60);
        mi %= 60;
        d += ..math.modf(h / 24);
        h %= 24;

        var sm = SolarMonth.fromYm(birthTime.getYear() + addYear, birthTime.getMonth()).next(addMonth);

        var dc = sm.getDayCount();
        while(d > dc){
            d -= dc;
            sm = sm.next(1);
            dc = sm.getDayCount();
        }

        return ChildLimitInfo(birthTime, SolarTime.fromYmdHms(sm.getYear(), sm.getMonth(), d, h, mi, s), addYear, addMonth, addDay, addHour, addMinute);
    }
}

namespace AbstractChildLimitProvider {
    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var AbstractChildLimitProvider = AbstractChildLimitProvider;

// DefaultChildLimitProvider 类
class DefaultChildLimitProvider {
    ctor(){
        this = AbstractChildLimitProvider();
    }

    getInfo = function(birthTime, term){
        var seconds = ..math.abs(term.getJulianDay().getSolarTime().subtract(birthTime));
        var year = ..math.modf(seconds / 259200);
        seconds %= 259200;
        var month = ..math.modf(seconds / 21600);
        seconds %= 21600;
        var day = ..math.modf(seconds / 720);
        seconds %= 720;
        var hour = ..math.modf(seconds / 30);
        seconds %= 30;
        var minute = seconds * 2;

        return owner.next(birthTime, year, month, day, hour, minute, 0);
    }
}

namespace DefaultChildLimitProvider {
    indexOf = AbstractChildLimitProvider.indexOf;
    numeric = AbstractChildLimitProvider.numeric;
}
var DefaultChildLimitProvider = DefaultChildLimitProvider;

// China95ChildLimitProvider 类
class China95ChildLimitProvider {
    ctor(){
        this = AbstractChildLimitProvider();
    }

    getInfo = function(birthTime, term){
        var minutes = ..math.modf(..math.abs(term.getJulianDay().getSolarTime().subtract(birthTime)) / 60);
        var year = ..math.modf(minutes / 4320);
        minutes %= 4320;
        var month = ..math.modf(minutes / 360);
        minutes %= 360;
        var day = ..math.modf(minutes / 12);
        return owner.next(birthTime, year, month, day, 0, 0, 0);
    }
}

namespace China95ChildLimitProvider {
    indexOf = AbstractChildLimitProvider.indexOf;
    numeric = AbstractChildLimitProvider.numeric;
}
var China95ChildLimitProvider = China95ChildLimitProvider;

// LunarSect1ChildLimitProvider 类
class LunarSect1ChildLimitProvider {
    ctor(){
        this = AbstractChildLimitProvider();
    }

    getInfo = function(birthTime, term){
        var termTime = term.getJulianDay().getSolarTime();
        var $end = termTime;
        var start = birthTime;
        if(birthTime.isAfter(termTime)){
            $end = birthTime;
            start = termTime;
        }
        var endTimeZhiIndex = ($end.getHour() == 23) ? 11 : $end.getLunarHour().getIndexInDay();
        var startTimeZhiIndex = (start.getHour() == 23) ? 11 : start.getLunarHour().getIndexInDay();
        var hourDiff = endTimeZhiIndex - startTimeZhiIndex;
        var dayDiff = $end.getSolarDay().subtract(start.getSolarDay());
        if(hourDiff < 0){
            hourDiff += 12;
            dayDiff--;
        }
        var monthDiff = ..math.modf(hourDiff * 10 / 30);
        var month = dayDiff * 4 + monthDiff;
        var day = hourDiff * 10 - monthDiff * 30;
        var year = ..math.modf(month / 12);
        month = month - year * 12;
        return owner.next(birthTime, year, month, day, 0, 0, 0);
    }
}

namespace LunarSect1ChildLimitProvider {
    indexOf = AbstractChildLimitProvider.indexOf;
    numeric = AbstractChildLimitProvider.numeric;
}
var LunarSect1ChildLimitProvider = LunarSect1ChildLimitProvider;

// LunarSect2ChildLimitProvider 类
class LunarSect2ChildLimitProvider {
    ctor(){
        this = AbstractChildLimitProvider();
    }

    getInfo = function(birthTime, term){
        var minutes = ..math.modf(..math.abs(term.getJulianDay().getSolarTime().subtract(birthTime)) / 60);
        var year = ..math.modf(minutes / 4320);
        minutes %= 4320;
        var month = ..math.modf(minutes / 360);
        minutes %= 360;
        var day = ..math.modf(minutes / 12);
        minutes %= 12;
        var hour = minutes * 2;
        return owner.next(birthTime, year, month, day, hour, 0, 0);
    }
}

namespace LunarSect2ChildLimitProvider {
    indexOf = AbstractChildLimitProvider.indexOf;
    numeric = AbstractChildLimitProvider.numeric;
}
var LunarSect2ChildLimitProvider = LunarSect2ChildLimitProvider;

// ChildLimit 类
class ChildLimit {
    ctor(birthTime, gender){
        this = AbstractCulture();
        this.gender = gender;
        this.eightChar = birthTime.getLunarHour().getEightChar();
        var yang = YinYang.YANG == this.eightChar.getYear().getHeavenStem().getYinYang();
        var man = Gender.MAN == gender;
        this.forward = (yang && man) || (!yang && !man);
        var term = birthTime.getTerm();
        if(!term.isJie()){
            term = term.next(-1);
        }
        if(this.forward){
            term = term.next(2);
        }
        this.info = self.provider.getInfo(birthTime, term);
    }

    getEightChar = function(){
        return owner.eightChar;
    }

    getGender = function(){
        return owner.gender;
    }

    getYearCount = function(){
        return owner.info.getYearCount();
    }

    getMonthCount = function(){
        return owner.info.getMonthCount();
    }

    getDayCount = function(){
        return owner.info.getDayCount();
    }

    getHourCount = function(){
        return owner.info.getHourCount();
    }

    getMinuteCount = function(){
        return owner.info.getMinuteCount();
    }

    getStartTime = function(){
        return owner.info.getStartTime();
    }

    getEndTime = function(){
        return owner.info.getEndTime();
    }

    isForward = function(){
        return owner.forward;
    }

    getStartDecadeFortune = function(){
        return DecadeFortune.fromChildLimit(owner, 0);
    }

    getDecadeFortune = function(){
        return DecadeFortune.fromChildLimit(owner, -1);
    }

    getStartFortune = function(){
        return Fortune.fromChildLimit(owner, 0);
    }

    getEndLunarYear = function(){
        return LunarYear.fromYear(owner.getStartTime().getLunarHour().getYear() + owner.getEndTime().getYear() - owner.getStartTime().getYear());
    }

    getStartSixtyCycleYear = function(){
        return SixtyCycleYear.fromYear(owner.getStartTime().getYear());
    }

    getEndSixtyCycleYear = function(){
        return SixtyCycleYear.fromYear(owner.getEndTime().getYear());
    }

    getStartAge = function(){
        return 1;
    }

    getEndAge = function(){
        var n = owner.getEndSixtyCycleYear().getYear() - owner.getStartSixtyCycleYear().getYear();
        return ..math.max(n, 1);
    }

    getName = function(){
        return owner.info.getName();
    }
}

namespace ChildLimit {
    provider = DefaultChildLimitProvider();

    fromSolarTime = function(birthTime, gender){
        return ChildLimit(birthTime, gender);
    }

    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var ChildLimit = ChildLimit;

// DecadeFortune 类
class DecadeFortune {
    ctor(childLimit, index){
        this = AbstractTyme();
        this.childLimit = childLimit;
        this.index = index;
    }

    getStartAge = function(){
        return owner.childLimit.getEndSixtyCycleYear().getYear() - owner.childLimit.getStartSixtyCycleYear().getYear() + 1 + owner.index * 10;
    }

    getEndAge = function(){
        return owner.getStartAge() + 9;
    }

    getStartLunarYear = function(){
        return owner.childLimit.getEndLunarYear().next(owner.index * 10);
    }

    getEndLunarYear = function(){
        return owner.getStartLunarYear().next(9);
    }

    getStartSixtyCycleYear = function(){
        return owner.childLimit.getEndSixtyCycleYear().next(owner.index * 10);
    }

    getEndSixtyCycleYear = function(){
        return owner.getStartSixtyCycleYear().next(9);
    }

    getSixtyCycle = function(){
        return owner.childLimit.getEightChar().getMonth().next(owner.childLimit.isForward() ? owner.index + 1 : -owner.index - 1);
    }

    getName = function(){
        return owner.getSixtyCycle().getName();
    }

    next = function(n){
        return self.fromChildLimit(owner.childLimit, owner.index + n);
    }

    getStartFortune = function(){
        return Fortune.fromChildLimit(owner.childLimit, owner.index * 10);
    }
}

namespace DecadeFortune {
    fromChildLimit = function(childLimit, index){
        return DecadeFortune(childLimit, index);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}
var DecadeFortune = DecadeFortune;

// Fortune 类
class Fortune {
    ctor(childLimit, index){
        this = AbstractTyme();
        this.childLimit = childLimit;
        this.index = index;
    }

    getAge = function(){
        return owner.childLimit.getEndSixtyCycleYear().getYear() - owner.childLimit.getStartSixtyCycleYear().getYear() + 1 + owner.index;
    }

    getLunarYear = function(){
        return owner.childLimit.getEndLunarYear().next(owner.index);
    }

    getSixtyCycleYear = function(){
        return owner.childLimit.getEndSixtyCycleYear().next(owner.index);
    }

    getSixtyCycle = function(){
        var n = owner.getAge();
        return owner.childLimit.getEightChar().getHour().next(owner.childLimit.isForward() ? n : -n);
    }

    getName = function(){
        return owner.getSixtyCycle().getName();
    }

    next = function(n){
        return self.fromChildLimit(owner.childLimit, owner.index + n);
    }
}

namespace Fortune {
    fromChildLimit = function(childLimit, index){
        return Fortune(childLimit, index);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}
var Fortune = Fortune;

// DefaultEightCharProvider 类
class DefaultEightCharProvider {
    ctor(){
        this = AbstractCulture();
    }

    getEightChar = function(hour){
        return hour.getSixtyCycleHour().getEightChar();
    }
}

namespace DefaultEightCharProvider {
    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var DefaultEightCharProvider = DefaultEightCharProvider;

// LunarSect2EightCharProvider 类
class LunarSect2EightCharProvider {
    ctor(){
        this = AbstractCulture();
    }

    getEightChar = function(hour){
        var h = hour.getSixtyCycleHour();
        return EightChar(h.getYear(), h.getMonth(), hour.getLunarDay().getSixtyCycle(), h.getSixtyCycle());
    }
}

namespace LunarSect2EightCharProvider {
    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var LunarSect2EightCharProvider = LunarSect2EightCharProvider;

// 设置默认的八字提供者
LunarHour.provider = DefaultEightCharProvider();

/*****intellisense(time.tyme)
EightChar = 八字
ChildLimitInfo = 童限信息
AbstractChildLimitProvider = 抽象童限提供者
DefaultChildLimitProvider = 默认童限提供者
China95ChildLimitProvider = 95派童限提供者
LunarSect1ChildLimitProvider = 农历派1童限提供者
LunarSect2ChildLimitProvider = 农历派2童限提供者
ChildLimit = 童限
ChildLimit.fromSolarTime(.(birthTime,gender) = 根据出生时间和性别创建童限对象\n参数 @birthTime 为出生时间对象\n参数 @gender 为性别(Gender.MAN或Gender.WOMAN)
ChildLimit.provider = 童限提供者，默认为DefaultChildLimitProvider
DecadeFortune = 大运
DecadeFortune.fromChildLimit(.(childLimit,index) = 根据童限和索引创建大运对象\n参数 @childLimit 为童限对象\n参数 @index 为大运索引
Fortune = 流年
Fortune.fromChildLimit(.(childLimit,index) = 根据童限和索引创建流年对象\n参数 @childLimit 为童限对象\n参数 @index 为流年索引
DefaultEightCharProvider = 默认八字提供者
LunarSect2EightCharProvider = 农历派2八字提供者
end intellisense*****/

// KitchenGodSteed 类
class KitchenGodSteed {
    ctor(lunarYear){
        this = AbstractCulture();
        this.firstDaySixtyCycle = LunarDay.fromYmd(lunarYear, 1, 1).getSixtyCycle();
    }

    byHeavenStem = function(n){
        return self.NUMBERS[owner.firstDaySixtyCycle.getHeavenStem().stepsTo(n) + 1];
    }

    byEarthBranch = function(n){
        return self.NUMBERS[owner.firstDaySixtyCycle.getEarthBranch().stepsTo(n) + 1];
    }

    getMouse = function(){
        return owner.byEarthBranch(0) ++ "鼠偷粮";
    }

    getGrass = function(){
        return "草子" ++ owner.byEarthBranch(0) ++ "分";
    }

    getCattle = function(){
        return owner.byEarthBranch(1) ++ "牛耕田";
    }

    getFlower = function(){
        return "花收" ++ owner.byEarthBranch(3) ++ "分";
    }

    getDragon = function(){
        return owner.byEarthBranch(4) ++ "龙治水";
    }

    getHorse = function(){
        return owner.byEarthBranch(6) ++ "马驮谷";
    }

    getChicken = function(){
        return owner.byEarthBranch(9) ++ "鸡抢米";
    }

    getSilkworm = function(){
        return owner.byEarthBranch(9) ++ "姑看蚕";
    }

    getPig = function(){
        return owner.byEarthBranch(11) ++ "屠共猪";
    }

    getField = function(){
        return "甲田" ++ owner.byHeavenStem(0) ++ "分";
    }

    getCake = function(){
        return owner.byHeavenStem(2) ++ "人分饼";
    }

    getGold = function(){
        return owner.byHeavenStem(7) ++ "日得金";
    }

    getPeopleCakes = function(){
        return owner.byEarthBranch(2) ++ "人" ++ owner.byHeavenStem(2) ++ "丙";
    }

    getPeopleHoes = function(){
        return owner.byEarthBranch(2) ++ "人" ++ owner.byHeavenStem(3) ++ "锄";
    }

    getName = function(){
        return '灶马头';
    }
}

namespace KitchenGodSteed {
    NUMBERS = ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二'];

    fromLunarYear = function(lunarYear){
        return KitchenGodSteed(lunarYear);
    }

    indexOf = AbstractCulture.indexOf;
    numeric = AbstractCulture.numeric;
}
var KitchenGodSteed = KitchenGodSteed;

// RabByungElement 类
class RabByungElement {
    ctor(indexOrName){
        this = Element(type(indexOrName) == "number" ? indexOrName : ..string.replace(indexOrName, '铁', '金'));
    }

    next = function(n){
        return self.fromIndex(owner.nextIndex(n));
    }

    getReinforce = function(){
        return owner.next(1);
    }

    getRestrain = function(){
        return owner.next(2);
    }

    getReinforced = function(){
        return owner.next(-1);
    }

    getRestrained = function(){
        return owner.next(-2);
    }

    getName = function(){
        var name = this.names[this.index+1];
        return ..string.replace(name, '金', '铁');
    }
}

var RabByungElement = RabByungElement;
namespace RabByungElement {
    fromIndex = function(index){
        return RabByungElement(self.numeric(index, 'rab-byung element index'));
    }

    fromName = function(name){
        return RabByungElement(name);
    }

    indexOf = Element.indexOf;
    indexOfBy = Element.indexOfBy;
    nextIndex = Element.nextIndex;
    numeric = Element.numeric;
}

// RabByungYear 类
class RabByungYear {
    ctor(rabByungIndex, sixtyCycle){
        this = AbstractTyme();
        var index = self.numeric(rabByungIndex, 'rab-byung index');
        if(index < 0 || index > 150){
            error("illegal rab-byung index: " ++ tostring(index), 2);
        }
        this.rabByungIndex = index;
        this.sixtyCycle = sixtyCycle;
    }

    getRabByungIndex = function(){
        return owner.rabByungIndex;
    }

    getSixtyCycle = function(){
        return owner.sixtyCycle;
    }

    getZodiac = function(){
        return owner.getSixtyCycle().getEarthBranch().getZodiac();
    }

    getElement = function(){
        return RabByungElement.fromIndex(owner.getSixtyCycle().getHeavenStem().getElement().getIndex());
    }

    getName = function(){
        var digits = ['零', '一', '二', '三', '四', '五', '六', '七', '八', '九'];
        var units = ['', '十', '百'];
        var n = owner.rabByungIndex + 1;
        var s = '';
        var pos = 0;
        while(n > 0){
            var digit = n % 10;
            if(digit > 0){
                s = digits[digit + 1] ++ units[pos + 1] ++ s;
            }
            elseif(#s > 0){
                s = digits[digit + 1] ++ s;
            }
            n = ..math.floor(n / 10);
            pos++;
        }
        if(..string.find(s, '一十') === 1){
            s = ..string.slice(s, 4);
        }
        return "第" ++ s ++ "饶迥" ++ tostring(owner.getElement()) ++ tostring(owner.getZodiac()) ++ "年";
    }

    next = function(n){
        return self.fromYear(owner.getYear() + n);
    }

    getYear = function(){
        return 1024 + owner.rabByungIndex * 60 + owner.getSixtyCycle().getIndex();
    }

    getLeapMonth = function(){
        var y = 1;
        var m = 4;
        var t = 0;
        var currentYear = owner.getYear();
        while(y < currentYear){
            var i = m - 1 + (t % 2 == 0 ? 33 : 32);
            y = ..math.floor((y * 12 + i) / 12);
            m = i % 12 + 1;
            t++;
        }
        return y == currentYear ? m : 0;
    }

    getSolarYear = function(){
        return SolarYear.fromYear(owner.getYear());
    }

    getFirstMonth = function(){
        return RabByungMonth(owner, 1);
    }

    getMonthCount = function(){
        return owner.getLeapMonth() < 1 ? 12 : 13;
    }

    getMonths = function(){
        var l = {};
        var leapMonth = owner.getLeapMonth();
        for(i=1; 12){
            ..table.push(l, RabByungMonth(owner, i));
            if(i === leapMonth){
                ..table.push(l, RabByungMonth(owner, -i));
            }
        }
        return l;
    }
}

namespace RabByungYear {
    fromYear = function(year){
        var y = self.numeric(year, 'rab-byung year');
        return RabByungYear(..math.floor((y - 1024) / 60), SixtyCycle.fromIndex(y - 4));
    }

    fromElementZodiac = function(rabByungIndex, element, zodiac){
        for(i=0; 59){
            var sixtyCycle = SixtyCycle.fromIndex(i);
            if(sixtyCycle.getEarthBranch().getZodiac().equals(zodiac) && sixtyCycle.getHeavenStem().getElement().getIndex() == element.getIndex()){
                return RabByungYear(rabByungIndex, sixtyCycle);
            }
        }
        error("illegal rab-byung element " ++ element ++ ", zodiac " ++ zodiac, 2);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}
var RabByungYear = RabByungYear;
RabByungYear.RabByungYear = RabByungYear;

// RabByungMonth 类
class RabByungMonth {
    ctor(year, monthNum){
        this = AbstractTyme();
        self.init();
        var month = self.numeric(monthNum, 'rab-byung month');
        if(month == 0 || month > 12 || month < -12){
            error("illegal rab-byung month " ++ tostring(month), 2);
        }
        var y = year.getYear();
        if(y < 1950 || y > 2050){
            error("rab-byung year " ++ tostring(y) ++ " must between 1950 and 2050", 2);
        }
        var m = ..math.abs(month);
        if(y == 1950 && m < 12){
            error("month " ++ tostring(month) ++ " must be 12 in rab-byung year " ++ tostring(y), 2);
        }
        var leap = month < 0;
        var leapMonth = year.getLeapMonth();
        if(leap && m !== leapMonth){
            error("illegal leap month " ++ tostring(m) ++ " in rab-byung year " ++ tostring(y), 2);
        }
        this.year = year;
        this.month = m;
        this.leap = leap;
        var index = m - 1;
        if(leap || (0 < leapMonth && leapMonth < m)){
            index += 1;
        }
        this.indexInYear = index;
    }

    getRabByungYear = function(){
        return owner.year;
    }

    getYear = function(){
        return owner.year.getYear();
    }

    getMonth = function(){
        return owner.month;
    }

    getMonthWithLeap = function(){
        return owner.leap ? -owner.month : owner.month;
    }

    getDayCount = function(){
        return 30 + #owner.getLeapDays() - #owner.getMissDays();
    }

    getIndexInYear = function(){
        return owner.indexInYear;
    }

    isLeap = function(){
        return owner.leap;
    }

    getName = function(){
        return (owner.leap ? '闰' : '') ++ self.NAMES[owner.month];
    }

    getAlias = function(){
        return (owner.leap ? '闰' : '') ++ self.ALIAS[owner.month];
    }

    toString = function(){
        return tostring(owner.year) ++ owner.getName();
    }

    next = function(n){
        if(n === 0){
            return self.fromYm(owner.getYear(), owner.getMonthWithLeap());
        }
        var m = owner.indexInYear + 1 + n;
        var y = owner.year;
        if(n > 0){
            var monthCount = y.getMonthCount();
            while(m > monthCount){
                m -= monthCount;
                y = y.next(1);
                monthCount = y.getMonthCount();
            }
        }
        else {
            while(m <= 0){
                y = y.next(-1);
                m += y.getMonthCount();
            }
        }
        var leap = false;
        var leapMonth = y.getLeapMonth();
        if(leapMonth > 0){
            if(m === leapMonth + 1){
                leap = true;
            }
            if(m > leapMonth){
                m--;
            }
        }
        return self.fromYm(y.getYear(), leap ? -m : m);
    }

    getSpecialDays = function(){
        var days = self.DAYS[tostring(owner.getYear() * 13 + owner.getIndexInYear())];
        return days ? days : {};
    }

    getLeapDays = function(){
        var l = {};
        var days = owner.getSpecialDays();
        for(i=1; #days){
            var d = days[i];
            if(d > 0){
                ..table.push(l, d);
            }
        }
        return l;
    }

    getMissDays = function(){
        var l = {};
        var days = owner.getSpecialDays();
        for(i=1; #days){
            var d = days[i];
            if(d < 0){
                ..table.push(l, -d);
            }
        }
        return l;
    }

    getDays = function(){
        var y = owner.getYear();
        var m = owner.getMonthWithLeap();
        var l = {};
        for(i=1; owner.getDayCount()){
            ..table.push(l, LunarDay.fromYmd(y, m, i));
        }
        return l;
    }
}

namespace RabByungMonth {
    DAYS = {};
    NAMES = ['正月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
    ALIAS = ['神变月', '苦行月', '具香月', '萨嘎月', '作净月', '明净月', '具醉月', '具贤月', '天降月', '持众月', '庄严月', '满意月'];
    isInit = false;

    init = function(){
        if(self.isInit){
            return;
        }
        var y = 1950;
        var m = 11;
        var years = ..string.split('2c>,182[>1:2TA4ZI=n1E2Bk1J2Ff3Mk503Oc62g=,172^>1:2XA1>2UE2Bo1I2Fj3Lo62Fb3Mf5,03N^72b=1:2]A1>2ZF1B2VI2Em1K2Fe,2Lh1R3Na603P\\:172Y>1;2UB2=m2Dq1J2Eh,2Kl1Q3Me603Pa:172^>1;2YA2=p1C2UI,2Dk2Jp3QEc3Mi603Pf:3L[72b?1:2]A1<2UB2XH,2Cn1I2Ei1L2Ie1Q3Na703Q\\:2`@1;2XA,4\\H;m1B2TI2Em1L2Ij1Q3Nf603Q`903QW:,2[@1;2TB2XI1E4TMAh2Io3RFe3Mj603Pc803Q[;,2^?1;2WA2>q1E2Bm1I2Fi1M2Hc3Of70,3P^82a>1:2[A1>2WE1B2TI2Fm1L2Hf3Ni6,03Oa703PZ:3`A62V>4]F;q1B4YJ>l2Eq1L2Gi3Ml5,03Nd603Q_9172[>1;2XB2>p1E2VK2Fl,1K2Fc3Mh603Pc9172`>1;2\\B1>2UD2=j2En,1J2Fg3Mm62Ib3Pj;3M_703R[:2`B1=2YB2=n,1C2TI2Fk1L2Ig1P3Nd703Q_:152X<2[A,2<q1B2WI2Ep1L2Il1Q3Ni703Qc9152[:2^@,1;2WB2>o1E2Bk1I2Fh1M2Ib3Pf803R^9,2a?1;2ZA1>2UE2Bp1I2Fl1M2If3Oi80,3Pa803QY:2^A1>2ZE1B4WJ>j2Fp1M2Hi1N2H`,3Od703Q]:162Y>1;2VB2?o1E4VM@h2Gl1M,2Hd3Ng603Qa9172^>1;2ZB1?2UE2@l2Fo1L,2Gg3Mk62H`3Pf:172c?3QY;2_B1>2YD2?o1E,2TK2Fj1M2Ie1P3Mb703R^;172X=2\\C1>,2TD2WJ2Fn1L2Ij1P3Ng703Rb:162[<2_B1=,2VC2>m1E4TMAh2Io3QFe3Nl82Ja3Qf:152_;0,3RU<2ZB1>2TE2Bn1I2Fj1M2Je3Pk:2K^3Ra:,03RY;2]A1>2XE1B2TI2Fo1M2Ii1P2Ka3Qd8,03R]:3bB62W>4]F:q1B2?n1F4VNAh2Il1O2Jd,3Pg803Q`:162\\=1;2XB1?2TF2Bl2Ho1N,2Ig3Nk703Qd9162`>1;2]B1?2XE2Ao1G2TM,2Hj1M2Id1P3M_603R\\;172W>2\\E1@2TE,2?i2Gm1M2Ih1P3Md603Ra;172[=28q1?2WD,2?m2Fq1M2Il1P3Mi72I^3Re:162_<172W=,2ZC2?q1E2Bk1I2Fh1M2Jd1Q3M^52b;16,2Y<2]B1>2VE2Bp1I2Fm1M2Jh1Q2Lb3Re:15,2\\;3aC62U>2[E1B4WJ>k1F4TNBg2Jl1P2Le3Qh9,03R`:172Z=1:2VB2?q1F2Bk2Ip1P2Jg,1P2J_3Qc:162^=1;2[B1?2WF2Bo1H2Bg2Ij,1O2Jc3Qg:3L\\62c>3QY;3aC72V?2[F1A2TG2Bj,2Hm1N2Jg1P3Mb603R_;182Z>1:2T@2WF2Am,2Gp1M2Ik1P3Mg603Rc;172^>192W?2ZE,2@p1F2Bj2Io3QEe1M2Jb1Q3M]72b=182Z>,2]D1?2VE2Bn1I2Fk1M2Jg1Q3Ma62e<172]=,172U>2YE1B2UI2Fp1N2Jk1Q3Me503M\\6,2`<172Y>3_F:2TB2?n1F2Cj2Jo3QDc2Lh1R,3L_52c;172]=1:2XB1?2UF2Cn1I2Eg2Kk1P,2Lb3Rf;162a=1:2]B1?2ZF1B2TH2Dj2Jm,1O2Kf1Q3M`603Q\\;182Y?2;q1A2WH2Cm,2Hq1O2Ji1P3Me603Qa;182]>1:2WA2[G2Ap,1G2Bi2Im1P3Mi72I_3Qf;3N\\72Eh1:2Z?29o,1@2UF2Bm1I2Fh1M2Je1Q3N`72f?3PY92]>19,2U?2YF2Bq1I2Fm1M2Jj1Q3Nd603O]72`=,182X?4]F:o1B4WI=k1F4UNCi2Jn3REc3Mh503N`6,2c<182\\>1:2VA2?q1F2Cm1J2Fg2Lk1R3Mc5,2f<172`=1:2[A1?2XF2Cq1I2Ek2Kn1R,2Lf1R
3N_62d>3PZ:3aC72W?2;p1B2WI2Dn1J,2De2Ki1Q3Mc603Q_:182\\?1;2VB2<m2Cq1I,2Dh2Jl1P3Mg603Qd;182`?1;2ZA2<p1B,2UH2Cl1I2Ef3Mm82Jc1Q3N_703QY:2]@1;2UA,2XG2Bp1I2Fk1M2Jh1Q3Nc703Q]92`?1:,2X@4\\G:n1B2VI2Fp1M2Jl1R3Ng603P`82d>,192[?1;2UA2>o1F2Ck1J2Gg3Mk603Oc70,3OZ82_>1:2YA1?2VF2Cp1J2Fj1M2Gc3Nf5,03O^72b>1:2^B1?4[G;n1C2VJ2Fn1L2Gf,3Mi503Nb603Q]:172Y?1<2UB2>m2Eq1K2Fi,2Kl1R3Mf603Qa:182^?1;2YB2>q1D2VJ,2Dl1J2Fe3Mj603Qg;3N]72c@3QX;2]A1=2VB,2YI2Co1J2Fi1M2Je1Q3Nb703R]:2aA1<2XA,2<n1C2UI2Fn1M2Jj1Q3Nf703Q`903RX:,2[@1<2TB4YJ>l1E4UNBi1J2Ge3Mk703Pc803Q[9,2^?1;2XB2>q1E2Cn1J2Gj1M2Ic3Of70,3P^82b?1;2\\A1>2XF1C2UJ2Fm1M2Hf3Ni6,03Oa703Q[:3aB72W>1<2TC2?m2Fq1L2Gi3Ml5,03Ne703Q_:172\\>1<2XB2?q1E2WL2Fl,1L2Gd3Ni603Qd:172a?1;2\\B1>2VD2>k,2Eo1K2Gh1M2Ic1Q3N`703R\\;3aC62U=2YC2>o,1D2TJ2Fl1M2Jh1Q3Ne703R`:162Y<2\\B,1=2TC4XJ=j2Fp1M2Jm3QFc3Ni803Qc:152\\;2_A,1<2WB2>o1E2Bl1J2Gh1N2Jc3Qg903R^:,2b@1;2[B1>2VE2Cq1J2Gl1N2Jf3Pj80,3Qa803RZ;2_B1>4[F:o1C4XK?k2Fp1M2Ii1O2Ia,3Pd703R^:172Y>1<2VC2?p1F2Ai2Hl1M,2Hd3Oh703Qb:172^>1<2[C1?2UE2Al2Go,1L2Hg3Nl82Ia3Qg;3M]72e@3RZ;3`C72T>2YD2@o1E,2TK2Gk1M2Jf1Q3Nb703R^;172Y=2\\D1>,2TD4XK>i2Fo1M2Jj1Q3Ng703Rb;172\\<2`C1=,2WC2?n1F4VNBi1J2Gf1N2Kb3Rf:162_;15,2V<2ZB1?2TE2Bn1J2Gk1N2Kf1Q2L^3Rb:,152Z;2^B1>2YE1B2UJ2Go1N2Ji1P2Kb3Qd9,03R];172X>1;2TC2@n1G2Bi2Im1O2Jd,3Ph803Ra:172\\>1;2YC1@2UF2Bl2Hp1N,2Ig3Ol82J`3Qe:172a>1;4^C7q1?2XF2Ao1G2UN,2Hj1N2Jd1Q3N`703R];182X>2]F1@2TF,2@j2Gn1M2Jq1Q3Ne703Ra;172\\>192T?,2WE2@m1F4TMAf2Im3QEc3Nj82J`3Rf;172_=182W>,2ZD2?q1F2Bl1I2Gj1N2Ke1R3M_62b<17,2Z=2]C1?2WE2Bq1I2Gn1N2Ki1Q3Mb52e;16,2]<172V>4[F:o1B4XK?l1G4UOCh2Jl1Q2Le3Rh:,152`;172Z>1;2WB2@q1G2Cl2Ip1P2K_', ',');
        for(x=1; #years){
            var ys = years[x];
            while(#ys > 0){
                var len = ..string.charCodeAt(ys, 1) - 48;
                var data = {};
                for(i=1; len){
                    ..table.push(data, ..string.charCodeAt(ys, i + 1) - 83);
                }
                self.DAYS[tostring(y * 13 + m)] = data;
                m++;
                ys = ..string.slice(ys, len + 2);
            }
            y++;
            m = 0;
        }
        self.isInit = true;
    }

    fromYm = function(year, month){
        return RabByungMonth(RabByungYear.fromYear(year), month);
    }

    fromElementZodiac = function(rabByungIndex, element, zodiac, month){
        return RabByungMonth(RabByungYear.fromElementZodiac(rabByungIndex, element, zodiac), month);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}
var RabByungMonth = RabByungMonth;
RabByungMonth.RabByungMonth = RabByungMonth;

// RabByungDay 类
class RabByungDay {
    ctor(month, dayNum){
        this = AbstractTyme();
        var day = self.numeric(dayNum, 'rab-byung day');
        if(day == 0 || day < -30 || day > 30){
            error("illegal day " ++ tostring(day) ++ " in " ++ tostring(month), 2);
        }
        var leap = day < 0;
        var d = ..math.abs(day);
        if(leap && !..table.find(month.getLeapDays(), d)){
            error("illegal leap day " ++ tostring(d) ++ " in " ++ tostring(month), 2);
        }
        elseif(!leap && ..table.find(month.getMissDays(), d)){
            error("illegal day " ++ tostring(d) ++ " in " ++ tostring(month), 2);
        }
        this.month = month;
        this.day = d;
        this.leap = leap;
    }

    getRabByungMonth = function(){
        return owner.month;
    }

    getYear = function(){
        return owner.month.getYear();
    }

    getMonth = function(){
        return owner.month.getMonthWithLeap();
    }

    getDay = function(){
        return owner.day;
    }

    isLeap = function(){
        return owner.leap;
    }

    getDayWithLeap = function(){
        return owner.leap ? -owner.day : owner.day;
    }

    getName = function(){
        return (owner.leap ? '闰' : '') ++ self.NAMES[owner.day];
    }

    toString = function(){
        return tostring(owner.month) ++ owner.getName();
    }

    next = function(n){
        return owner.getSolarDay().next(n).getRabByungDay();
    }

    subtract = function(target){
        return owner.getSolarDay().subtract(target.getSolarDay());
    }

    getSolarDay = function(){
        var m = RabByungMonth.fromYm(1950, 12);
        var n = 0;
        while(!owner.month.equals(m)){
            n += m.getDayCount();
            m = m.next(1);
        }
        var t = owner.day;
        var specialDays = m.getSpecialDays();
        for(i=1; #specialDays){
            var d = specialDays[i];
            if(d < 0){
                if(t > -d){
                    t--;
                }
            }
            elseif(d > 0){
                if(t > d){
                    t++;
                }
            }
        }
        if(owner.leap){
            t++;
        }
        return SolarDay.fromYmd(1951, 1, 7).next(n + t);
    }
}
var RabByungDay = RabByungDay;
SolarDay.RabByungDay = RabByungDay;

namespace RabByungDay {
    NAMES = [
        '初一', '初二', '初三', '初四', '初五', '初六', '初七', '初八', '初九', '初十',
        '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十',
        '廿一', '廿二', '廿三', '廿四', '廿五', '廿六', '廿七', '廿八', '廿九', '三十'
    ];

    fromYmd = function(year, month, day){
        return RabByungDay(RabByungMonth.fromYm(year, month), day);
    }

    fromElementZodiac = function(rabByungIndex, element, zodiac, month, day){
        return RabByungDay(RabByungMonth.fromElementZodiac(rabByungIndex, element, zodiac, month), day);
    }

    fromSolarDay = function(solarDay){
        var days = solarDay.subtract(SolarDay.fromYmd(1951, 1, 8));
        var m = RabByungMonth.fromYm(1950, 12);
        var count = m.getDayCount();
        while(days >= count){
            days -= count;
            m = m.next(1);
            count = m.getDayCount();
        }
        var day = days + 1;
        var specialDays = m.getSpecialDays();
        for(i=1; #specialDays){
            var d = specialDays[i];
            if(d < 0){
                if(day >= -d){
                    day++;
                }
            }
            elseif(d > 0){
                if(day == d + 1){
                    day = -d;
                    break;
                }
                elseif(day > d + 1){
                    day--;
                }
            }
        }
        return RabByungDay(m, day);
    }

    indexOf = AbstractTyme.indexOf;
    numeric = AbstractTyme.numeric;
}


/*****intellisense(time.tyme)
KitchenGodSteed = 灶马头
KitchenGodSteed.fromLunarYear(.(lunarYear) = 根据农历年创建灶马头对象\n参数 @lunarYear 为农历年份
RabByungElement = 藏历五行
RabByungElement.fromIndex(.(index) = 根据索引创建藏历五行对象\n参数 @index 为五行索引(0-4)
RabByungElement.fromName(.(name) = 根据名称创建藏历五行对象\n参数 @name 为五行名称
RabByungYear = 藏历年
RabByungYear.fromYear(.(year) = 根据年份创建藏历年对象\n参数 @year 为年份
RabByungYear.fromElementZodiac(.(rabByungIndex,element,zodiac) = 根据饶迥索引、五行、生肖创建藏历年对象\n参数 @rabByungIndex 为饶迥索引(0-150)\n参数 @element 为藏历五行对象\n参数 @zodiac 为生肖对象
RabByungMonth = 藏历月
RabByungMonth.fromYm(.(year,month) = 根据年月创建藏历月对象\n参数 @year 为年份\n参数 @month 为月份(负数表示闰月)
RabByungMonth.fromElementZodiac(.(rabByungIndex,element,zodiac,month) = 根据饶迥索引、五行、生肖、月份创建藏历月对象\n参数 @rabByungIndex 为饶迥索引\n参数 @element 为藏历五行对象\n参数 @zodiac 为生肖对象\n参数 @month 为月份
RabByungDay = 藏历日
RabByungDay.fromYmd(.(year,month,day) = 根据年月日创建藏历日对象\n参数 @year 为年份\n参数 @month 为月份(负数表示闰月)\n参数 @day 为日期(负数表示闰日)
RabByungDay.fromElementZodiac(.(rabByungIndex,element,zodiac,month,day) = 根据饶迥索引、五行、生肖、月份、日期创建藏历日对象
RabByungDay.fromSolarDay(.(solarDay) = 根据公历日创建藏历日对象\n参数 @solarDay 为公历日对象
end intellisense*****/

// 枚举类型定义
namespace YinYang {
    YIN = 0;
    YANG = 1;
}
var YinYang = YinYang;

namespace Side {
    IN = 0;
    OUT = 1;
}
var Side = Side;

namespace Gender {
    WOMAN = 0;
    MAN = 1;
}
var Gender = Gender;

namespace FestivalType {
    DAY = 0;
    TERM = 1;
    EVE = 2;
}
var FestivalType = FestivalType;

namespace HideHeavenStemType {
    RESIDUAL = 0;
    MIDDLE = 1;
    MAIN = 2;
}
var HideHeavenStemType = HideHeavenStemType;

/*****intellisense()
time.tyme = 万年历与农历支持库，提供公历、农历、干支、节气、星座、生肖等功能
end intellisense*****/

/*****intellisense(time.tyme)
YinYang = 阴阳枚举\nYIN=阴(0)\nYANG=阳(1)
Side = 方位枚举\nIN=内(0)\nOUT=外(1)
Gender = 性别枚举\nWOMAN=女(0)\nMAN=男(1)
FestivalType = 节日类型枚举\nDAY=日期型(0)\nTERM=节气型(1)\nEVE=除夕型(2)
HideHeavenStemType = 藏干类型枚举\nRESIDUAL=余气(0)\nMIDDLE=中气(1)\nMAIN=本气(2)
Animal = 二十八宿动物
Animal.fromIndex(.(index) = 根据索引创建动物对象\n参数 @index 为动物索引(0-27)
Animal.fromName(.(name) = 根据名称创建动物对象\n参数 @name 为动物名称
TwentyEightStar = 二十八宿
TwentyEightStar.fromIndex(.(index) = 根据索引创建二十八宿对象\n参数 @index 为星宿索引(0-27)
TwentyEightStar.fromName(.(name) = 根据名称创建二十八宿对象\n参数 @name 为星宿名称
SevenStar = 七曜
SevenStar.fromIndex(.(index) = 根据索引创建七曜对象\n参数 @index 为七曜索引(0-6)
SevenStar.fromName(.(name) = 根据名称创建七曜对象\n参数 @name 为七曜名称
Week = 星期
Week.fromIndex(.(index) = 根据索引创建星期对象\n参数 @index 为星期索引(0-6)
Week.fromName(.(name) = 根据名称创建星期对象\n参数 @name 为星期名称
Land = 九天
Land.fromIndex(.(index) = 根据索引创建九天对象\n参数 @index 为九天索引(0-8)
Land.fromName(.(name) = 根据名称创建九天对象\n参数 @name 为九天名称
Direction = 方向
Direction.fromIndex(.(index) = 根据索引创建方向对象\n参数 @index 为方向索引(0-8)
Direction.fromName(.(name) = 根据名称创建方向对象\n参数 @name 为方向名称
Zone = 四象
Zone.fromIndex(.(index) = 根据索引创建四象对象\n参数 @index 为四象索引(0-3)
Zone.fromName(.(name) = 根据名称创建四象对象\n参数 @name 为四象名称
Beast = 四兽
Beast.fromIndex(.(index) = 根据索引创建四兽对象\n参数 @index 为四兽索引(0-3)
Beast.fromName(.(name) = 根据名称创建四兽对象\n参数 @name 为四兽名称
Luck = 吉凶
Luck.fromIndex(.(index) = 根据索引创建吉凶对象\n参数 @index 为吉凶索引(0-1)
Luck.fromName(.(name) = 根据名称创建吉凶对象\n参数 @name 为吉凶名称
Constellation = 星座
Constellation.fromIndex(.(index) = 根据索引创建星座对象\n参数 @index 为星座索引(0-11)
Constellation.fromName(.(name) = 根据名称创建星座对象\n参数 @name 为星座名称
Duty = 建除十二值神
Duty.fromIndex(.(index) = 根据索引创建值神对象\n参数 @index 为值神索引(0-11)
Duty.fromName(.(name) = 根据名称创建值神对象\n参数 @name 为值神名称
Element = 五行
Element.fromIndex(.(index) = 根据索引创建五行对象\n参数 @index 为五行索引(0-4)
Element.fromName(.(name) = 根据名称创建五行对象\n参数 @name 为五行名称
God = 神煞
God.fromIndex(.(index) = 根据索引创建神煞对象\n参数 @index 为神煞索引
God.fromName(.(name) = 根据名称创建神煞对象\n参数 @name 为神煞名称
God.getDayGods(.(month,day) = 获取日神煞列表\n参数 @month 为月干支\n参数 @day 为日干支\n返回神煞对象数组
Phase = 月相
Phase.fromIndex(.(lunarYear,lunarMonth,index) = 根据农历年月和索引创建月相对象\n参数 @lunarYear 为农历年\n参数 @lunarMonth 为农历月\n参数 @index 为月相索引(0-7)
Phase.fromName(.(lunarYear,lunarMonth,name) = 根据农历年月和名称创建月相对象\n参数 @lunarYear 为农历年\n参数 @lunarMonth 为农历月\n参数 @name 为月相名称
PhaseDay = 月相日
Sixty = 三元
Sixty.fromIndex(.(index) = 根据索引创建三元对象\n参数 @index 为三元索引(0-2)
Sixty.fromName(.(name) = 根据名称创建三元对象\n参数 @name 为三元名称
Sound = 纳音
Sound.fromIndex(.(index) = 根据索引创建纳音对象\n参数 @index 为纳音索引(0-29)
Sound.fromName(.(name) = 根据名称创建纳音对象\n参数 @name 为纳音名称
Taboo = 宜忌
Taboo.fromIndex(.(index) = 根据索引创建宜忌对象\n参数 @index 为宜忌索引
Taboo.fromName(.(name) = 根据名称创建宜忌对象\n参数 @name 为宜忌名称
Taboo.getDayRecommends(.(month,day) = 获取日宜列表\n参数 @month 为月干支\n参数 @day 为日干支\n返回宜忌对象数组
Taboo.getDayAvoids(.(month,day) = 获取日忌列表\n参数 @month 为月干支\n参数 @day 为日干支\n返回宜忌对象数组
Taboo.getHourRecommends(.(day,hour) = 获取时宜列表\n参数 @day 为日干支\n参数 @hour 为时干支\n返回宜忌对象数组
Taboo.getHourAvoids(.(day,hour) = 获取时忌列表\n参数 @day 为日干支\n参数 @hour 为时干支\n返回宜忌对象数组
Ten = 旬
Ten.fromIndex(.(index) = 根据索引创建旬对象\n参数 @index 为旬索引(0-5)
Ten.fromName(.(name) = 根据名称创建旬对象\n参数 @name 为旬名称
Terrain = 地势
Terrain.fromIndex(.(index) = 根据索引创建地势对象\n参数 @index 为地势索引(0-11)
Terrain.fromName(.(name) = 根据名称创建地势对象\n参数 @name 为地势名称
Twenty = 运
Twenty.fromIndex(.(index) = 根据索引创建运对象\n参数 @index 为运索引(0-8)
Twenty.fromName(.(name) = 根据名称创建运对象\n参数 @name 为运名称
Zodiac = 生肖
Zodiac.fromIndex(.(index) = 根据索引创建生肖对象\n参数 @index 为生肖索引(0-11)
Zodiac.fromName(.(name) = 根据名称创建生肖对象\n参数 @name 为生肖名称
EarthBranch = 地支
EarthBranch.fromIndex(.(index) = 根据索引创建地支对象\n参数 @index 为地支索引(0-11)
EarthBranch.fromName(.(name) = 根据名称创建地支对象\n参数 @name 为地支名称
HeavenStem = 天干
HeavenStem.fromIndex(.(index) = 根据索引创建天干对象\n参数 @index 为天干索引(0-9)
HeavenStem.fromName(.(name) = 根据名称创建天干对象\n参数 @name 为天干名称
HideHeavenStem = 藏干
HideHeavenStemDay = 藏干日
PengZuHeavenStem = 彭祖百忌天干
PengZuHeavenStem.fromIndex(.(index) = 根据索引创建彭祖百忌天干对象\n参数 @index 为索引(0-9)
PengZuEarthBranch = 彭祖百忌地支
PengZuEarthBranch.fromIndex(.(index) = 根据索引创建彭祖百忌地支对象\n参数 @index 为索引(0-11)
PengZu = 彭祖百忌
PengZu.fromSixtyCycle(.(sixtyCycle) = 根据干支创建彭祖百忌对象\n参数 @sixtyCycle 为干支对象
TenStar = 十神
TenStar.fromIndex(.(index) = 根据索引创建十神对象\n参数 @index 为十神索引(0-9)
TenStar.fromName(.(name) = 根据名称创建十神对象\n参数 @name 为十神名称
SixStar = 六曜
SixStar.fromIndex(.(index) = 根据索引创建六曜对象\n参数 @index 为六曜索引(0-5)
SixStar.fromName(.(name) = 根据名称创建六曜对象\n参数 @name 为六曜名称
MinorRen = 小六壬
MinorRen.fromIndex(.(index) = 根据索引创建小六壬对象\n参数 @index 为小六壬索引(0-5)
MinorRen.fromName(.(name) = 根据名称创建小六壬对象\n参数 @name 为小六壬名称
SixtyCycle = 六十甲子
SixtyCycle.fromIndex(.(index) = 根据索引创建六十甲子对象\n参数 @index 为甲子索引(0-59)
SixtyCycle.fromName(.(name) = 根据名称创建六十甲子对象\n参数 @name 为干支名称(如"甲子")
Dog = 三伏
Dog.fromIndex(.(index) = 根据索引创建三伏对象\n参数 @index 为三伏索引(0-2)
Dog.fromName(.(name) = 根据名称创建三伏对象\n参数 @name 为三伏名称
DogDay = 三伏日
PlumRain = 梅雨
PlumRain.fromIndex(.(index) = 根据索引创建梅雨对象\n参数 @index 为梅雨索引(0-1)
PlumRain.fromName(.(name) = 根据名称创建梅雨对象\n参数 @name 为梅雨名称
PlumRainDay = 梅雨日
FetusHeavenStem = 胎神天干
FetusEarthBranch = 胎神地支
FetusDay = 胎神日
FetusDay.fromLunarDay(.(lunarDay) = 根据农历日创建胎神日对象\n参数 @lunarDay 为农历日对象
FetusDay.fromSixtyCycleDay(.(sixtyCycleDay) = 根据干支日创建胎神日对象\n参数 @sixtyCycleDay 为干支日对象
FetusMonth = 胎神月
FetusMonth.fromLunarMonth(.(lunarMonth) = 根据农历月创建胎神月对象\n参数 @lunarMonth 为农历月对象\n返回胎神月对象或null
Nine = 数九
Nine.fromIndex(.(index) = 根据索引创建数九对象\n参数 @index 为数九索引(0-8)
Nine.fromName(.(name) = 根据名称创建数九对象\n参数 @name 为数九名称
NineDay = 数九日
Phenology = 物候
Phenology.fromIndex(.(year,index) = 根据年份和索引创建物候对象\n参数 @year 为年份\n参数 @index 为物候索引(0-71)
Phenology.fromName(.(year,name) = 根据年份和名称创建物候对象\n参数 @year 为年份\n参数 @name 为物候名称
ThreePhenology = 三候
ThreePhenology.fromIndex(.(index) = 根据索引创建三候对象\n参数 @index 为三候索引(0-2)
ThreePhenology.fromName(.(name) = 根据名称创建三候对象\n参数 @name 为三候名称
Dipper = 北斗九星
Dipper.fromIndex(.(index) = 根据索引创建北斗九星对象\n参数 @index 为星索引(0-8)
Dipper.fromName(.(name) = 根据名称创建北斗九星对象\n参数 @name 为星名称
PhenologyDay = 物候日
NineStar = 九星
NineStar.fromIndex(.(index) = 根据索引创建九星对象\n参数 @index 为九星索引(0-8)
NineStar.fromName(.(name) = 根据名称创建九星对象\n参数 @name 为九星名称
TwelveStar = 黄道黑道十二神
TwelveStar.fromIndex(.(index) = 根据索引创建十二神对象\n参数 @index 为十二神索引(0-11)
TwelveStar.fromName(.(name) = 根据名称创建十二神对象\n参数 @name 为十二神名称
Ecliptic = 黄道黑道
Ecliptic.fromIndex(.(index) = 根据索引创建黄道黑道对象\n参数 @index 为索引(0-1)
Ecliptic.fromName(.(name) = 根据名称创建黄道黑道对象\n参数 @name 为名称
LunarYear = 农历年
LunarYear.fromYear(.(year) = 根据年份创建农历年对象\n参数 @year 为农历年份(-1至9999)
LunarSeason = 农历季节
LunarSeason.fromIndex(.(index) = 根据索引创建农历季节对象\n参数 @index 为季节索引(0-11)
LunarSeason.fromName(.(name) = 根据名称创建农历季节对象\n参数 @name 为季节名称
LunarMonth = 农历月
LunarMonth.fromYm(.(year,month) = 根据年月创建农历月对象\n参数 @year 为年份\n参数 @month 为月份(负数表示闰月)
end intellisense*****/

/*****intellisense(time.tyme.Animal)
fromIndex(.(index) = 根据索引创建动物对象
fromName(.(name) = 根据名称创建动物对象
next(.(n) = 获取偏移n个位置的动物对象
getTwentyEightStar() = 获取对应的二十八宿对象
getName() = 获取名称
getIndex() = 获取索引
toString() = 转为字符串
end intellisense*****/

/*****intellisense(time.tyme.TwentyEightStar)
fromIndex(.(index) = 根据索引创建二十八宿对象
fromName(.(name) = 根据名称创建二十八宿对象
next(.(n) = 获取偏移n个位置的二十八宿对象
getSevenStar() = 获取对应的七曜对象
getLand() = 获取对应的九天对象
getZone() = 获取对应的四象对象
getAnimal() = 获取对应的动物对象
getLuck() = 获取吉凶
getName() = 获取名称
getIndex() = 获取索引
toString() = 转为字符串
end intellisense*****/

/*****intellisense(time.tyme.SixtyCycle)
fromIndex(.(index) = 根据索引创建六十甲子对象
fromName(.(name) = 根据名称创建六十甲子对象
next(.(n) = 获取偏移n个位置的六十甲子对象
getHeavenStem() = 获取天干对象
getEarthBranch() = 获取地支对象
getSound() = 获取纳音对象
getPengZu() = 获取彭祖百忌对象
getTen() = 获取旬对象
getExtraEarthBranches() = 获取旬空地支数组
getName() = 获取名称
getIndex() = 获取索引
toString() = 转为字符串
end intellisense*****/

/*****intellisense(time.tyme.LunarYear)
fromYear(.(year) = 根据年份创建农历年对象
next(.(n) = 获取偏移n年的农历年对象
getYear() = 获取年份
getDayCount() = 获取天数
getMonthCount() = 获取月数
getLeapMonth() = 获取闰月月份(无闰月返回0)
getSixtyCycle() = 获取干支对象
getTwenty() = 获取运对象
getNineStar() = 获取九星对象
getJupiterDirection() = 获取岁星方位
getFirstMonth() = 获取正月对象
getMonths() = 获取所有月份数组
getKitchenGodSteed() = 获取灶马头对象
getName() = 获取名称
toString() = 转为字符串
end intellisense*****/

/*****intellisense(time.tyme.LunarMonth)
fromYm(.(year,month) = 根据年月创建农历月对象
next(.(n) = 获取偏移n个月的农历月对象
getLunarYear() = 获取农历年对象
getYear() = 获取年份
getMonth() = 获取月份
getMonthWithLeap() = 获取月份(闰月为负数)
getDayCount() = 获取天数
getIndexInYear() = 获取在年中的索引
getSeason() = 获取农历季节对象
getFirstJulianDay() = 获取初一的儒略日对象
isLeap() = 是否闰月
getWeekCount(.(start) = 获取周数\n参数 @start 为起始星期
getName() = 获取名称
toString() = 转为字符串
getDays() = 获取所有日期数组
getWeeks(.(start) = 获取所有周数组\n参数 @start 为起始星期
getSixtyCycle() = 获取干支对象
getNineStar() = 获取九星对象
getJupiterDirection() = 获取岁星方位
getFetus() = 获取胎神月对象
getMinorRen() = 获取小六壬对象
end intellisense*****/

/*****intellisense(time.tyme.LunarDay)
fromYmd(.(year,month,day) = 根据年月日创建农历日对象
next(.(n) = 获取偏移n天的农历日对象
getLunarMonth() = 获取农历月对象
getYear() = 获取年份
getMonth() = 获取月份(闰月为负数)
getDay() = 获取日期
getName() = 获取名称
toString() = 转为字符串
isBefore(.(target) = 是否早于目标日期\n参数 @target 为目标农历日对象
isAfter(.(target) = 是否晚于目标日期\n参数 @target 为目标农历日对象
getWeek() = 获取星期对象
getSixtyCycle() = 获取日干支对象
getDuty() = 获取建除十二值神对象
getTwelveStar() = 获取黄道黑道十二神对象
getNineStar() = 获取九星对象
getJupiterDirection() = 获取岁星方位
getFetusDay() = 获取胎神日对象
getPhaseDay() = 获取月相日对象
getPhase() = 获取月相对象
getSolarDay() = 获取公历日对象
getSixtyCycleDay() = 获取干支日对象
getTwentyEightStar() = 获取二十八宿对象
getFestival() = 获取农历节日对象(无节日返回null)
getSixStar() = 获取六曜对象
getGods() = 获取神煞数组
getRecommends() = 获取宜事项数组
getAvoids() = 获取忌事项数组
getHours() = 获取所有时辰数组
getMinorRen() = 获取小六壬对象
getThreePillars() = 获取三柱对象
end intellisense*****/

/*****intellisense(time.tyme.SolarDay)
fromYmd(.(year,month,day) = 根据年月日创建公历日对象
next(.(n) = 获取偏移n天的公历日对象
getSolarMonth() = 获取公历月对象
getYear() = 获取年份
getMonth() = 获取月份
getDay() = 获取日期
getWeek() = 获取星期对象
getConstellation() = 获取星座对象
getName() = 获取名称
toString() = 转为字符串
isBefore(.(target) = 是否早于目标日期\n参数 @target 为目标公历日对象
isAfter(.(target) = 是否晚于目标日期\n参数 @target 为目标公历日对象
getTerm() = 获取节气对象
getTermDay() = 获取节气日对象
getSolarWeek(.(start) = 获取公历周对象\n参数 @start 为起始星期
getPhenologyDay() = 获取物候日对象
getPhenology() = 获取物候对象
getDogDay() = 获取三伏日对象(非三伏返回null)
getPlumRainDay() = 获取梅雨日对象(非梅雨返回null)
getHideHeavenStemDay() = 获取藏干日对象
getNineDay() = 获取数九日对象(非数九返回null)
getIndexInYear() = 获取在年中的索引
subtract(.(target) = 计算与目标日期的天数差\n参数 @target 为目标公历日对象
getJulianDay() = 获取儒略日对象
getLunarDay() = 获取农历日对象
getRabByungDay() = 获取藏历日对象
getSixtyCycleDay() = 获取干支日对象
getLegalHoliday() = 获取法定节假日对象(无节假日返回null)
getFestival() = 获取公历节日对象(无节日返回null)
getPhaseDay() = 获取月相日对象
getPhase() = 获取月相对象
end intellisense*****/

/*****intellisense(time.tyme.SolarTime)
fromYmdHms(.(year,month,day,hour,minute,second) = 根据年月日时分秒创建公历时间对象
next(.(n) = 获取偏移n秒的公历时间对象
getSolarDay() = 获取公历日对象
getYear() = 获取年份
getMonth() = 获取月份
getDay() = 获取日期
getHour() = 获取小时
getMinute() = 获取分钟
getSecond() = 获取秒
getName() = 获取时间字符串(HH:MM:SS)
toString() = 转为字符串
isBefore(.(target) = 是否早于目标时间\n参数 @target 为目标公历时间对象
isAfter(.(target) = 是否晚于目标时间\n参数 @target 为目标公历时间对象
getTerm() = 获取节气对象
getPhenology() = 获取物候对象
getJulianDay() = 获取儒略日对象
subtract(.(target) = 计算与目标时间的秒数差\n参数 @target 为目标公历时间对象
getLunarHour() = 获取农历时对象
getSixtyCycleHour() = 获取干支时对象
getPhase() = 获取月相对象
end intellisense*****/

/*****intellisense(time.tyme.EightChar)
getYear() = 获取年柱干支对象
getMonth() = 获取月柱干支对象
getDay() = 获取日柱干支对象
getHour() = 获取时柱干支对象
getFetalOrigin() = 获取胎元干支对象
getFetalBreath() = 获取胎息干支对象
getOwnSign() = 获取命宫干支对象
getBodySign() = 获取身宫干支对象
getDuty() = 获取建除十二值神对象
getName() = 获取八字字符串
getSolarTimes(.(startYear,endYear) = 获取指定年份范围内的公历时间数组\n参数 @startYear 为起始年份\n参数 @endYear 为结束年份
end intellisense*****/

/*****intellisense(time.tyme.ChildLimit)
fromSolarTime(.(birthTime,gender) = 根据出生时间和性别创建童限对象
getEightChar() = 获取八字对象
getGender() = 获取性别
getYearCount() = 获取起运年数
getMonthCount() = 获取起运月数
getDayCount() = 获取起运天数
getHourCount() = 获取起运时数
getMinuteCount() = 获取起运分数
getStartTime() = 获取出生时间对象
getEndTime() = 获取起运时间对象
isForward() = 是否顺推
getStartDecadeFortune() = 获取起运大运对象
getDecadeFortune() = 获取上一步大运对象
getStartFortune() = 获取起运流年对象
getEndLunarYear() = 获取起运农历年对象
getStartSixtyCycleYear() = 获取出生干支年对象
getEndSixtyCycleYear() = 获取起运干支年对象
getStartAge() = 获取起运虚岁
getEndAge() = 获取起运实岁
end intellisense*****/

/*****intellisense(time.tyme.DecadeFortune)
fromChildLimit(.(childLimit,index) = 根据童限和索引创建大运对象
getStartAge() = 获取起始虚岁
getEndAge() = 获取结束虚岁
getStartLunarYear() = 获取起始农历年对象
getEndLunarYear() = 获取结束农历年对象
getStartSixtyCycleYear() = 获取起始干支年对象
getEndSixtyCycleYear() = 获取结束干支年对象
getSixtyCycle() = 获取大运干支对象
getName() = 获取名称
next(.(n) = 获取偏移n步的大运对象
getStartFortune() = 获取起始流年对象
end intellisense*****/

/*****intellisense(time.tyme.Fortune)
fromChildLimit(.(childLimit,index) = 根据童限和索引创建流年对象
getAge() = 获取虚岁
getLunarYear() = 获取农历年对象
getSixtyCycleYear() = 获取干支年对象
getSixtyCycle() = 获取流年干支对象
getName() = 获取名称
next(.(n) = 获取偏移n年的流年对象
end intellisense*****/